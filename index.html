<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VHT Automation ‚Äì Arrivals &amp; Departures v5</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #f5f5f8;
      color: #222;
    }
    .screen-only { display: block; }
    .print-only { display: none; }
    .app-header {
      padding: 18px 20px 20px;
      background: #ffffff;
      border-bottom: 1px solid #e0e0e0;
      color: #002b45;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .top-toolbar {
      position: absolute;
      top: 18px;
      right: 20px;
    }
    .top-toolbar .btn {
      margin: 0;
    }
    .app-header small {
      font-size: 12px;
      opacity: 0.9;
    }
    .vht-header-logo {
      max-width: 180px;
      max-height: 90px;
      display: block;
      margin: 0 auto 8px auto;
    }

    .header-title {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      color: #002b45;
      margin: 0 0 4px 0;
      letter-spacing: 0.5px;
    }

    .header-subtitle {
      font-size: 15px;
      font-weight: 400;
      text-align: center;
      color: #444444;
      margin: 0 0 6px 0;
      letter-spacing: 0.4px;
    }
    .app-container {
      display: flex;
      height: calc(100vh - 52px);
    }
    .sidebar {
      width: 320px;
      border-right: 1px solid #ddd;
      background: #fff;
      padding: 14px;
      overflow-y: auto;
    }
    .sidebar h2 {
      font-size: 16px;
      margin: 0 0 8px;
    }
    .sidebar-section-title {
      font-size: 13px;
      font-weight: 600;
      margin: 14px 0 4px;
      color: #333;
    }
    .itinerary-selector-box {
      margin: 0 0 16px 0;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      background-color: #f8f9fa;
    }
    .itinerary-selector-box h3 {
      font-size: 14px;
      font-weight: 600;
      margin: 0 0 10px 0;
      color: #333;
    }
    .itinerary-selector-box label {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
      display: block;
      color: #555;
    }
    .itinerary-selector-box select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 13px;
      margin-bottom: 8px;
      background-color: #fff;
    }
    /* ================== ADMIN ITINERARY HELPER ================== */
    /* ================== ADMIN ITINERARY HELPER (VHT) ================== */
    #itinerary-helper-panel {
      max-width: 100%;
      margin: 16px 0;
      padding: 16px 18px;
      border-radius: 14px;
      background: #ffffff;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      border: 1px solid #e5e7eb;
    }
    #itinerary-helper-panel h2 {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 17px;
      margin-bottom: 8px;
    }
    #itinerary-helper-panel p.description {
      margin: 0 0 12px;
      color: #4b5563;
      font-size: 13px;
    }
    .itinerary-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }
    .itinerary-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3730a3;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .helper-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 14px;
    }
    .helper-card {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 12px 14px;
      background: #f9fafb;
    }
    .helper-card h3 {
      margin: 0 0 4px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .helper-card small {
      display: block;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #6b7280;
      margin-bottom: 6px;
    }
    .helper-card ul {
      margin: 0;
      padding-left: 18px;
      font-size: 12px;
      color: #4b5563;
    }
    .helper-card li {
      margin-bottom: 3px;
    }
    .helper-inline-note {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 12px;
      background: #ecfdf5;
      font-size: 12px;
      color: #166534;
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }
    .helper-inline-note strong {
      font-weight: 600;
    }
    .helper-footer {
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px dashed #e5e7eb;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
      align-items: center;
    }
    .helper-footer p {
      margin: 0;
      font-size: 11px;
      color: #6b7280;
    }
    .helper-footer span.badge {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px dashed #9ca3af;
      font-size: 10px;
      color: #4b5563;
    }
    details.helper-details {
      margin-top: 10px;
      border-radius: 10px;
      background: #f3f4f6;
      padding: 6px 10px;
      font-size: 11px;
    }
    details.helper-details summary {
      cursor: pointer;
      list-style: none;
    }
    details.helper-details summary::-webkit-details-marker {
      display: none;
    }
    details.helper-details summary span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    details.helper-details div {
      margin-top: 6px;
      color: #4b5563;
    }
    .field {
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      font-size: 13px;
    }
    .field label {
      margin-bottom: 2px;
      font-weight: 500;
    }
    .field input,
    .field select,
    .field textarea {
      border-radius: 6px;
      border: 1px solid #ccc;
      padding: 6px 8px;
      font-size: 13px;
    }
    .field textarea {
      resize: vertical;
      min-height: 50px;
    }
    .two-cols {
      display: flex;
      gap: 8px;
    }
    .two-cols .field {
      flex: 1;
    }
    .btn {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn-primary {
      background: linear-gradient(135deg, #1363df, #47b5ff);
      color: #fff;
    }
    .btn-secondary {
      background: #eeeeee;
      color: #333;
      border: 1px solid #cccccc;
    }
    .btn-block {
      width: 100%;
      text-align: center;
      margin-top: 10px;
    }
    .small-hint {
      font-size: 11px;
      color: #777;
      margin-top: 4px;
    }
    .upload-container {
      margin-top: 16px;
      padding-top: 10px;
      border-top: 1px dashed #ccc;
    }
    .upload-container label {
      font-size: 12px;
      font-weight: 500;
    }
    .upload-container input {
      margin-top: 4px;
      font-size: 11px;
    }
    .main-content {
      flex: 1;
      padding: 14px;
      overflow-y: auto;
    }
    .brand-header {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 16px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e0e0e0;
    }
    .brand-header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .brand-logo {
      height: 40px;
      width: auto;
    }
    .brand-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .brand-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.03em;
    }
    .brand-subtitle {
      font-size: 13px;
      color: #666666;
    }
    .trip-meta-card {
      margin: 8px 0 16px;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #e5e5e5;
      background-color: #fafafa;
      font-size: 13px;
      line-height: 1.5;
    }
    .trip-meta-card strong,
    .trip-meta-card b {
      font-weight: 600;
    }
    /* Optional: make the main itinerary title a bit stronger */
    .itinerary-title, .trip-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    /* Optional: nicer spacing for day blocks on screen */
    .day-card,
    .itinerary-day,
    .day-block {
      border-radius: 8px;
      border: 1px solid #f0f0f0;
      padding: 10px 12px;
      margin-bottom: 12px;
      background-color: #ffffff;
    }
    .day-card h3,
    .itinerary-day h3,
    .day-block h3 {
      margin-top: 0;
      margin-bottom: 6px;
      font-size: 15px;
      font-weight: 600;
    }
    .day-location {
      font-style: italic;
      font-size: 12px;
      color: #666666;
      margin-bottom: 4px;
    }
    .section-label {
      font-weight: 600;
      font-size: 12px;
      margin-top: 6px;
      margin-bottom: 2px;
    }
    .itinerary-header {
      background: #fff;
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      font-size: 13px;
    }
    .itinerary-header h2 {
      margin: 0 0 6px;
      font-size: 16px;
    }
    .itinerary-header-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 12px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      background: #eef4ff;
      color: #234;
      font-size: 11px;
      margin-right: 4px;
      margin-top: 2px;
    }
    .badge span {
      font-weight: 600;
      margin-right: 4px;
    }
    .day-card {
      background: #fff;
      border-radius: 12px;
      padding: 0 0 10px;
      margin-bottom: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      border: 1px solid #e4e4e4;
    }
    .day-banner {
      border-radius: 12px 12px 0 0;
      padding: 10px 14px;
      background: linear-gradient(120deg, #ff9f1c, #ff5d68);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .day-banner-main {
      font-size: 15px;
      font-weight: 600;
    }
    .day-banner-sub {
      font-size: 11px;
      opacity: 0.95;
    }
    .day-banner-date {
      font-size: 12px;
      font-weight: 500;
    }
    .day-content {
      padding: 10px 14px;
      font-size: 13px;
    }
    .day-section-title {
      font-size: 12px;
      font-weight: 600;
      margin: 8px 0 4px;
      color: #333;
    }
    .day-hotel-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 4px;
    }
    .star-rating {
      font-size: 12px;
      margin-left: 4px;
      color: #f5b301;
      white-space: nowrap;
    }
    .day-hotel-row select,
    .day-hotel-row input {
      font-size: 12px;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .day-activity-row {
      margin-bottom: 8px;
    }
    .day-activity-row select {
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid #ddd;
      margin-bottom: 4px;
    }
    .day-activity-row textarea {
      width: 100%;
      min-height: 60px;
      resize: vertical;
      font-size: 12px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .transfer-label {
      font-size: 12px;
      font-weight: 600;
      margin: 8px 0 4px;
      color: #1363df;
    }
    .transfer-box {
      background: #f3f7ff;
      border-radius: 8px;
      border: 1px solid #d0e2ff;
      padding: 6px 8px;
      margin-bottom: 6px;
    }
    .transfer-box textarea {
      width: 100%;
      border: none;
      background: transparent;
      resize: vertical;
      font-size: 12px;
      padding: 0;
      outline: none;
    }
    .picture-gallery-footer {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 2px solid #e5e7eb;
    }
    .picture-gallery-container {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      min-height: 120px;
      padding: 12px;
      background: #f9fafb;
      border: 2px dashed #cbd5e1;
      border-radius: 8px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .picture-gallery-container:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }
    .picture-gallery-container.drag-over {
      background: #eff6ff;
      border-color: #3b82f6;
      border-style: solid;
    }
    .picture-gallery-item {
      flex: 1;
      min-width: 0;
      position: relative;
      border-radius: 6px;
      overflow: hidden;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      max-width: calc(33.333% - 6px);
      min-height: 120px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .picture-gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .picture-gallery-item .remove-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .picture-gallery-item:hover .remove-btn {
      opacity: 1;
    }
    .picture-gallery-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      font-size: 12px;
      text-align: center;
      padding: 20px;
      flex: 1;
    }
    .picture-gallery-placeholder span {
      pointer-events: none;
    }
    details.picture-placeholder {
      margin-top: 8px;
      font-size: 12px;
    }
    details.picture-placeholder summary {
      cursor: pointer;
      font-weight: 500;
    }
    details.picture-placeholder textarea {
      width: 100%;
      min-height: 40px;
      margin-top: 4px;
      font-size: 12px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px dashed #bbb;
      resize: vertical;
    }
    .internal-notes {
      background: #fff7e6;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 12px;
      border: 1px dashed #ffb347;
      margin-bottom: 16px;
    }
    .internal-notes h3 {
      margin-top: 0;
      font-size: 13px;
      margin-bottom: 6px;
    }
    .internal-notes textarea {
      width: 100%;
      min-height: 60px;
      border-radius: 8px;
      border: 1px solid #f0c27b;
      padding: 6px 8px;
      font-size: 12px;
      resize: vertical;
      background: #fffdf7;
    }
    .warning-list {
      margin: 0;
      padding-left: 18px;
      font-size: 11px;
    }
    @media print {
      body {
        background: #ffffff !important;
        color: #000000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        font-size: 11pt;
        line-height: 1.4;
      }

      /* Hide sidebar / input controls */
      .sidebar,
      .left-panel,
      .input-panel,
      .filters-panel {
        display: none !important;
      }

      /* Hide explicit no-print elements and generic buttons/toolbars */
      .no-print,
      button,
      .top-toolbar,
      .controls,
      .footer {
        display: none !important;
      }

      /* Hide admin helper on print / PDF */
      #itinerary-helper-panel,
      #itinerary-sidebar-helper {
        display: none !important;
      }
    }

    /* ========== FLOATING SIDEBAR HELPER FOR DAYS SELECTION ========== */
    #itinerary-sidebar-helper {
      position: fixed;
      right: 20px;
      bottom: 20px;
      width: 260px;
      max-width: 80vw;
      background: #111827;
      color: #e5e7eb;
      border-radius: 18px;
      padding: 14px 16px;
      box-shadow: 0 18px 45px rgba(15,23,42,0.5);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      z-index: 9999;
      display: none;
    }
    #itinerary-sidebar-helper h4 {
      margin: 0 0 4px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    #itinerary-sidebar-helper p {
      margin: 0;
      font-size: 12px;
      line-height: 1.4;
    }
    #itinerary-sidebar-helper .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      margin-top: 6px;
      background: rgba(55,65,81,0.8);
    }
    #itinerary-sidebar-helper button.helper-close {
      position: absolute;
      top: 6px;
      right: 8px;
      border: none;
      background: transparent;
      color: #9ca3af;
      cursor: pointer;
      font-size: 13px;
    }
    #itinerary-sidebar-helper button.helper-close:hover {
      color: #f9fafb;
    }

    @media print {
      /* Hide internal notes meant only for Lona */
      .internal-notes {
        display: none !important;
      }

      /* Hide technical labels that don't look good in client PDF */
      .location-label {
        display: none !important;
      }

      /* Keep brand header visible and nicely spaced */
      .brand-header {
        display: flex !important;
        border-bottom: 1px solid #cccccc;
        margin-bottom: 8mm;
        padding-bottom: 3mm;
      }

      .brand-title {
        font-size: 16pt !important;
      }

      .brand-subtitle {
        font-size: 9pt !important;
      }

      /* Trip meta card prints as a soft, subtle card */
      .trip-meta-card {
        border: 1px solid #dddddd !important;
        background-color: #f9f9f9 !important;
        padding: 6mm 6mm 5mm;
        margin: 0 0 8mm 0;
        page-break-inside: avoid;
      }

      /* Make itinerary area full width with nice margins for A4 */
      .itinerary-container,
      .itinerary-output,
      .main-content,
      #itineraryArea {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        padding: 0 12mm !important;
        box-shadow: none !important;
        border-radius: 0 !important;
        background: #ffffff !important;
      }

      .app-container {
        display: block;
        height: auto;
      }

      /* Day blocks: light frame + spacing and avoid splitting mid-day when possible */
      .day-card,
      .itinerary-day,
      .day-block {
        page-break-inside: avoid;
        margin-bottom: 8mm;
        border: 1px solid #e0e0e0;
        padding: 4mm 4mm 5mm;
        border-radius: 4px;
        background-color: #ffffff !important;
      }

      .day-card h3,
      .itinerary-day h3,
      .day-block h3 {
        font-size: 13pt !important;
        margin-bottom: 2mm;
      }

      .day-location {
        font-size: 10pt !important;
        font-style: italic;
        margin-bottom: 2mm;
      }

      .itinerary-header h2 {
        font-size: 13pt !important;
        font-weight: 600;
        margin-bottom: 3mm;
      }

      /* Textareas and selects: show content cleanly without heavy UI chrome */
      textarea {
        border: none !important;
        box-shadow: none !important;
        resize: none !important;
        background: transparent !important;
      }

      select {
        border: none !important;
        background: transparent !important;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      /* Hide screen-only elements */
      .screen-only {
        display: none !important;
      }

      /* Show print-only elements */
      .print-only {
        display: block !important;
      }

      /* Hide picture placeholders and details */
      details.picture-placeholder {
        display: none !important;
      }
      
      /* Show picture gallery in print */
      .picture-gallery-footer {
        page-break-inside: avoid;
        margin-top: 12px;
        padding-top: 8px;
        border-top: 1px solid #ddd;
      }
      .picture-gallery-container {
        display: flex;
        gap: 6px;
        min-height: 100px;
        border: 1px solid #ddd;
        background: #f9fafb;
      }
      .picture-gallery-item {
        max-width: calc(33.333% - 4px);
      }
      .picture-gallery-item .remove-btn {
        display: none;
      }
      .picture-gallery-placeholder {
        display: none;
      }

      /* Clean up itinerary header for print */
      .itinerary-header {
        margin-bottom: 8mm;
        padding-bottom: 3mm;
        border-bottom: 1px solid #cccccc;
      }

      /* Ensure day cards print nicely */
      .day-banner {
        page-break-after: avoid;
      }

      /* Hide the app header (top navigation) */
      .app-header {
        display: none !important;
      }
    }

    /* ===== Print toolbar ===== */
    .print-toolbar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 10px;
    }

    .print-toolbar button {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #111827;
      color: #f9fafb;
      font-size: 13px;
      cursor: pointer;
    }

    .print-toolbar button:hover {
      background: #1f2937;
    }

    /* Hide the toolbar on the printed PDF */
    @media print {
      .print-toolbar {
        display: none !important;
      }
    }
    /* Map container styles */
    .itinerary-map-container {
      margin-top: 30px;
      margin-bottom: 20px;
      page-break-inside: avoid;
    }
    .itinerary-map-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #002b45;
    }
    #itineraryMap {
      width: 100%;
      height: 400px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      background: #f3f4f6;
    }
    .custom-marker {
      background: transparent !important;
      border: none !important;
    }
    .airplane-marker {
      background: transparent !important;
      border: none !important;
      z-index: 1000;
    }
    @media print {
      #itineraryMap {
        height: 300px;
        border: 1px solid #ccc;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .itinerary-map-container {
        page-break-inside: avoid;
        margin-top: 20px;
      }
      .leaflet-control {
        display: none !important;
      }
    }
  </style>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <div class="app-header">
    <img src="vht_logo.png" alt="VHT Vietnam Holiday Tours" class="vht-header-logo" />
    <div class="header-title">Vietnam Holiday Tours</div>
    <div class="header-subtitle">Itinerary proposal</div>
    <div class="top-toolbar no-print">
      <button id="printItineraryBtn" class="btn btn-primary">
        Print / Save as PDF
      </button>
    </div>
  </div>

  <div class="app-container">
    <div class="sidebar">
      <h2>Traveller Input</h2>

      <!-- BRIEF & FULL ITINERARY SELECTORS -->
      <div class="itinerary-selector-box">
        <h3>Select Pre-Defined Itinerary</h3>

        <label for="brief-itinerary-select">Brief Itineraries:</label>
        <select id="brief-itinerary-select">
          <option value="">Select brief itinerary‚Ä¶</option>
          <option value="4">4 Days</option>
          <option value="6">6 Days</option>
          <option value="8">8 Days</option>
          <option value="10">10 Days</option>
          <option value="12">12 Days</option>
          <option value="14">14 Days</option>
          <option value="16">16 Days</option>
          <option value="18">18 Days</option>
          <option value="20">20 Days</option>
          <option value="21">21 Days</option>
          <option value="22">22 Days</option>
          <option value="24">24 Days</option>
          <option value="26">26 Days</option>
          <option value="28">28 Days</option>
          <option value="30">30 Days</option>
        </select>

        <br><br>

        <label for="detailed-itinerary-select">Detailed Itineraries:</label>
        <select id="detailed-itinerary-select">
          <option value="">Select full detailed itinerary‚Ä¶</option>
          <option value="4">4 Days</option>
          <option value="6">6 Days</option>
          <option value="8">8 Days</option>
          <option value="10">10 Days</option>
          <option value="12">12 Days</option>
          <option value="14">14 Days</option>
          <option value="16">16 Days</option>
          <option value="18">18 Days</option>
          <option value="20">20 Days</option>
          <option value="21">21 Days</option>
          <option value="22">22 Days</option>
          <option value="24">24 Days</option>
          <option value="26">26 Days</option>
          <option value="28">28 Days</option>
          <option value="30">30 Days</option>
        </select>
      </div>

      <!-- ================== ADMIN ITINERARY HELPER ================== -->
      <section id="itinerary-helper-panel" class="no-print">
        <h2>üß≠ Admin Guide ‚Äì Itinerary Length Helper</h2>
        <p class="description">
          Internal only ‚Äì helps you quickly choose the right tour length & template according to the
          number of days, pace and style. This section is not printed for clients.
        </p>

        <div class="itinerary-badges">
          <span class="itinerary-badge">4‚Äì14 days ¬∑ Short / Medium</span>
          <span class="itinerary-badge">15‚Äì20 days ¬∑ Extended</span>
          <span class="itinerary-badge">21‚Äì30 days ¬∑ Full Vietnam</span>
        </div>

        <div class="helper-grid">
          <!-- Short & Medium -->
          <div class="helper-card">
            <small>4‚Äì14 days</small>
            <h3>üü© Short & Medium Programs</h3>
            <ul>
              <li>Quick vacations & family trips</li>
              <li>Classic highlights (North / Central / South)</li>
              <li>Light adventure, simple logistics</li>
              <li>Few or no internal flights</li>
            </ul>
          </div>

          <!-- Extended -->
          <div class="helper-card">
            <small>15‚Äì20 days</small>
            <h3>üüß Extended Journeys</h3>
            <ul>
              <li>Deeper Vietnam experience without rush</li>
              <li>Balanced mix: cities, culture, nature</li>
              <li>Includes internal flights & longer transfers</li>
              <li>Great for first-time but curious travellers</li>
            </ul>
          </div>

          <!-- Long-haul -->
          <div class="helper-card">
            <small>21‚Äì30 days</small>
            <h3>üü¶ Long-Haul / Full Vietnam</h3>
            <ul>
              <li>Full Vietnam South ‚áÑ North panorama</li>
              <li>Add Sapa / Ha Giang, Mai Chau, etc.</li>
              <li>Overnight cruise + mountains + Mekong</li>
              <li>Use your 21-day & 30-day master templates</li>
            </ul>
          </div>
        </div>

        <div class="helper-inline-note">
          <span>‚úÖ</span>
          <div>
            <strong>Workflow tip:</strong>  
            Generate the brief or detailed itinerary, then adjust hotels, transfers, and pace
            before sending PDF to the client. Long drives and early wake-ups should always be double-checked.
          </div>
        </div>

        <details class="helper-details">
          <summary>
            <span>üáªüá≥ Xem t√≥m t·∫Øt h∆∞·ªõng d·∫´n n√†y b·∫±ng ti·∫øng Vi·ªát</span>
          </summary>
          <div>
            - 4‚Äì14 ng√†y: ch∆∞∆°ng tr√¨nh ng·∫Øn & trung b√¨nh, linh ho·∫°t, d·ªÖ ch·ªânh.<br>
            - 15‚Äì20 ng√†y: h√†nh tr√¨nh m·ªü r·ªông, tr·∫£i nghi·ªám s√¢u h∆°n nh∆∞ng v·∫´n tho·∫£i m√°i.<br>
            - 21‚Äì30 ng√†y: tour d√†i "xem g·∫ßn nh∆∞ t·∫•t c·∫£" ‚Äì d√πng template 21 & 30 ng√†y ƒë·ªÉ ch·ªânh theo y√™u c·∫ßu kh√°ch.
          </div>
        </details>

        <div class="helper-footer">
          <p>For Lona: use this as a quick compass before choosing the template.</p>
          <span class="badge">Admin only ¬∑ Hidden on print / PDF</span>
        </div>
      </section>
      <!-- ================== END ADMIN ITINERARY HELPER ================== -->

      <div class="field">
        <label for="groupName">Name of travellers / group</label>
        <input id="groupName" type="text" placeholder="e.g. Cohen Family ‚Äì 4 pax" />
      </div>

      <div class="field">
        <label for="nationality">Nationality</label>
        <select id="nationality">
          <option value="">Select‚Ä¶</option>
          <option>Israeli</option>
          <option>French</option>
          <option>American</option>
          <option>Canadian</option>
          <option>European (Mixed)</option>
          <option>Other</option>
        </select>
      </div>

      <div class="field">
        <label for="ageGroup">Age group</label>
        <select id="ageGroup">
          <option value="">Select‚Ä¶</option>
          <option>Young adults (18‚Äì30)</option>
          <option>Mixed adults (30‚Äì55)</option>
          <option>Seniors (55+)</option>
          <option>Family with kids</option>
          <option>Multi-generation</option>
        </select>
      </div>

      <div class="two-cols">
        <div class="field">
          <label for="numDays">Number of days</label>
          <select id="numDays">
            <option value="1">1</option><option value="2">2</option><option value="3">3</option>
            <option value="4">4</option><option value="5">5</option><option value="6">6</option>
            <option value="7" selected>7</option><option value="8">8</option><option value="9">9</option>
            <option value="10">10</option><option value="11">11</option><option value="12">12</option>
            <option value="13">13</option><option value="14">14</option><option value="15">15</option>
            <option value="16">16</option><option value="17">17</option><option value="18">18</option>
            <option value="19">19</option><option value="20">20</option><option value="21">21</option>
            <option value="22">22</option><option value="23">23</option><option value="24">24</option>
            <option value="25">25</option><option value="26">26</option><option value="27">27</option>
            <option value="28">28</option><option value="29">29</option><option value="30">30</option>
          </select>
        </div>

        <div class="field">
          <label for="area">Area</label>
          <select id="area">
            <option value="">Select‚Ä¶</option>
            <option>North Vietnam</option>
            <option>Central Vietnam</option>
            <option>South Vietnam</option>
            <option>Vietnam ‚Äì Country-wide</option>
            <option>Vietnam &amp; Cambodia</option>
          </select>
        </div>
      </div>

      <!-- Dates & times -->
      <div class="two-cols">
        <div class="field">
          <label for="startDate">Start date</label>
          <input id="startDate" type="date" />
          <label for="arrivalTime" style="margin-top:6px;">Arrival time</label>
          <input id="arrivalTime" type="time" />
          <div class="small-hint">Or write in Special requests, e.g. "Arrival 14:30".</div>
        </div>

        <div class="field">
          <label for="endDate">End date (auto)</label>
          <input id="endDate" type="date" disabled />
          <label for="departureTime" style="margin-top:6px;">Departure time</label>
          <input id="departureTime" type="time" />
          <div class="small-hint">Or write in Special requests, e.g. "Departure 23:55".</div>
        </div>
      </div>

      <div class="two-cols">
        <div class="field">
          <label for="startCity">Start city</label>
          <select id="startCity">
            <option>Ho Chi Minh City</option>
            <option>Hanoi</option>
            <option>Da Nang</option>
            <option>Hoi An</option>
            <option>Hue</option>
            <option>Ha Long Bay</option>
            <option>Ninh Binh</option>
            <option>Sapa</option>
            <option>Can Tho</option>
            <option>Phu Quoc</option>
            <option>Nha Trang</option>
            <option>Da Lat</option>
            <option>Mui Ne</option>
            <option>Phnom Penh</option>
            <option>Siem Reap</option>
            <option>Battambang</option>
          </select>
        </div>
        <div class="field">
          <label for="endCity">End city</label>
          <select id="endCity">
            <option value="">Same as start</option>
            <option>Ho Chi Minh City</option>
            <option>Hanoi</option>
            <option>Da Nang</option>
            <option>Hoi An</option>
            <option>Hue</option>
            <option>Ha Long Bay</option>
            <option>Ninh Binh</option>
            <option>Sapa</option>
            <option>Can Tho</option>
            <option>Phu Quoc</option>
            <option>Nha Trang</option>
            <option>Da Lat</option>
            <option>Mui Ne</option>
            <option>Phnom Penh</option>
            <option>Siem Reap</option>
            <option>Battambang</option>
          </select>
        </div>
      </div>

      <div class="field">
        <label for="tourType">Type of tour</label>
        <select id="tourType">
          <option value="">Select‚Ä¶</option>
          <option>Private</option>
          <option>Backpacker</option>
          <option>Small group</option>
          <option>Large group</option>
          <option>Combined (group + private)</option>
        </select>
      </div>

      <div class="field">
        <label for="tourLevel">Level</label>
        <select id="tourLevel">
          <option value="">Select‚Ä¶</option>
          <option>Easy</option>
          <option>Moderate</option>
          <option>Intensive</option>
          <option>Adventurous</option>
        </select>
      </div>

      <div class="field">
        <label for="hotelRating">Hotel rating</label>
        <select id="hotelRating">
          <option value="">Select‚Ä¶</option>
          <option>Homestay</option>
          <option>3‚òÖ</option>
          <option>4‚òÖ</option>
          <option>5‚òÖ</option>
          <option>Luxury / Boutique</option>
          <option>Mixed (3‚Äì4‚òÖ)</option>
        </select>
      </div>

      <div class="field">
        <label for="foodPref">Food preferences</label>
        <select id="foodPref">
          <option value="">Select‚Ä¶</option>
          <option>Everything ‚Äì standard local &amp; international</option>
          <option>Vegetarian</option>
          <option>Vegan</option>
          <option>Halal</option>
          <option>Kosher style (no pork/seafood, separate pans)</option>
        </select>
      </div>

      <div class="field">
        <label for="specialRequests">Special requests (shown to client)</label>
        <textarea id="specialRequests" placeholder='e.g. "Arrival 14:30, Departure 23:55", anniversary, mobility, must-see spots‚Ä¶'></textarea>
      </div>

      <div class="field">
        <label for="placesToVisit">Places to Visit (optional - select all that apply)</label>
        <div id="placesToVisitCheckboxes" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px; padding: 8px; background: #f9fafb;">
          <!-- Checkboxes will be populated by JavaScript -->
        </div>
        <div style="margin-top: 8px;">
          <label for="customPlaces" style="font-size: 12px; color: #666;">Custom places (comma-separated):</label>
          <input id="customPlaces" type="text" placeholder='e.g. "Mai Chau valley, Fansipan mountain"' 
                 style="width: 100%; padding: 6px; margin-top: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" />
          <div class="small-hint">Type any specific places or attractions you want to visit</div>
        </div>
        <div id="placesWarning" style="margin-top: 8px; padding: 8px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 4px; display: none; font-size: 12px; color: #92400e;">
          <strong>‚ö†Ô∏è Warning:</strong> <span id="placesWarningText"></span>
        </div>
      </div>

      <div class="sidebar-section-title">Additional internal info (for Lona only)</div>

      <div class="field">
        <label for="budgetHint">Budget level (rough)</label>
        <select id="budgetHint">
          <option value="">Optional‚Ä¶</option>
          <option>Budget</option>
          <option>Mid-range</option>
          <option>High-end</option>
          <option>Luxury</option>
        </select>
      </div>

      <div class="field">
        <label for="paceHint">Pace preference comment</label>
        <input id="paceHint" type="text" placeholder="e.g. late mornings, nightlife, few hotel changes" />
      </div>

      <button class="btn btn-primary btn-block" id="generateBtn">Generate / Refresh Itinerary</button>
      <div class="small-hint">
        Edit each day (city, hotel, transfer, activities) after generation before sending to the client.
      </div>

      <div class="upload-container">
        <label for="templateUpload">Upload new itinerary templates (JSON)</label><br />
        <input id="templateUpload" type="file" accept=".json" />
        <div class="small-hint">
          This enriches hotels &amp; activities for each city.
        </div>
      </div>
    </div>

    <div class="main-content">
      <div id="itineraryArea"></div>
    </div>
  </div>

  <script>
    const CITY_OPTIONS = [
      "Ho Chi Minh City",
      "Hanoi",
      "Da Nang",
      "Hoi An",
      "Hue",
      "Ha Long Bay",
      "Ninh Binh",
      "Sapa",
      "Can Tho",
      "Phu Quoc",
      "Nha Trang",
      "Da Lat",
      "Mui Ne",
      "Phnom Penh",
      "Siem Reap",
      "Battambang"
    ];

    // Hotel options with star ratings: {name: "Hotel Name", stars: 4}
    const HOTEL_OPTIONS = {
      "Ho Chi Minh City": [
        {name: "Liberty Central Saigon Riverside", stars: 4},
        {name: "Au Lac Charner Hotel", stars: 3},
        {name: "Hotel Nikko Saigon", stars: 5},
        {name: "Majestic Saigon Hotel", stars: 4},
        {name: "Rex Hotel Saigon", stars: 4},
        {name: "Caravelle Saigon", stars: 5},
        {name: "Park Hyatt Saigon", stars: 5},
        {name: "Silverland Jolie Hotel", stars: 4},
        {name: "Alagon D'antique Hotel & Spa", stars: 4},
        {name: "La Siesta Premium Saigon", stars: 4},
        {name: "Saigon Star Hotel", stars: 3},
        {name: "Elios Hotel Saigon", stars: 3},
        {name: "Tan Hoang Long Hotel", stars: 3},
        {name: "Mekong Homestay (Can Tho area)", stars: 0}
      ],
      "Hanoi": [
        {name: "La Siesta Classic Ma May", stars: 4},
        {name: "Hanoi Pearl Hotel", stars: 4},
        {name: "Apricot Hotel Hanoi", stars: 4},
        {name: "Sofitel Legend Metropole Hanoi", stars: 5},
        {name: "Peridot Grand Hotel & Spa", stars: 4},
        {name: "MK Premier Boutique Hotel", stars: 4},
        {name: "Hanoi La Siesta Trendy", stars: 4},
        {name: "Acoustic Hotel & Spa", stars: 4},
        {name: "Oriental Suite Hotel & Spa", stars: 4},
        {name: "The Oriental Jade Hotel", stars: 4},
        {name: "Hanoi Backpackers Hostel", stars: 3},
        {name: "Hanoi Old Quarter Hotel", stars: 3},
        {name: "Hanoi Elegance Diamond Hotel", stars: 3},
        {name: "Mai Chau Homestay", stars: 0}
      ],
      "Da Nang": [
        {name: "Brilliant Hotel Da Nang", stars: 4},
        {name: "Novotel Danang Premier Han River", stars: 5},
        {name: "Sala Da Nang Beach Hotel", stars: 4},
        {name: "Premier Village Danang Resort", stars: 5},
        {name: "TMS Hotel Da Nang Beach", stars: 4},
        {name: "A La Carte Da Nang Beach", stars: 4},
        {name: "Rosamia Da Nang Hotel", stars: 4},
        {name: "Grand Mercure Danang", stars: 5},
        {name: "Furama Resort Danang", stars: 5},
        {name: "Fivitel Boutique Hotel Da Nang", stars: 3},
        {name: "Sanouva Hotel Da Nang", stars: 3},
        {name: "Brilliant Hotel Da Nang", stars: 3}
      ],
      "Hoi An": [
        {name: "Little Riverside Hoi An", stars: 4},
        {name: "Almanity Hoi An Resort & Spa", stars: 4},
        {name: "Ann Retreat Resort & Spa", stars: 4},
        {name: "La Siesta Hoi An Resort & Spa", stars: 4},
        {name: "Allegro Hoi An", stars: 4},
        {name: "Anantara Hoi An Resort", stars: 5},
        {name: "Lantana Riverside Hoi An", stars: 4},
        {name: "Victoria Hoi An Beach Resort & Spa", stars: 5},
        {name: "Vinh Hung Riverside Resort", stars: 4},
        {name: "Hoi An Historic Hotel", stars: 3},
        {name: "Thanh Binh Riverside Hoi An", stars: 3},
        {name: "Hoi An Ancient House Resort", stars: 3},
        {name: "Tra Que Vegetable Village Homestay", stars: 0},
        {name: "Cam Thanh Coconut Village Homestay", stars: 0}
      ],
      "Hue": [
        {name: "Eldora Hotel Hue", stars: 4},
        {name: "Silk Path Grand Hue", stars: 5},
        {name: "Moonlight Hotel Hue", stars: 4},
        {name: "Saigon Morin Hotel", stars: 4},
        {name: "Imperial Hotel Hue", stars: 4},
        {name: "Pilgrimage Village Boutique Resort & Spa", stars: 4},
        {name: "Hotel La Perle", stars: 4},
        {name: "Huong Giang Hotel Resort & Spa", stars: 4},
        {name: "Hue Serene Palace Hotel", stars: 3},
        {name: "Hue Nino Hotel", stars: 3},
        {name: "Thien An Garden Homestay", stars: 0}
      ],
      "Ha Long Bay": [
        {name: "Orchid Cruise Ha Long", stars: 5},
        {name: "Paradise Elegance Cruise", stars: 5},
        {name: "Bhaya Classic Cruise", stars: 4},
        {name: "Indochina Sails", stars: 4},
        {name: "Stellar of the Seas", stars: 5},
        {name: "Heritage Line Cruise", stars: 5},
        {name: "Peony Cruise", stars: 4},
        {name: "Alisa Premier Cruise", stars: 4},
        {name: "Swan Cruise Ha Long", stars: 3},
        {name: "Dragon Pearl Junk", stars: 3},
        {name: "Aclass Legend Cruise", stars: 3}
      ],
      "Ninh Binh": [
        {name: "Tam Coc Garden Resort", stars: 4},
        {name: "Emeralda Resort Ninh Binh", stars: 4},
        {name: "Ninh Binh Hidden Charm Hotel", stars: 4},
        {name: "Tam Coc La Montagne Resort & Spa", stars: 4},
        {name: "Mua Caves Ecolodge", stars: 3},
        {name: "Tam Coc Rice Fields Resort", stars: 4},
        {name: "Ninh Binh Legend Hotel", stars: 3},
        {name: "Tam Coc Bungalow", stars: 3},
        {name: "Tam Coc Homestay", stars: 0},
        {name: "Trang An Homestay", stars: 0}
      ],
      "Sapa": [
        {name: "Aira Boutique Sapa Hotel & Spa", stars: 4},
        {name: "Victoria Sapa Resort & Spa", stars: 4},
        {name: "Silk Path Grand Resort & Spa Sapa", stars: 5},
        {name: "KK Sapa Hotel", stars: 3},
        {name: "Sapa Horizon Hotel", stars: 3},
        {name: "U Sapa Hotel", stars: 3},
        {name: "Pao's Sapa Leisure Hotel", stars: 4},
        {name: "Sapa Lodge Hotel", stars: 3},
        {name: "Sapa Highland Resort & Spa", stars: 3},
        {name: "Ta Van Village Homestay", stars: 0},
        {name: "Lao Chai Village Homestay", stars: 0},
        {name: "Cat Cat Village Homestay", stars: 0}
      ],
      "Can Tho": [
        {name: "Victoria Can Tho Resort", stars: 4},
        {name: "Azerai Can Tho", stars: 5},
        {name: "Muong Thanh Luxury Can Tho", stars: 4},
        {name: "TTC Hotel Premium Can Tho", stars: 4},
        {name: "Nesta Hotel Can Tho", stars: 3},
        {name: "Iris Hotel Can Tho", stars: 3},
        {name: "Can Tho Eco Lodge", stars: 3},
        {name: "Mekong Riverside Hotel", stars: 3},
        {name: "Mekong Delta Homestay (Cai Be)", stars: 0},
        {name: "Mekong Delta Homestay (Vinh Long)", stars: 0}
      ],
      "Phu Quoc": [
        {name: "Salinda Resort Phu Quoc", stars: 5},
        {name: "Fusion Resort Phu Quoc", stars: 5},
        {name: "InterContinental Phu Quoc Long Beach", stars: 5},
        {name: "Vinpearl Resort & Spa Phu Quoc", stars: 5},
        {name: "JW Marriott Phu Quoc Emerald Bay", stars: 5},
        {name: "La Veranda Resort Phu Quoc", stars: 4},
        {name: "Novotel Phu Quoc Resort", stars: 4},
        {name: "Dusit Princess Moonrise Beach Resort", stars: 5},
        {name: "Phu Quoc Ocean View Hotel", stars: 3},
        {name: "Phu Quoc Sea Breeze Resort", stars: 3}
      ],
      "Nha Trang": [
        {name: "InterContinental Nha Trang", stars: 5},
        {name: "Sheraton Nha Trang Hotel & Spa", stars: 5},
        {name: "Mia Resort Nha Trang", stars: 5},
        {name: "Amiana Resort Nha Trang", stars: 5},
        {name: "Novotel Nha Trang", stars: 4},
        {name: "Sunrise Nha Trang Beach Hotel & Spa", stars: 4},
        {name: "Nha Trang Lodge Hotel", stars: 3},
        {name: "Golden Sea Hotel Nha Trang", stars: 3},
        {name: "Asia Paradise Hotel Nha Trang", stars: 3}
      ],
      "Da Lat": [
        {name: "Ana Mandara Villas Dalat Resort & Spa", stars: 5},
        {name: "Dalat Palace Heritage Hotel", stars: 4},
        {name: "Terracotta Hotel & Resort Dalat", stars: 4},
        {name: "Swiss-Belresort Tuyen Lam Dalat", stars: 4},
        {name: "Du Parc Hotel Dalat", stars: 4},
        {name: "Ngoc Lan Hotel Dalat", stars: 3},
        {name: "Dalat Edensee Lake Resort & Spa", stars: 3},
        {name: "Tulip Hotel Dalat", stars: 3},
        {name: "Dalat Homestay (Countryside)", stars: 0}
      ],
      "Mui Ne": [
        {name: "Anantara Mui Ne Resort", stars: 5},
        {name: "Sailing Club Resort Mui Ne", stars: 4},
        {name: "Pandanus Resort Mui Ne", stars: 4},
        {name: "Victoria Phan Thiet Beach Resort & Spa", stars: 4},
        {name: "The Cliff Resort & Residences", stars: 4},
        {name: "Sandunes Beach Resort & Spa", stars: 4},
        {name: "Mui Ne Hills Budget Hotel", stars: 3},
        {name: "Sea Links Beach Resort", stars: 3}
      ],
      "Phnom Penh": [
        {name: "The Plantation Urban Resort & Spa", stars: 4},
        {name: "Sun & Moon Urban Hotel", stars: 3},
        {name: "Rosewood Phnom Penh", stars: 5},
        {name: "Raffles Hotel Le Royal", stars: 5},
        {name: "Hyatt Regency Phnom Penh", stars: 5},
        {name: "Blue Lime Hotel Phnom Penh", stars: 3},
        {name: "Frangipani Villa Hotel", stars: 3},
        {name: "Okay 1 Guesthouse", stars: 3}
      ],
      "Siem Reap": [
        {name: "Lotus Blanc Resort", stars: 4},
        {name: "Tara Angkor Hotel", stars: 4},
        {name: "Somadevi Angkor Boutique", stars: 4},
        {name: "Sofitel Angkor Phokeethra", stars: 5},
        {name: "Raffles Grand d'Angkor", stars: 5},
        {name: "Anantara Angkor Resort", stars: 5},
        {name: "Golden Temple Residence", stars: 3},
        {name: "Angkor Wat Hotel", stars: 3},
        {name: "Siem Reap Pub Hostel", stars: 3},
        {name: "Village Homestay (Siem Reap countryside)", stars: 0}
      ],
      "Battambang": [
        {name: "Bambu Hotel Battambang", stars: 3},
        {name: "Classy Hotel Battambang", stars: 3},
        {name: "Royal Hotel Battambang", stars: 3},
        {name: "Battambang Homestay", stars: 0}
      ],
      "Phong Nha": [
        {name: "Phong Nha Farmstay", stars: 3},
        {name: "Easy Tiger Hostel", stars: 3},
        {name: "Phong Nha Lake House Resort", stars: 3},
        {name: "Phong Nha Homestay", stars: 0}
      ],
      "Mai Chau": [
        {name: "Mai Chau Lodge", stars: 3},
        {name: "Mai Chau Ecolodge", stars: 3},
        {name: "Mai Chau Valley View Homestay", stars: 0},
        {name: "Lac Village Homestay", stars: 0}
      ]
    };

    const ACTIVITIES = {
      "Ho Chi Minh City": {
        morning: [
          "Guided visit of the War Remnants Museum and the Reunification Palace.",
          "Walking tour through Dong Khoi Street and the French colonial quarter.",
          "Cu Chi Tunnels half-day excursion (underground network tour).",
          "Notre Dame Cathedral and Central Post Office visit.",
          "Jade Emperor Pagoda and Thien Hau Temple tour.",
          "Independence Palace guided tour.",
          "Saigon Skydeck observation deck visit."
        ],
        afternoon: [
          "Ben Thanh Market & local coffee workshop.",
          "Cu Chi Tunnels (half-day, may be combined with morning).",
          "French Quarter walking tour with colonial architecture.",
          "Mekong Delta day trip to My Tho and Ben Tre.",
          "Saigon River boat tour.",
          "Art galleries and museums in District 1.",
          "Local cooking class with market visit."
        ],
        evening: [
          "Saigon rooftop bar experience & night street food tour.",
          "Dinner cruise on the Saigon River with live music.",
          "Ben Thanh Night Market exploration.",
          "A O Show or traditional Vietnamese cultural performance.",
          "Bui Vien Walking Street (backpacker area).",
          "Rooftop bar hopping in District 1.",
          "Local beer and street food experience."
        ]
      },
      "Hanoi": {
        morning: [
          "City tour: Ho Chi Minh complex, One Pillar Pagoda and Tran Quoc Pagoda.",
          "Cyclo ride in the Old Quarter, including local market visit.",
          "Ho Chi Minh Mausoleum and Presidential Palace visit.",
          "West Lake and Tran Quoc Pagoda walk.",
          "Train Street visit (famous narrow street with train tracks).",
          "Dong Xuan Market exploration.",
          "Hoa Lo Prison Museum (Hanoi Hilton) tour."
        ],
        afternoon: [
          "Temple of Literature and Ethnology Museum.",
          "Ethnology Museum and Old Quarter walking tour.",
          "Water Puppet Show at Thang Long Theatre.",
          "St. Joseph's Cathedral and surrounding French Quarter.",
          "Vietnamese Women's Museum visit.",
          "Old Quarter 36 streets walking tour.",
          "Art galleries and craft workshops in the Old Quarter."
        ],
        evening: [
          "Street food tour around Hoan Kiem Lake.",
          "Beer corner & local bar experience in the Old Quarter.",
          "Hoan Kiem Lake night walk and Ngoc Son Temple.",
          "Traditional Vietnamese music performance.",
          "Rooftop bar with views of the Old Quarter.",
          "Night market shopping in the Old Quarter.",
          "Local caf√© culture experience (egg coffee)."
        ]
      },
      "Da Nang": {
        morning: [
          "Ba Na Hills ‚Äì Golden Bridge & French Village (early departure).",
          "Relaxed beach time on My Khe Beach.",
          "Marble Mountains (Ngu Hanh Son) exploration and cave visits.",
          "Son Tra Peninsula (Monkey Mountain) and Lady Buddha statue.",
          "Dragon Bridge and Han River waterfront walk.",
          "Cham Museum visit (largest collection of Cham artifacts).",
          "My Khe Beach water sports (kayaking, jet skiing)."
        ],
        afternoon: [
          "Marble Mountains & Linh Ung Pagoda.",
          "Han Market & local coffee break.",
          "Ba Na Hills ‚Äì Golden Bridge & French Village (if not done in morning).",
          "Non Nuoc Beach relaxation.",
          "Local craft villages (marble carving, pottery).",
          "Dragon Bridge photo opportunity.",
          "Han River promenade walk and caf√© culture."
        ],
        evening: [
          "Han River cruise to see the bridges at night.",
          "Free time to explore bars and caf√©s along the river.",
          "Dragon Bridge fire and water show (weekends).",
          "Seafood dinner at a beachfront restaurant.",
          "Sky36 Rooftop Bar with panoramic city views.",
          "Han Market night food stalls.",
          "Riverside bars and live music venues."
        ]
      },
      "Hoi An": {
        morning: [
          "Basket boat tour in the Coconut Forest with local fisherman experience.",
          "Cooking class & local market visit.",
          "Tra Que Vegetable Village bicycle tour.",
          "Thanh Ha Pottery Village visit.",
          "Cam Thanh Coconut Village eco-tour.",
          "An Bang Beach morning relaxation.",
          "Hoi An Ancient Town early morning photography walk."
        ],
        afternoon: [
          "Walking tour of Hoi An Ancient Town (UNESCO).",
          "Free time for tailor fittings and shopping.",
          "Japanese Covered Bridge and Assembly Halls visit.",
          "Museum of Folk Culture and History.",
          "Kim Bong Carpentry Village tour.",
          "Cua Dai Beach or An Bang Beach time.",
          "Lantern making workshop."
        ],
        evening: [
          "Lantern boat ride on the river & Old Town by night.",
          "Romantic dinner in the Ancient Town.",
          "Hoi An Night Market exploration.",
          "Traditional music performance at a local venue.",
          "Riverside caf√©s and bars.",
          "Lantern-lit streets photography walk.",
          "Cooking class dinner experience."
        ]
      },
      "Hue": {
        morning: [
          "Boat trip on the Perfume River to Thien Mu Pagoda.",
          "Visit the Imperial Citadel (UNESCO).",
          "Royal Tombs tour (Khai Dinh, Tu Duc, or Minh Mang).",
          "Dong Ba Market exploration.",
          "Thien Mu Pagoda and Perfume River boat ride.",
          "Imperial City guided tour with history insights.",
          "Cycling tour around the Citadel walls."
        ],
        afternoon: [
          "Visit the Royal Tombs (Khai Dinh or Tu Duc).",
          "Incense village & conical hat village stop.",
          "Thien Mu Pagoda (if not done in morning).",
          "Dong Ba Market shopping and local food.",
          "Royal Fine Arts Museum visit.",
          "Perfume River cruise with traditional music.",
          "Local craft villages (incense, conical hats, bronze casting)."
        ],
        evening: [
          "Dinner with royal-style Hue cuisine.",
          "Free evening to explore riverside caf√©s.",
          "Truong Tien Bridge walk and night views.",
          "Royal-style dinner at a traditional restaurant.",
          "Perfume River night cruise.",
          "Local bars and caf√©s along the river.",
          "Traditional Hue music performance."
        ]
      },
      "Ha Long Bay": {
        morning: [
          "Check in to cruise and start sailing among the limestone karsts.",
          "Kayaking or bamboo boat ride in a quiet lagoon.",
          "Surprise Cave (Sung Sot Cave) exploration.",
          "Ti Top Island beach and hiking.",
          "Floating fishing village visit (Cua Van or Vung Vieng).",
          "Luon Cave kayaking through narrow passages.",
          "Cruise departure and first views of limestone karsts."
        ],
        afternoon: [
          "Visit a cave or floating village in Ha Long Bay.",
          "Cooking demonstration on board the cruise.",
          "Pearl Farm visit and demonstration.",
          "Swimming and sunbathing on the sundeck.",
          "Tai Chi session on deck.",
          "Cave exploration (Surprise Cave, Thien Cung Cave).",
          "Bamboo boat ride through floating village."
        ],
        evening: [
          "Sunset on deck with welcome drink.",
          "Squid fishing or relaxing onboard activities.",
          "Sunset party with cocktails and snacks.",
          "Dinner on board with fresh seafood.",
          "Night squid fishing experience.",
          "Karaoke or board games on board.",
          "Stargazing on the sundeck (weather permitting)."
        ]
      },
      "Ninh Binh": {
        morning: [
          "Boat trip through the caves in Tam Coc or Trang An.",
          "Cycling through rice fields and local villages.",
          "Trang An Scenic Landscape Complex boat tour.",
          "Tam Coc boat ride through rice fields and caves.",
          "Hoa Lu Ancient Capital visit (Dinh and Le temples).",
          "Bai Dinh Pagoda complex tour (largest pagoda in Vietnam).",
          "Early morning photography of rice terraces."
        ],
        afternoon: [
          "Visit Bich Dong Pagoda or Bai Dinh Pagoda.",
          "Viewpoint hike at Mua Cave for panorama of Ninh Binh.",
          "Bich Dong Pagoda (three-level cave pagoda).",
          "Cycling tour through countryside and villages.",
          "Van Long Nature Reserve boat trip.",
          "Local craft village visit (embroidery, weaving).",
          "Cuc Phuong National Park visit (if time permits)."
        ],
        evening: [
          "Relax at the lodge with countryside views.",
          "Optional walk or bicycle ride at sunset.",
          "Sunset viewing from Mua Cave viewpoint.",
          "Countryside lodge dinner with local specialties.",
          "Evening walk through rice fields.",
          "Local homestay cultural exchange.",
          "Stargazing in the peaceful countryside."
        ]
      },
      "Sapa": {
        morning: [
          "Guided trekking through minority villages around Sapa.",
          "Visit a local market (depending on day).",
          "Cat Cat Village trek and waterfall visit.",
          "Fansipan cable car to Indochina's highest peak.",
          "Lao Chai and Ta Van villages trekking.",
          "Silver Waterfall and Love Waterfall visit.",
          "Ham Rong Mountain flower garden and viewpoint."
        ],
        afternoon: [
          "Continue trekking through rice terraces and valleys.",
          "Visit a local family for tea and cultural exchange.",
          "Y Linh Ho village trek through rice terraces.",
          "Local homestay experience and traditional lunch.",
          "Bamboo forest trekking.",
          "Local handicraft workshops (weaving, silver making).",
          "Muong Hoa Valley exploration."
        ],
        evening: [
          "Free time in Sapa town for dinner and shopping.",
          "Relax at the hotel or enjoy a massage after trekking.",
          "Sapa night market and local food.",
          "Traditional Hmong or Red Dao cultural show.",
          "Local restaurant with mountain views.",
          "Evening walk around Sapa Lake.",
          "Hot stone bath experience (Red Dao tradition)."
        ]
      },
      "Can Tho": {
        morning: [
          "Early boat trip to Cai Rang floating market.",
          "Visit small canals and local fruit gardens.",
          "Cai Rang Floating Market (largest in Mekong Delta).",
          "Phong Dien Floating Market visit.",
          "Boat trip through narrow canals and arroyos.",
          "Local fruit orchards and garden visits.",
          "Traditional sampan boat ride."
        ],
        afternoon: [
          "Cycle or walk through villages along the Mekong canals.",
          "Visit a local rice noodle or rice paper workshop.",
          "Binh Thuy Ancient House visit.",
          "Mekong Delta countryside cycling tour.",
          "Local workshops (rice paper, coconut candy, rice wine).",
          "Coconut processing factory visit.",
          "Mekong Delta homestay experience."
        ],
        evening: [
          "Riverside dinner in Can Tho.",
          "Free evening to explore Ninh Kieu Pier promenade.",
          "Ninh Kieu Pier night market and food stalls.",
          "Mekong River sunset cruise.",
          "Local seafood dinner by the river.",
          "Evening walk along the waterfront.",
          "Traditional music performance."
        ]
      },
      "Phu Quoc": {
        morning: [
          "Relax on the beach or by the pool.",
          "Optional snorkelling or boat trip to nearby islands.",
          "Snorkelling tour to An Thoi Archipelago.",
          "Sao Beach (most beautiful beach on the island).",
          "Phu Quoc National Park hiking.",
          "Starfish Beach visit.",
          "Cable car to Hon Thom Island."
        ],
        afternoon: [
          "Visit a fish sauce factory or pepper farm.",
          "Explore Phu Quoc National Park or a local waterfall (seasonal).",
          "Phu Quoc Pearl Farm visit.",
          "Coconut Prison historical site.",
          "Dinh Cau Night Market preparation and local food.",
          "Beach relaxation and water sports.",
          "Local pepper and fish sauce factory tours."
        ],
        evening: [
          "Dinner at the night market in Duong Dong.",
          "Beachfront drinks at a sunset bar.",
          "Duong Dong Night Market food tour.",
          "Sunset viewing at Dinh Cau Rock.",
          "Beachfront seafood dinner.",
          "Rooftop bar with ocean views.",
          "Beach bonfire and stargazing."
        ]
      },
      "Nha Trang": {
        morning: [
          "Island-hopping boat trip with snorkelling.",
          "Relaxed beachfront morning in Nha Trang.",
          "Snorkelling and diving at Hon Mun Marine Park.",
          "VinWonders Theme Park visit.",
          "Po Nagar Cham Towers visit.",
          "Long Son Pagoda and White Buddha statue.",
          "Nha Trang Beach water sports (parasailing, jet skiing)."
        ],
        afternoon: [
          "Mud bath & spa experience.",
          "Visit Po Nagar Cham Towers and Long Son Pagoda.",
          "Thap Ba Hot Springs mud bath.",
          "Hon Chong Promontory visit.",
          "Dam Market shopping.",
          "Beach relaxation and swimming.",
          "Oceanographic Institute visit."
        ],
        evening: [
          "Seafood dinner at a local restaurant.",
          "Free time to enjoy Nha Trang's nightlife and seafront promenade.",
          "Nha Trang Night Market exploration.",
          "Seafront promenade walk.",
          "Rooftop bars with ocean views.",
          "Local seafood restaurants.",
          "Beachfront bars and live music."
        ]
      },
      "Da Lat": {
        morning: [
          "City tour: Bao Dai's Summer Palace, Crazy House or Da Lat Railway Station.",
          "Visit local flower gardens and Xuan Huong Lake.",
          "Crazy House (Hang Nga Guesthouse) visit.",
          "Bao Dai's Summer Palace tour.",
          "Da Lat Railway Station and old steam train.",
          "Xuan Huong Lake walk and paddle boating.",
          "Flower gardens (Valley of Love, Flower Park)."
        ],
        afternoon: [
          "Visit coffee farm and waterfall in the countryside.",
          "Cable car to Truc Lam Pagoda (if operating).",
          "Elephant Falls and Datanla Falls visit.",
          "Coffee plantation tour and tasting.",
          "Truc Lam Zen Monastery cable car ride.",
          "Countryside motorbike tour.",
          "Local strawberry farms and flower farms."
        ],
        evening: [
          "Explore Da Lat night market.",
          "Relax in a caf√© with local coffee and cool mountain air.",
          "Da Lat Night Market food tour.",
          "Local caf√© culture (famous for coffee).",
          "Evening walk around Xuan Huong Lake.",
          "Traditional music performance.",
          "Rooftop bars with mountain views."
        ]
      },
      "Mui Ne": {
        morning: [
          "Sunrise visit to the white sand dunes of Mui Ne.",
          "Walk along the Fairy Stream (Suoi Tien).",
          "White Sand Dunes sunrise and sandboarding.",
          "Red Sand Dunes visit.",
          "Fairy Stream (Suoi Tien) walk through red canyons.",
          "Fishing village visit and morning market.",
          "Beach sunrise viewing."
        ],
        afternoon: [
          "Relax at the resort or on the beach.",
          "Optional kitesurfing or watersports (seasonal).",
          "Kitesurfing lessons (best kitesurfing spot in Vietnam).",
          "Beach relaxation and swimming.",
          "Poshanu Cham Towers visit.",
          "Mui Ne Beach water sports.",
          "Local seafood lunch by the beach."
        ],
        evening: [
          "Seafood dinner by the sea.",
          "Free time to enjoy beach bars and the sound of the ocean.",
          "Beachfront seafood restaurants.",
          "Sunset viewing at the sand dunes.",
          "Beach bars and nightlife.",
          "Night fishing experience.",
          "Beach bonfire and stargazing."
        ]
      },
      "Mekong Delta": {
        morning: [
          "Early boat trip to Cai Rang floating market (largest in Mekong Delta).",
          "Phong Dien Floating Market visit (smaller, more authentic).",
          "Boat trip through narrow canals and arroyos.",
          "Local fruit orchards and garden visits.",
          "Traditional sampan boat ride through waterways.",
          "Cai Be floating market exploration.",
          "Rural village bicycle ride through countryside."
        ],
        afternoon: [
          "Cycle or walk through villages along the Mekong canals.",
          "Visit a local rice noodle or rice paper workshop.",
          "Coconut processing factory and coconut candy making.",
          "Local workshops (rice paper, coconut candy, rice wine).",
          "Mekong Delta countryside cycling tour.",
          "Binh Thuy Ancient House visit.",
          "Mekong Delta homestay experience and local lunch."
        ],
        evening: [
          "Riverside dinner in Can Tho or local homestay.",
          "Free evening to explore Ninh Kieu Pier promenade.",
          "Ninh Kieu Pier night market and food stalls.",
          "Mekong River sunset cruise.",
          "Local seafood dinner by the river.",
          "Evening walk along the waterfront.",
          "Traditional music performance and cultural exchange."
        ]
      },
      "Phong Nha": {
        morning: [
          "Paradise Cave exploration (largest dry cave in the world).",
          "Phong Nha Cave boat ride through underground river.",
          "Son Doong Cave information center visit (world's largest cave).",
          "Dark Cave adventure (ziplining, mud bath, kayaking).",
          "Phong Nha-Ke Bang National Park hiking.",
          "Botanical Garden and wildlife spotting.",
          "Early morning photography of karst landscapes."
        ],
        afternoon: [
          "Phong Nha highlights tour with local guide.",
          "Eco-trail with local guide through jungle.",
          "Nuoc Mooc Eco Trail (swimming, ziplining, suspension bridges).",
          "Eight Ladies Cave and war history visit.",
          "Local village visit and cultural exchange.",
          "Cave exploration (Tien Son Cave or Paradise Cave).",
          "Countryside cycling tour around Phong Nha."
        ],
        evening: [
          "Relax at farmstay or eco-lodge.",
          "Dinner by the river with local specialties.",
          "Sunset viewing over karst mountains.",
          "Local bar and restaurant in Phong Nha town.",
          "Evening walk through countryside.",
          "Stargazing in the peaceful rural setting.",
          "Traditional Vietnamese dinner at homestay."
        ]
      },
      "Battambang": {
        morning: [
          "Bamboo Train (Norry) ride through countryside.",
          "Phnom Sampeau (Killing Caves) visit and bat cave viewing.",
          "Wat Banan temple complex (11th century Angkorian temple).",
          "Battambang Provincial Museum visit.",
          "Early morning market visit and local breakfast.",
          "Cycling tour through rural villages.",
          "Traditional Khmer architecture walking tour."
        ],
        afternoon: [
          "Phare Ponleu Selpak circus school visit and performance.",
          "Local craft workshops (rice paper making, fish paste).",
          "Kamping Puoy Lake visit and boat ride.",
          "Wat Ek Phnom temple ruins exploration.",
          "Battambang countryside cycling tour.",
          "Local pottery and weaving village visits.",
          "Traditional Khmer cooking class."
        ],
        evening: [
          "Sunset viewing from Phnom Sampeau.",
          "Battambang night market exploration.",
          "Riverside dinner along the Sangker River.",
          "Traditional Khmer dance performance.",
          "Local bars and restaurants in the old French quarter.",
          "Evening walk along the riverfront.",
          "Cultural exchange with local families."
        ]
      }
    };

    const state = {
      traveller: {},
      daysData: [],
      selectedItineraryTemplate: null // Store selected brief/detailed itinerary template
    };

    // =======================
    // VHT ITINERARY LIBRARY
    // =======================

    const briefItineraries = {
      4: {
        id: "vn-4-taste",
        name: "Vietnam in 4 Days ‚Äì Saigon & Mekong Snapshot",
        destinations: "Ho Chi Minh City, Mekong Delta",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Ho Chi Minh City, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Short but sweet introduction to Vietnam. Start in Ho Chi Minh City with a city highlights tour and Old Quarter. Day trip to Ninh Binh (Trang An or Tam Coc + viewpoints). Finish with a mini-cruise in Ha Long or Bai Tu Long Bay before departure.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh City: Arrival, orientation walk and rooftop sunset.",
          "Day 2 ‚Äì Saigon City Highlights: Independence Palace, Notre Dame, Post Office, War Remnants Museum, Ben Thanh Market.",
          "Day 3 ‚Äì Mekong Delta Day Trip: My Tho, boat ride, canals, local houses, honey tea and fruits.",
          "Day 4 ‚Äì Free time & departure from Ho Chi Minh City."
        ]
      },
      6: {
        id: "vn-6-coast",
        name: "Vietnam in 6 Days ‚Äì Saigon, Mekong & Central Coast",
        destinations: "Ho Chi Minh City, Mekong Delta, Da Nang, Hoi An",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Da Nang / Hoi An, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "From busy Saigon to charming Hoi An. This 6-day itinerary takes you from the dynamic Ho Chi Minh City and the serene Mekong Delta to the enchanting ancient town of Hoi An.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh City: Arrival and evening in the city center.",
          "Day 2 ‚Äì Saigon City Tour: Main landmarks + local street food experience.",
          "Day 3 ‚Äì Mekong Delta: Boat trip, canals, local crafts and village life.",
          "Day 4 ‚Äì Fly to Da Nang, transfer to Hoi An, evening lanterns in Ancient Town.",
          "Day 5 ‚Äì Hoi An Old Town & countryside: Walking tour + basket boat or Tra Que village.",
          "Day 6 ‚Äì Free time in Hoi An (beach/old town) and onward departure."
        ]
      },
      8: {
        id: "vn-8-classic",
        name: "Vietnam in 8 Days ‚Äì Classic Highlights South to Central",
        destinations: "Ho Chi Minh City, Mekong Delta, Cu Chi, Da Nang, Hoi An",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Da Nang / Hoi An, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Saigon, Mekong Delta, Da Nang & Hoi An. This 8-day itinerary offers a comprehensive journey through the highlights of Southern and Central Vietnam.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh City: Arrival, easy evening in District 1.",
          "Day 2 ‚Äì Saigon City Highlights: Independence Palace, Cathedral, Post Office, War Museum, Ben Thanh.",
          "Day 3 ‚Äì Cu Chi Tunnels: Half-day visit to the underground network + free afternoon.",
          "Day 4 ‚Äì Mekong Delta: Boat trip, floating/local markets, canals and village lunch.",
          "Day 5 ‚Äì Fly to Da Nang, transfer to Hoi An, lantern-lit evening by the river.",
          "Day 6 ‚Äì Hoi An Old Town: Walking tour, Japanese Bridge, assembly halls, local crafts.",
          "Day 7 ‚Äì Countryside Experience: Tra Que village & coconut basket boats OR beach day.",
          "Day 8 ‚Äì Free time in Hoi An and departure from Da Nang."
        ]
      },
      10: {
        id: "vn-10-discovery",
        name: "Vietnam in 10 Days ‚Äì South, Central & a Taste of the North",
        destinations: "Ho Chi Minh City, Mekong Delta, Da Nang, Hoi An, Ba Na Hills, Hanoi, Ninh Binh",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Hanoi, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Saigon, Mekong, Hoi An and Hanoi snapshot. This 10-day itinerary offers a comprehensive journey through the highlights of Southern, Central, and Northern Vietnam.",
        days: [
          "Day 1‚Äì2 ‚Äì Ho Chi Minh City: Arrival + full city tour and Cu Chi Tunnels.",
          "Day 3 ‚Äì Mekong Delta: Day trip with boat, canals, local farms and lunch.",
          "Day 4 ‚Äì Fly to Da Nang, transfer to Hoi An, evening in Ancient Town.",
          "Day 5 ‚Äì Hoi An: Walking tour + Tra Que & coconut palm forest.",
          "Day 6 ‚Äì Ba Na Hills: Golden Bridge, cable car, French Village.",
          "Day 7 ‚Äì Fly Da Nang ‚Üí Hanoi, Old Quarter orientation.",
          "Day 8 ‚Äì Hanoi City Tour: Ho Chi Minh complex, Temple of Literature, Old Quarter.",
          "Day 9 ‚Äì Ninh Binh day trip: Hoa Lu, Trang An or Tam Coc, viewpoints.",
          "Day 10 ‚Äì Free time in Hanoi and departure."
        ]
      },
      12: {
        id: "vn-12-highlights",
        name: "Vietnam in 12 Days ‚Äì Highlights with Ha Long Bay",
        destinations: "Ho Chi Minh City, Mekong Delta, Da Nang, Hoi An, Ba Na Hills, Hanoi, Ha Long Bay",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Hanoi, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Saigon, Mekong, Hoi An, Hanoi & Ha Long. This 12-day itinerary combines the vibrant energy of Southern Vietnam with the cultural richness of the Central region and the breathtaking natural beauty of the North, including an iconic Ha Long Bay cruise.",
        days: [
          "Days 1‚Äì3 ‚Äì Ho Chi Minh City & Cu Chi: Arrival, full city tour, half-day Cu Chi Tunnels.",
          "Day 4 ‚Äì Mekong Delta: My Tho/Ben Tre boat trip, village visit and local lunch.",
          "Day 5 ‚Äì Fly to Da Nang, transfer to Hoi An, sunset in Ancient Town.",
          "Day 6 ‚Äì Hoi An countryside: Tra Que & coconut basket boats.",
          "Day 7 ‚Äì Ba Na Hills: Golden Bridge, cable car, Fantasy Park.",
          "Day 8 ‚Äì Fly Da Nang ‚Üí Hanoi, evening Old Quarter.",
          "Day 9 ‚Äì Hanoi City Highlights: Ho Chi Minh complex, Temple of Literature, Old Quarter.",
          "Day 10 ‚Äì Hanoi ‚Üí Ha Long / Bai Tu Long: Board overnight cruise, kayaking & caves.",
          "Day 11 ‚Äì Morning on the bay, brunch on cruise, return to Hanoi.",
          "Day 12 ‚Äì Free time in Hanoi and departure."
        ]
      },
      14: {
        id: "vn-14-immersion",
        name: "Private Vietnam Trip 14 Days 13 Nights ‚Äì Vietnam Immersion",
        destinations: "Hanoi, Ninh Binh, Ha Long Bay, Da Nang, Hoi An, Ho Chi Minh City, Mekong Delta, Can Tho",
        startsIn: "Hanoi, Vietnam",
        endsIn: "Ho Chi Minh City, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "This 14-day Vietnam Immersion itinerary begins in Hanoi with history, culture and a full Ninh Binh experience, continues through Ha Long Bay and Central Vietnam (Da Nang, Ba Na Hills, Hoi An), and ends in Ho Chi Minh City with Mekong Delta and Cu Chi Tunnels highlights.",
        days: [
          "Day 1 ‚Äì Arrival in Hanoi.",
          "Day 2 ‚Äì Full-day Hanoi city tour.",
          "Day 3 ‚Äì Ninh Binh full-day (Trang An + Hoa Lu).",
          "Day 4 ‚Äì Hanoi ‚Üí Ha Long Bay cruise.",
          "Day 5 ‚Äì Ha Long Bay ‚Üí Hanoi ‚Üí Fly to Da Nang.",
          "Day 6 ‚Äì Ba Na Hills full-day.",
          "Day 7 ‚Äì Hoi An walking tour (from Da Nang).",
          "Day 8 ‚Äì Da Nang city tour.",
          "Day 9 ‚Äì Free day in Da Nang.",
          "Day 10 ‚Äì Fly Da Nang ‚Üí Ho Chi Minh City.",
          "Day 11 ‚Äì HCMC highlights + Cu Chi Tunnels.",
          "Day 12 ‚Äì Mekong Delta ‚Üí Can Tho.",
          "Day 13 ‚Äì Cai Rang Floating Market ‚Üí HCMC.",
          "Day 14 ‚Äì Departure from Ho Chi Minh."
        ]
      },
      16: {
        id: "vn-16-grand",
        name: "Vietnam in 16 Days ‚Äì Coastline & Culture",
        destinations: "Hanoi, Ninh Binh, Ha Long Bay, Da Nang, Hoi An, Ba Na Hills, Ho Chi Minh City, Mekong Delta, Can Tho",
        startsIn: "Hanoi, Vietnam",
        endsIn: "Ho Chi Minh City, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Adds more free time and coastal relaxation. This 16-day itinerary offers an extensive exploration of Vietnam's grand highlights, from the cultural richness of the North through the historical charm of the Central region, to the vibrant energy of the South.",
        days: [
          "Days 1‚Äì3 ‚Äì Hanoi & Ninh Binh: City tour + Hoa Lu/Trang An day trip.",
          "Days 4‚Äì5 ‚Äì Ha Long Bay cruise with overnight on board.",
          "Days 6‚Äì9 ‚Äì Da Nang & Hoi An: Ba Na Hills, Hoi An town, Da Nang city tour, free beach day.",
          "Day 10 ‚Äì Fly to Ho Chi Minh City, evening street life.",
          "Days 11‚Äì12 ‚Äì Saigon city & Cu Chi Tunnels.",
          "Days 13‚Äì14 ‚Äì Mekong Delta & Can Tho: Local life, boat trips, Cai Rang floating market.",
          "Days 15‚Äì16 ‚Äì Extra free day in Saigon for shopping/spa and departure."
        ]
      },
      18: {
        id: "vn-18-extended",
        name: "Vietnam in 18 Days ‚Äì Extended North & Central",
        destinations: "Hanoi, Ninh Binh, Ha Long Bay, Da Nang, Hoi An, Ba Na Hills, Ho Chi Minh City, Mekong Delta, Can Tho",
        startsIn: "Hanoi, Vietnam",
        endsIn: "Ho Chi Minh City, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "More time in Hanoi, Ninh Binh, Hoi An and Saigon. This 18-day itinerary offers a comprehensive journey through Vietnam, starting from the vibrant Ho Chi Minh City in the South, moving through the cultural heart of the Central region, and concluding in the historical capital of Hanoi in the North.",
        days: [
          "Days 1‚Äì3 ‚Äì Hanoi: City highlights + food and coffee experiences.",
          "Days 4‚Äì5 ‚Äì Ninh Binh: Two days of boat trips, temples and viewpoints.",
          "Days 6‚Äì7 ‚Äì Ha Long / Bai Tu Long: Cruise, caves, kayaking.",
          "Days 8‚Äì11 ‚Äì Da Nang & Hoi An: Ba Na Hills, walking tour, countryside, beach/free time.",
          "Day 12 ‚Äì Fly to Saigon, evening city lights.",
          "Days 13‚Äì14 ‚Äì Ho Chi Minh City & Cu Chi Tunnels.",
          "Days 15‚Äì16 ‚Äì Mekong Delta: 2-day program with local stays and Can Tho.",
          "Days 17‚Äì18 ‚Äì Free days in Saigon for shopping, massages and departure."
        ]
      },
      20: {
        id: "vn-20-signature",
        name: "Vietnam in 20 Days ‚Äì Vietnam & Inland Valleys",
        destinations: "Hanoi, Ninh Binh, Ha Long Bay, Da Nang, Hoi An, Ba Na Hills, Hue, Ho Chi Minh City, Mekong Delta",
        startsIn: "Hanoi, Vietnam",
        endsIn: "Ho Chi Minh City, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Adds extra countryside and rural experiences. This 20-day itinerary offers a comprehensive journey through Vietnam, from the vibrant Ho Chi Minh City in the South, through the cultural heart of the Central region, to the historical capital of Hanoi and the majestic landscapes of the North.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh City arrival.",
          "Day 2 ‚Äì Full-day Ho Chi Minh City tour.",
          "Day 3 ‚Äì Mekong Delta full-day excursion.",
          "Day 4 ‚Äì Cu Chi Tunnels half-day tour.",
          "Day 5 ‚Äì Fly Ho Chi Minh ‚Üí Da Nang, transfer to Hoi An.",
          "Day 6 ‚Äì Hoi An Ancient Town walking tour (half-day).",
          "Day 7 ‚Äì Tra Que Vegetable Village & Coconut Palm Forest.",
          "Day 8 ‚Äì Free day in Hoi An.",
          "Day 9 ‚Äì Ba Na Hills full day ‚Üí overnight Da Nang.",
          "Day 10 ‚Äì Da Nang city full-day tour.",
          "Day 11 ‚Äì Da Nang ‚Üí Hue full-day city tour, overnight in Hue.",
          "Day 12 ‚Äì Hue ‚Üí Fly to Hanoi.",
          "Day 13 ‚Äì Hanoi city full-day tour.",
          "Day 14 ‚Äì Hoa Lu ‚Äì Trang An ‚Äì Mua Cave full-day tour.",
          "Day 15 ‚Äì Extra day in Ninh Binh for slower exploration and village walks.",
          "Day 16 ‚Äì Hanoi ‚Üí Sapa by limousine bus.",
          "Day 17 ‚Äì Sapa trekking: Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van.",
          "Day 18 ‚Äì Fansipan Peak ‚Üí Hanoi by limousine bus.",
          "Day 19 ‚Äì Hanoi ‚Üí Ha Long Bay, overnight cruise.",
          "Day 20 ‚Äì Ha Long Bay ‚Üí Hanoi, free time and departure."
        ]
      },
      21: {
        id: "vn-21-symphony",
        name: "Private Vietnam 21 Days 20 Nights ‚Äì Symphony of Vietnam",
        destinations: "Ho Chi Minh City, Mekong Delta, Da Nang, Hoi An, Hue, Hanoi, Ninh Binh, Sapa, Ha Long Bay",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Hanoi, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Let the Symphony of Vietnam be your personal 21-day, 20-night odyssey from vibrant Ho Chi Minh City and the Mekong Delta to charming Hoi An and Hue, and on to Hanoi, Ninh Binh, Sapa and Ha Long Bay. This journey blends culture, history and landscapes into one seamless, private experience.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh City arrival.",
          "Day 2 ‚Äì Full-day Ho Chi Minh City tour.",
          "Day 3 ‚Äì Mekong Delta full-day excursion.",
          "Day 4 ‚Äì Cu Chi Tunnels half-day tour.",
          "Day 5 ‚Äì Fly Ho Chi Minh ‚Üí Da Nang, transfer to Hoi An.",
          "Day 6 ‚Äì Hoi An Ancient Town walking tour (half-day).",
          "Day 7 ‚Äì Tra Que Vegetable Village & Coconut Palm Forest.",
          "Day 8 ‚Äì Free day in Hoi An.",
          "Day 9 ‚Äì Ba Na Hills full day ‚Üí overnight Da Nang.",
          "Day 10 ‚Äì Da Nang city full-day tour.",
          "Day 11 ‚Äì Da Nang ‚Üí Hue full-day city tour, overnight in Hue.",
          "Day 12 ‚Äì Hue ‚Üí Fly to Hanoi.",
          "Day 13 ‚Äì Hanoi city full-day tour.",
          "Day 14 ‚Äì Hoa Lu ‚Äì Trang An ‚Äì Mua Cave full-day tour.",
          "Day 15 ‚Äì Hanoi ‚Üí Sapa by limousine bus.",
          "Day 16 ‚Äì Sapa trekking: Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van.",
          "Day 17 ‚Äì Fansipan Peak ‚Üí Hanoi by limousine bus.",
          "Day 18 ‚Äì Hanoi ‚Üí Ha Long Bay, overnight cruise.",
          "Day 19 ‚Äì Ha Long Bay ‚Üí Hanoi.",
          "Day 20 ‚Äì Hanoi ‚Äì Quang Phu Cau Incense Village.",
          "Day 21 ‚Äì Departure from Hanoi."
        ]
      },
      22: {
        id: "vn-22-panorama",
        name: "Vietnam Panorama ‚Äì 22 Days",
        destinations: "Ho Chi Minh City, Mekong Delta, Cai Be, Vinh Long, Cat Tien, Da Lat, Da Nang, Hoi An, Ba Na Hills, Hue, Phong Nha, Hanoi, Ninh Binh, Cuc Phuong, Ha Giang, Ha Long Bay, Lan Ha Bay",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Hanoi, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Based on your 22D/21N South‚ÄìNorth panorama. This comprehensive journey takes you through Vietnam's diverse landscapes, from the bustling South to the majestic North, including the spectacular Ha Giang loop.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh City arrival.",
          "Day 2 ‚Äì Ho Chi Minh City & Cu Chi Tunnels.",
          "Day 3 ‚Äì Ho Chi Minh ‚Äì Cai Be ‚Äì Floating Market ‚Äì Cu Lao An Binh ‚Äì Vinh Long.",
          "Day 4 ‚Äì Ho Chi Minh ‚Äì Cat Tien National Park.",
          "Day 5 ‚Äì Ho Chi Minh ‚Äì Fly to Da Lat ‚Äì Waterfalls tour.",
          "Day 6 ‚Äì Da Lat ‚Äì Natural countryside landscapes.",
          "Day 7 ‚Äì Dalat ‚Äì Fly to Danang ‚Äì Hoi An.",
          "Day 8 ‚Äì Hoi An basket boat, Tra Que Village & Ancient Town tour.",
          "Day 9 ‚Äì Hoi An cooking class & My Son Sanctuary.",
          "Day 10 ‚Äì Hoi An ‚Äì Da Nang ‚Äì Ba Na Hills full day.",
          "Day 11 ‚Äì Da Nang city half-day tour.",
          "Day 12 ‚Äì Danang ‚Äì Hue City full-day tour.",
          "Day 13 ‚Äì Hue ‚Äì Phong Nha Cave ‚Äì Train to Ha Noi.",
          "Day 14 ‚Äì Ha Noi ‚Äì Ha Noi half-day tour.",
          "Day 15 ‚Äì Ha Noi ‚Äì Bai Dinh ‚Äì Trang An ‚Äì Mua Cave full-day tour.",
          "Day 16 ‚Äì Ninh Binh ‚Äì Cuc Phuong National Park ‚Äì Ha Noi.",
          "Day 17 ‚Äì Ha Noi ‚Äì Ha Giang City (group tour).",
          "Day 18 ‚Äì Ha Giang City ‚Äì Quan Ba ‚Äì Yen Minh ‚Äì Dong Van Town (group tour).",
          "Day 19 ‚Äì Dong Van ‚Äì Meo Vac (group tour).",
          "Day 20 ‚Äì Ha Giang ‚Äì Ha Noi.",
          "Day 21 ‚Äì Ha Noi ‚Äì Tuan Chau ‚Äì Ha Long Bay ‚Äì Lan Ha Bay ‚Äì Tra Bau.",
          "Day 22 ‚Äì Lan Ha Bay ‚Äì Cat Ba Island ‚Äì Tuan Chau ‚Äì Ha Noi departure."
        ]
      },
      24: {
        id: "vn-24-deep",
        name: "Vietnam in 24 Days ‚Äì Deep Discovery",
        destinations: "Ho Chi Minh City, Mekong Delta, Nha Trang, Da Lat, Da Nang, Hoi An, Ba Na Hills, Hue, Hanoi, Ninh Binh, Sapa, Ha Long Bay",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Hanoi, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Adds more slow days on top of the 22-day panorama. This 24-day itinerary offers a deep dive into Vietnam's culture, history, and natural beauty with a relaxed pace.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh City arrival.",
          "Day 2 ‚Äì Ho Chi Minh City & Cu Chi Tunnels.",
          "Day 3 ‚Äì Ho Chi Minh ‚Äì Mekong Delta full day.",
          "Day 4 ‚Äì Ho Chi Minh ‚Äì Cu Chi Tunnels half day.",
          "Day 5 ‚Äì Ho Chi Minh ‚Äì Fly to Nha Trang.",
          "Day 6 ‚Äì Nha Trang city & mud spa tour.",
          "Day 7 ‚Äì Nha Trang free day.",
          "Day 8 ‚Äì Nha Trang ‚Äì Da Lat by private car.",
          "Day 9 ‚Äì Da Lat city tour.",
          "Day 10 ‚Äì Da Lat free day.",
          "Day 11 ‚Äì Da Lat ‚Äì Fly to Da Nang ‚Äì Hoi An.",
          "Day 12 ‚Äì Hoi An walking tour & Tra Que / basket boat.",
          "Day 13 ‚Äì Hoi An free day (tailors, beach or spa).",
          "Day 14 ‚Äì Hoi An ‚Äì Ba Na Hills full day ‚Äì Da Nang.",
          "Day 15 ‚Äì Da Nang city full-day tour.",
          "Day 16 ‚Äì Da Nang ‚Äì Hue City full-day tour.",
          "Day 17 ‚Äì Hue ‚Äì Fly to Ha Noi.",
          "Day 18 ‚Äì Ha Noi city full day.",
          "Day 19 ‚Äì Ha Noi ‚Äì Hoa Lu ‚Äì Trang An ‚Äì Mua Cave.",
          "Day 20 ‚Äì Ha Noi ‚Äì Sa Pa by limousine bus.",
          "Day 21 ‚Äì Sa Pa trekking ‚Äì Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van.",
          "Day 22 ‚Äì Sa Pa ‚Äì Fansipan Peak ‚Äì Ha Noi.",
          "Day 23 ‚Äì Ha Noi free day (caf√©s, museums and shopping).",
          "Day 24 ‚Äì Ha Noi ‚Äì Ha Long Bay overnight cruise ‚Äì Ha Noi departure."
        ]
      },
      26: {
        id: "vn-26-explorer",
        name: "Vietnam in 26 Days ‚Äì Mountains, Coast & Countryside",
        destinations: "Ho Chi Minh City, Mekong Delta, Nha Trang, Da Lat, Da Nang, Hoi An, Ba Na Hills, Hue, Hanoi, Ninh Binh, Sapa, Mai Chau, Ha Long Bay",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Hanoi, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Very slow version including mountains and valleys. This 26-day itinerary offers an in-depth exploration of Vietnam's diverse regions, from the vibrant South to the majestic North, with extra time for relaxation and cultural immersion.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh City arrival.",
          "Day 2 ‚Äì Ho Chi Minh City full day.",
          "Day 3 ‚Äì Ho Chi Minh ‚Äì Mekong Delta full day.",
          "Day 4 ‚Äì Ho Chi Minh ‚Äì Cu Chi Tunnels half day.",
          "Day 5 ‚Äì Ho Chi Minh ‚Äì Fly to Nha Trang.",
          "Day 6 ‚Äì Nha Trang city & mud spa tour.",
          "Day 7 ‚Äì Nha Trang free day.",
          "Day 8 ‚Äì Nha Trang ‚Äì Da Lat by private car.",
          "Day 9 ‚Äì Da Lat city tour.",
          "Day 10 ‚Äì Da Lat free day (extra relaxed exploration).",
          "Day 11 ‚Äì Da Lat ‚Äì Fly to Da Nang ‚Äì Hoi An.",
          "Day 12 ‚Äì Hoi An walking tour & Tra Que / basket boat.",
          "Day 13 ‚Äì Hoi An free day.",
          "Day 14 ‚Äì Hoi An ‚Äì Ba Na Hills full day ‚Äì Da Nang.",
          "Day 15 ‚Äì Da Nang city full-day tour.",
          "Day 16 ‚Äì Da Nang ‚Äì Hue City full-day tour.",
          "Day 17 ‚Äì Hue free day (extra relaxed exploration).",
          "Day 18 ‚Äì Hue ‚Äì Fly to Ha Noi.",
          "Day 19 ‚Äì Ha Noi city full day.",
          "Day 20 ‚Äì Ha Noi ‚Äì Hoa Lu ‚Äì Trang An ‚Äì Mua Cave.",
          "Day 21 ‚Äì Ninh Binh ‚Äì Cuc Phuong National Park ‚Äì Ha Noi (additional village walks).",
          "Day 22 ‚Äì Ha Noi ‚Äì Ha Giang City (group tour).",
          "Day 23 ‚Äì Ha Giang City ‚Äì Quan Ba ‚Äì Yen Minh ‚Äì Dong Van Town (group tour).",
          "Day 24 ‚Äì Dong Van ‚Äì Meo Vac (group tour) ‚Äì Ha Noi.",
          "Day 25 ‚Äì Ha Noi ‚Äì Ha Long Bay overnight cruise.",
          "Day 26 ‚Äì Ha Long Bay ‚Äì Ha Noi departure."
        ]
      },
      28: {
        id: "vn-28-month",
        name: "Vietnam in 28 Days ‚Äì Almost a Full Month",
        destinations: "Ho Chi Minh City, Mekong Delta, Can Tho, Nha Trang, Da Lat, Da Nang, Hoi An, Ba Na Hills, Hue, Hanoi, Ninh Binh, Sapa, Mai Chau, Ha Long Bay",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Hanoi, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "Near full-month program based on your 30-day tour. This 28-day itinerary follows most of the 30-day 'Vietnam Full Month' route, offering a comprehensive journey through Vietnam's highlights with a balanced mix of excursions and rest days.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh (Saigon) arrival.",
          "Day 2 ‚Äì Ho Chi Minh ‚Äì Cai Be ‚Äì Floating Market ‚Äì An Binh Island ‚Äì Vinh Long ‚Äì Can Tho.",
          "Day 3 ‚Äì Cai Rang Floating Market ‚Äì local Mekong life ‚Äì return to Ho Chi Minh City.",
          "Day 4 ‚Äì Fly from Ho Chi Minh City to Nha Trang ‚Äì beach city arrival.",
          "Day 5 ‚Äì Nha Trang city highlights & mud spa experience.",
          "Day 6 ‚Äì Free day in Nha Trang (beach & relaxation).",
          "Day 7 ‚Äì Scenic private-car transfer Nha Trang ‚Üí Da Lat.",
          "Day 8 ‚Äì Da Lat city tour (Bao Dai Palace, cable car, pagodas, waterfalls, flower park).",
          "Day 9 ‚Äì Free day in romantic Da Lat.",
          "Day 10 ‚Äì Fly Da Lat ‚Üí Da Nang, transfer to Hoi An.",
          "Day 11 ‚Äì Hoi An walking tour, Tra Que Village & basket boat in Coconut Forest.",
          "Day 12 ‚Äì Full day Ba Na Hills & Golden Bridge from Hoi An.",
          "Day 13 ‚Äì Half-day My Son Sanctuary, afternoon free in Hoi An.",
          "Day 14 ‚Äì Free day in Hoi An (beach / lantern town).",
          "Day 15 ‚Äì Hoi An ‚Üí Marble Mountain ‚Üí Hai Van Pass ‚Üí Hue.",
          "Day 16 ‚Äì Full-day Hue city tour (tombs, pagodas, Perfume River, market).",
          "Day 17 ‚Äì Fly Hue ‚Üí Hanoi, free evening in the capital.",
          "Day 18 ‚Äì Hanoi city afternoon tour by Jeep with street food & local life.",
          "Day 19 ‚Äì Full-day Bai Dinh ‚Äì Trang An boat trip ‚Äì Mua Cave viewpoint.",
          "Day 20 ‚Äì Quang Phu Cau incense village (craft & photography).",
          "Day 21 ‚Äì Hanoi ‚Üí Sapa by limousine bus, free time in Sapa.",
          "Day 22 ‚Äì Sapa trekking: Cat Cat ‚Äì Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van.",
          "Day 23 ‚Äì Sapa waterfalls & viewpoints: O Quy Ho, Silver Waterfall, Love Waterfall, Heaven Gate.",
          "Day 24 ‚Äì Fansipan cable car excursion, afternoon limousine bus back to Hanoi.",
          "Day 25 ‚Äì Free day in Hanoi (shopping / optional activities).",
          "Day 26 ‚Äì Hanoi ‚Üí Mai Chau valley, biking through minority villages.",
          "Day 27 ‚Äì Morning walk in Mai Chau villages, afternoon return to Hanoi.",
          "Day 28 ‚Äì Hanoi ‚Üí Ha Long Bay cruise, caves & sunset, return to Hanoi for departure."
        ]
      },
      30: {
        id: "vn-30-full-month",
        name: "Private Vietnam 30 Days 29 Nights ‚Äì Vietnam Full Month",
        destinations: "Ho Chi Minh City, Can Tho, Nha Trang, Da Lat, Da Nang, Hoi An, Hue, Hanoi, Ninh Binh, Sapa, Mai Chau, Ha Long Bay",
        startsIn: "Ho Chi Minh City, Vietnam",
        endsIn: "Hanoi, Vietnam",
        tourType: "Private tour",
        travelStyle: "Highlight Tours, Classic Tours, Family Tours, Luxury Tours",
        intro: "This incredible 30-day private tour unveils the diverse beauty and rich culture of Vietnam, from the bustling streets of Ho Chi Minh City to the serene landscapes of Ha Long Bay. You'll journey through vibrant floating markets, ancient temples, charming historical towns like Hoi An and Hue, and the stunning mountain scenery of Sapa and Mai Chau. Experience bustling city life, tranquil countryside, and breathtaking natural wonders in one comprehensive itinerary.",
        days: [
          "Day 1 ‚Äì Ho Chi Minh (Saigon) arrival",
          "Day 2 ‚Äì Ho Chi Minh ‚Äì Cai Be ‚Äì Floating Market ‚Äì An Binh Island ‚Äì Vinh Long ‚Äì Can Tho",
          "Day 3 ‚Äì Cai Rang Floating Market ‚Äì local Mekong life ‚Äì return to Ho Chi Minh City",
          "Day 4 ‚Äì Fly from Ho Chi Minh City to Nha Trang ‚Äì beach city arrival",
          "Day 5 ‚Äì Nha Trang city highlights & mud spa experience",
          "Day 6 ‚Äì Free day in Nha Trang (beach & relaxation)",
          "Day 7 ‚Äì Scenic private-car transfer Nha Trang ‚Üí Da Lat",
          "Day 8 ‚Äì Da Lat city tour (Bao Dai Palace, cable car, pagodas, waterfalls, flower park)",
          "Day 9 ‚Äì Free day in romantic Da Lat",
          "Day 10 ‚Äì Fly Da Lat ‚Üí Da Nang, transfer to Hoi An",
          "Day 11 ‚Äì Hoi An walking tour, Tra Que Village & basket boat in Coconut Forest",
          "Day 12 ‚Äì Full day Ba Na Hills & Golden Bridge from Hoi An",
          "Day 13 ‚Äì Half-day My Son Sanctuary, afternoon free in Hoi An",
          "Day 14 ‚Äì Free day in Hoi An (beach / lantern town)",
          "Day 15 ‚Äì Hoi An ‚Üí Marble Mountain ‚Üí Hai Van Pass ‚Üí Hue",
          "Day 16 ‚Äì Full-day Hue city tour (tombs, pagodas, Perfume River, market)",
          "Day 17 ‚Äì Fly Hue ‚Üí Hanoi, free evening in the capital",
          "Day 18 ‚Äì Hanoi city afternoon tour by Jeep with street food & local life",
          "Day 19 ‚Äì Full-day Bai Dinh ‚Äì Trang An boat trip ‚Äì Mua Cave viewpoint",
          "Day 20 ‚Äì Quang Phu Cau incense village (craft & photography)",
          "Day 21 ‚Äì Hanoi ‚Üí Sapa by limousine bus, free time in Sapa",
          "Day 22 ‚Äì Sapa trekking: Cat Cat ‚Äì Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van",
          "Day 23 ‚Äì Sapa waterfalls & viewpoints: O Quy Ho, Silver Waterfall, Love Waterfall, Heaven Gate",
          "Day 24 ‚Äì Fansipan cable car excursion, afternoon limousine bus back to Hanoi",
          "Day 25 ‚Äì Free day in Hanoi (shopping / optional activities)",
          "Day 26 ‚Äì Hanoi ‚Üí Mai Chau valley, biking through minority villages",
          "Day 27 ‚Äì Morning walk in Mai Chau villages, afternoon return to Hanoi",
          "Day 28 ‚Äì Hanoi ‚Üí Ha Long Bay (La Regina Classic Cruise), caves & sunset",
          "Day 29 ‚Äì Ha Long Bay floating village, brunch on board, return to Hanoi",
          "Day 30 ‚Äì Free time in Hanoi & departure transfer to the airport"
        ]
      }
    };

    const detailedItineraries = {
      4: {
        id: "vn-4-taste-detailed",
        name: "Vietnam in 4 Days ‚Äì Saigon & Mekong Snapshot (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & Orientation", details: "Arrive at Tan Son Nhat International Airport (SGN), where you'll be met by your private driver and transferred to your hotel in the city center. After check-in, enjoy free time to relax or take an orientation walk around the bustling streets of District 1. In the evening, consider a rooftop bar for sunset views over the city." },
          { day: 2, title: "Saigon City Highlights Tour", details: "Embark on a full-day city tour of Ho Chi Minh City. Visit the historic Reunification Palace, the iconic Notre Dame Cathedral, and the Central Post Office. Explore the War Remnants Museum to understand Vietnam's recent history, and immerse yourself in the vibrant atmosphere of Ben Thanh Market. Lunch will be served at a local restaurant, offering authentic Vietnamese cuisine." },
          { day: 3, title: "Mekong Delta Discovery (My Tho & Ben Tre)", details: "Take a full-day excursion to the Mekong Delta. Drive to My Tho, where you'll take a boat trip on the Mekong River. Visit various islands, enjoy a sampan ride through narrow canals lined with coconut palms, and experience local life. Sample fresh fruits, enjoy honey tea, and visit a coconut candy workshop. Lunch will be served at a local restaurant on one of the islands before returning to Ho Chi Minh City in the late afternoon." },
          { day: 4, title: "Ho Chi Minh City Departure", details: "Enjoy a leisurely breakfast at your hotel. Depending on your flight schedule, you'll have free time for last-minute souvenir shopping or a final stroll. Your private driver will transfer you to Tan Son Nhat International Airport (SGN) for your onward departure." }
        ]
      },
      6: {
        id: "vn-6-coast-detailed",
        name: "Vietnam in 6 Days ‚Äì Saigon, Mekong & Central Coast (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & Evening Exploration", details: "Arrive at Tan Son Nhat International Airport (SGN), meet your private driver, and transfer to your hotel in Ho Chi Minh City. After check-in, enjoy a free evening to explore the vibrant city center, perhaps with a street food tour or a visit to Ben Thanh Night Market." },
          { day: 2, title: "Saigon City Tour & Street Food", details: "Discover Ho Chi Minh City's iconic landmarks including the Reunification Palace, Notre Dame Cathedral, and Central Post Office. Delve into the local culture with a guided street food experience, sampling various Vietnamese delicacies. Visit the War Remnants Museum for historical insights. Lunch at a local restaurant." },
          { day: 3, title: "Mekong Delta Full Day Excursion", details: "Journey to the Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, explore lush islands, and take a traditional sampan ride through narrow canals. Visit local workshops to see coconut candy making and honey bee farms. Enjoy a fresh local lunch before returning to Ho Chi Minh City." },
          { day: 4, title: "Fly to Da Nang & Transfer to Hoi An", details: "After breakfast, transfer to Tan Son Nhat Airport for your flight to Da Nang. Upon arrival, meet your driver and transfer directly to your hotel in Hoi An. In the evening, immerse yourself in the magical atmosphere of Hoi An Ancient Town, illuminated by thousands of lanterns." },
          { day: 5, title: "Hoi An Old Town & Countryside Discovery", details: "Begin with a walking tour of Hoi An Ancient Town, a UNESCO World Heritage site. Explore the Japanese Covered Bridge, Phuc Kien Assembly Hall, and traditional houses. In the afternoon, choose between a fun basket boat ride in the Coconut Forest or a visit to Tra Que Vegetable Village for a hands-on farming experience. Enjoy a local lunch." },
          { day: 6, title: "Hoi An Departure", details: "Enjoy a leisurely breakfast and free time in Hoi An for last-minute shopping, relaxing at the beach, or enjoying a coffee by the river. Your private driver will transfer you to Da Nang International Airport (DAD) for your onward flight." }
        ]
      },
      8: {
        id: "vn-8-classic-detailed",
        name: "Vietnam in 8 Days ‚Äì Classic Highlights South to Central (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & Leisure", details: "Arrive at Tan Son Nhat International Airport (SGN), where your private driver will meet you and transfer you to your hotel in Ho Chi Minh City. After check-in, enjoy a relaxed evening, perhaps with a stroll around the vibrant city center or a quiet dinner." },
          { day: 2, title: "Saigon City Highlights Tour", details: "Explore the iconic landmarks of Ho Chi Minh City on a full-day tour. Visit the Reunification Palace, Notre Dame Cathedral, and the historic Central Post Office. Gain insights into the Vietnam War at the War Remnants Museum, and experience the lively atmosphere of Ben Thanh Market. Lunch will be at a local restaurant." },
          { day: 3, title: "Cu Chi Tunnels Half-Day Excursion", details: "In the morning, embark on a half-day trip to the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers during the war. Learn about their ingenious living conditions and guerrilla tactics. You'll have the afternoon free back in Ho Chi Minh City for personal exploration or relaxation." },
          { day: 4, title: "Mekong Delta Full-Day Discovery", details: "Journey to the lush Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, visit local floating markets (if applicable), and explore traditional villages. Experience a sampan ride through narrow canals and savor a local lunch amidst the tranquil scenery before returning to Ho Chi Minh City." },
          { day: 5, title: "Fly to Da Nang & Transfer to Hoi An", details: "After breakfast, transfer to Tan Son Nhat Airport for your flight to Da Nang. Upon arrival, your private driver will transfer you directly to your hotel in Hoi An. In the evening, take a leisurely walk through the enchanting lantern-lit streets of Hoi An Ancient Town." },
          { day: 6, title: "Hoi An Ancient Town Walking Tour", details: "Discover the charm of Hoi An Ancient Town, a UNESCO World Heritage site, on a guided walking tour. Visit the iconic Japanese Covered Bridge, the Phuc Kien Assembly Hall, and a traditional merchant's house. Explore the bustling local market and learn about Hoi An's rich history as a trading port. Enjoy a local lunch." },
          { day: 7, title: "Hoi An Countryside Experience or Beach Day", details: "Today, choose your preferred activity: either a delightful countryside experience including a visit to Tra Que Vegetable Village for a hands-on farming lesson and a fun basket boat ride in the Coconut Forest, or a relaxing day at An Bang Beach. Lunch will be arranged according to your choice. Enjoy the evening at leisure in Hoi An." },
          { day: 8, title: "Hoi An Departure", details: "Enjoy a final breakfast in Hoi An. Depending on your flight schedule, you'll have free time for last-minute souvenir shopping or a final stroll through the ancient town. Your private driver will transfer you to Da Nang International Airport (DAD) for your onward departure." }
        ]
      },
      10: {
        id: "vn-10-discovery-detailed",
        name: "Vietnam in 10 Days ‚Äì South, Central & a Taste of the North (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & City Orientation", details: "Arrive at Tan Son Nhat International Airport (SGN), where your private driver will meet you and transfer you to your hotel in Ho Chi Minh City. After check-in, enjoy a relaxed evening, perhaps with an orientation walk around the vibrant city center." },
          { day: 2, title: "Saigon City Tour & Cu Chi Tunnels", details: "Morning: Visit the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers. Afternoon: Explore Ho Chi Minh City's highlights including the Reunification Palace, Notre Dame Cathedral, Central Post Office, and Ben Thanh Market. Lunch will be at a local restaurant." },
          { day: 3, title: "Mekong Delta Full-Day Excursion", details: "Journey to the lush Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, visit local markets, and explore traditional villages. Experience a sampan ride through narrow canals and savor a local lunch amidst the tranquil scenery before returning to Ho Chi Minh City." },
          { day: 4, title: "Fly to Da Nang & Transfer to Hoi An", details: "After breakfast, transfer to Tan Son Nhat Airport for your flight to Da Nang. Upon arrival, your private driver will transfer you directly to your hotel in Hoi An. In the evening, take a leisurely walk through the enchanting lantern-lit streets of Hoi An Ancient Town." },
          { day: 5, title: "Hoi An Ancient Town & Countryside Discovery", details: "Begin with a walking tour of Hoi An Ancient Town, a UNESCO World Heritage site. Explore the Japanese Covered Bridge, Phuc Kien Assembly Hall, and traditional houses. In the afternoon, choose between a fun basket boat ride in the Coconut Forest or a visit to Tra Que Vegetable Village for a hands-on farming experience. Enjoy a local lunch." },
          { day: 6, title: "Ba Na Hills Full-Day Excursion", details: "Embark on a full-day trip to Ba Na Hills. Take the world's longest cable car ride to the summit, visit the iconic Golden Bridge, explore the beautiful Le Jardin D'Amour gardens, Linh Ung Pagoda, and enjoy the French Village and Fantasy Park. Buffet lunch included. Return to Hoi An in the late afternoon." },
          { day: 7, title: "Fly to Hanoi & Old Quarter Orientation", details: "After breakfast, transfer to Da Nang Airport for your flight to Hanoi. Upon arrival, your private driver will meet you and transfer you to your hotel. Enjoy a free evening to explore Hanoi's bustling Old Quarter, perhaps with a cyclo ride or a street food tour." },
          { day: 8, title: "Hanoi City Highlights Tour", details: "Discover Hanoi's rich history and culture on a full-day city tour. Visit the Ho Chi Minh Complex (Mausoleum exterior, Presidential Palace, Stilt House), One Pillar Pagoda, and the Temple of Literature. Explore the vibrant Old Quarter and enjoy a traditional water puppet show. Lunch at a local restaurant." },
          { day: 9, title: "Ninh Binh Full-Day Excursion", details: "Take a full-day trip to Ninh Binh, often called 'Ha Long Bay on land.' Visit Hoa Lu, Vietnam's ancient capital, and take a scenic boat trip through the stunning karst landscapes of Trang An or Tam Coc. Climb to the Mua Cave viewpoint for panoramic views of the rice fields and rivers. Lunch at a local restaurant. Return to Hanoi in the late afternoon." },
          { day: 10, title: "Hanoi Departure", details: "Enjoy a leisurely breakfast at your hotel. Depending on your flight schedule, you'll have free time for last-minute souvenir shopping or a final stroll. Your private driver will transfer you to Noi Bai International Airport (HAN) for your onward departure." }
        ]
      },
      12: {
        id: "vn-12-highlights-detailed",
        name: "Vietnam in 12 Days ‚Äì Highlights with Ha Long Bay (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & Leisure", details: "Arrive at Tan Son Nhat International Airport (SGN), where your private driver will meet you and transfer you to your hotel in Ho Chi Minh City. After check-in, enjoy a relaxed evening, perhaps with a stroll around the vibrant city center or a quiet dinner." },
          { day: 2, title: "Saigon City Tour & Cu Chi Tunnels", details: "Morning: Visit the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers. Learn about their ingenious living conditions and guerrilla tactics. Afternoon: Explore Ho Chi Minh City's highlights including the Reunification Palace, Notre Dame Cathedral, Central Post Office, and Ben Thanh Market. Lunch will be at a local restaurant." },
          { day: 3, title: "Mekong Delta Full-Day Excursion", details: "Journey to the lush Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, visit local markets, and explore traditional villages. Experience a sampan ride through narrow canals and savor a local lunch amidst the tranquil scenery before returning to Ho Chi Minh City." },
          { day: 4, title: "Fly to Da Nang & Transfer to Hoi An", details: "After breakfast, transfer to Tan Son Nhat Airport for your flight to Da Nang. Upon arrival, your private driver will transfer you directly to your hotel in Hoi An. In the evening, take a leisurely walk through the enchanting lantern-lit streets of Hoi An Ancient Town." },
          { day: 5, title: "Hoi An Ancient Town & Countryside Discovery", details: "Begin with a walking tour of Hoi An Ancient Town, a UNESCO World Heritage site. Explore the Japanese Covered Bridge, Phuc Kien Assembly Hall, and traditional houses. In the afternoon, choose between a fun basket boat ride in the Coconut Forest or a visit to Tra Que Vegetable Village for a hands-on farming experience. Enjoy a local lunch." },
          { day: 6, title: "Ba Na Hills Full-Day Excursion", details: "Embark on a full-day trip to Ba Na Hills. Take the world's longest cable car ride to the summit, visit the iconic Golden Bridge, explore the beautiful Le Jardin D'Amour gardens, Linh Ung Pagoda, and enjoy the French Village and Fantasy Park. Buffet lunch included. Return to Hoi An in the late afternoon." },
          { day: 7, title: "Fly to Hanoi & Old Quarter Orientation", details: "After breakfast, transfer to Da Nang Airport for your flight to Hanoi. Upon arrival, your private driver will meet you and transfer you to your hotel. Enjoy a free evening to explore Hanoi's bustling Old Quarter, perhaps with a cyclo ride or a street food tour." },
          { day: 8, title: "Hanoi City Highlights Tour", details: "Discover Hanoi's rich history and culture on a full-day city tour. Visit the Ho Chi Minh Complex (Mausoleum exterior, Presidential Palace, Stilt House), One Pillar Pagoda, and the Temple of Literature. Explore the vibrant Old Quarter and enjoy a traditional water puppet show. Lunch at a local restaurant." },
          { day: 9, title: "Hanoi ‚Üí Ha Long Bay Overnight Cruise", details: "After breakfast, transfer to Ha Long Bay. Upon arrival, embark on an overnight cruise. Enjoy a welcome drink, lunch, and explore a stunning cave. Participate in kayaking or swimming activities, enjoy a sunset party, and a cooking class before dinner onboard. Overnight on the cruise." },
          { day: 10, title: "Ha Long Bay Morning & Return to Hanoi", details: "Start your day with Tai Chi on the sundeck. Enjoy breakfast and visit a floating village or another cave. Brunch will be served onboard as the cruise sails back to the harbor. Disembark and transfer back to your hotel in Hanoi. Enjoy a free evening." },
          { day: 11, title: "Ninh Binh Full-Day Excursion", details: "Take a full-day trip to Ninh Binh, often called 'Ha Long Bay on land.' Visit Hoa Lu, Vietnam's ancient capital, and take a scenic boat trip through the stunning karst landscapes of Trang An or Tam Coc. Climb to the Mua Cave viewpoint for panoramic views of the rice fields and rivers. Lunch at a local restaurant. Return to Hanoi in the late afternoon." },
          { day: 12, title: "Hanoi Departure", details: "Enjoy a leisurely breakfast at your hotel. Depending on your flight schedule, you'll have free time for last-minute souvenir shopping or a final stroll. Your private driver will transfer you to Noi Bai International Airport (HAN) for your onward departure." }
        ]
      },
      14: {
        id: "vn-14-immersion-detailed",
        name: "Private Vietnam Trip 14 Days 13 Nights ‚Äì Vietnam Immersion (Detailed)",
        days: [
          { day: 1, title: "Arrival in Hanoi", details: "Arrival at Noi Bai Airport, meet guide, transfer to hotel, overnight." },
          { day: 2, title: "Hanoi City Tour Full Day", details: "Ho Chi Minh Complex, One Pillar Pagoda, Temple of Literature, lunch, museums, Train Street, Old Quarter." },
          { day: 3, title: "Ninh Binh Full Day", details: "Trang An boat ride, lunch, Hoa Lu ancient capital, return to Hanoi." },
          { day: 4, title: "Hanoi ‚Äì Ha Long Bay", details: "Transfer to Ha Long, cruise, cave visit, sunset party, cooking class, dinner onboard." },
          { day: 5, title: "Ha Long ‚Äì Fly to Da Nang", details: "Tai Chi, breakfast, cave visit, brunch, disembark, transfer to Hanoi airport, flight to Da Nang, hotel check-in." },
          { day: 6, title: "Ba Na Hills Full Day", details: "Cable car to Ba Na Hills, Golden Bridge, gardens, pagoda, Fantasy Park, buffet lunch, French Village, return to Da Nang." },
          { day: 7, title: "Hoi An Walking Tour", details: "Transfer to Hoi An, walking tour of Old Town: Tan Ky House, Assembly Halls, Japanese Bridge, market, free time, return to Da Nang." },
          { day: 8, title: "Da Nang City Tour", details: "Marble Mountain (pagodas, caves, viewpoints), Son Tra Peninsula with Lady Buddha, Cham Museum, Dragon Bridge, Han Market, lunch." },
          { day: 9, title: "Free Day in Da Nang", details: "Full free day for beach, spa, shopping, or optional activities." },
          { day: 10, title: "Fly Da Nang ‚Üí Ho Chi Minh City", details: "Breakfast, airport transfer, flight to Ho Chi Minh City, pick-up and transfer to hotel, free time." },
          { day: 11, title: "HCMC Highlights + Cu Chi Tunnels", details: "Morning city tour: Reunification Palace, Notre Dame, Central Post Office, War Remnants Museum. Afternoon Cu Chi Tunnels visit, return to HCMC." },
          { day: 12, title: "Mekong Delta ‚Üí Can Tho", details: "Drive to Mekong Delta, boat trip, island visit, sampan canals, local lunch, continue to Can Tho for overnight." },
          { day: 13, title: "Cai Rang Floating Market ‚Üí HCMC", details: "Early morning visit to Cai Rang floating market, breakfast on boat, local life experience, return to Ho Chi Minh City." },
          { day: 14, title: "Departure from Ho Chi Minh", details: "Breakfast at hotel, free time depending on flight schedule, private transfer to Tan Son Nhat Airport for departure." }
        ]
      },
      16: {
        id: "vn-16-grand-detailed",
        name: "Vietnam in 16 Days ‚Äì Coastline & Culture (Detailed)",
        days: [
          { day: 1, title: "Hanoi Arrival & Leisure", details: "Arrive at Noi Bai International Airport (HAN), where your private driver will meet you and transfer you to your hotel in Hanoi. After check-in, enjoy a relaxed evening, perhaps with a stroll around the vibrant Old Quarter or a quiet dinner." },
          { day: 2, title: "Hanoi City Highlights Tour", details: "Discover Hanoi's rich history and culture on a full-day city tour. Visit the Ho Chi Minh Complex (Mausoleum exterior, Presidential Palace, Stilt House), One Pillar Pagoda, and the Temple of Literature. Explore the vibrant Old Quarter and enjoy a traditional water puppet show. Lunch at a local restaurant." },
          { day: 3, title: "Ninh Binh Full-Day Excursion", details: "Take a full-day trip to Ninh Binh, often called 'Ha Long Bay on land.' Visit Hoa Lu, Vietnam's ancient capital, and take a scenic boat trip through the stunning karst landscapes of Trang An or Tam Coc. Climb to the Mua Cave viewpoint for panoramic views of the rice fields and rivers. Lunch at a local restaurant. Return to Hanoi in the late afternoon." },
          { day: 4, title: "Hanoi ‚Üí Ha Long Bay Overnight Cruise", details: "After breakfast, transfer to Ha Long Bay. Upon arrival, embark on an overnight cruise. Enjoy a welcome drink, lunch, and explore a stunning cave. Participate in kayaking or swimming activities, enjoy a sunset party, and a cooking class before dinner onboard. Overnight on the cruise." },
          { day: 5, title: "Ha Long Bay Morning & Return to Hanoi", details: "Start your day with Tai Chi on the sundeck. Enjoy breakfast and visit a floating village or another cave. Brunch will be served onboard as the cruise sails back to the harbor. Disembark and transfer back to your hotel in Hanoi. Enjoy a free evening." },
          { day: 6, title: "Hanoi ‚Üí Da Nang Flight & Transfer to Hoi An", details: "After breakfast, transfer to Noi Bai Airport for your flight to Da Nang. Upon arrival, your private driver will transfer you directly to your hotel in Hoi An. In the evening, take a leisurely walk through the enchanting lantern-lit streets of Hoi An Ancient Town." },
          { day: 7, title: "Hoi An Ancient Town & Tra Que Village", details: "Discover the charm of Hoi An Ancient Town, a UNESCO World Heritage site, on a guided walking tour. Visit the iconic Japanese Covered Bridge, the Phuc Kien Assembly Hall, and a traditional merchant's house. In the afternoon, visit Tra Que Vegetable Village for a hands-on farming experience and a local lunch." },
          { day: 8, title: "Hoi An Free Day", details: "Enjoy a full free day in Hoi An for shopping, tailoring, cycling to the beach, or simply relaxing by the river. Overnight in Hoi An." },
          { day: 9, title: "Hoi An ‚Üí Ba Na Hills Full-Day & Da Nang", details: "Depart for Ba Na Hills: cable car ride, Golden Bridge, Le Jardin d'Amour gardens, Linh Ung Pagoda, Fantasy Park and French Village, with buffet lunch. Transfer to Da Nang for overnight." },
          { day: 10, title: "Da Nang City Highlights Tour", details: "Explore the iconic landmarks of Da Nang on a full-day city tour. Visit Marble Mountain, Son Tra Peninsula (Lady Buddha), and the Cham Museum. Experience the vibrant atmosphere of Han Market and see the Dragon Bridge. Lunch at a local restaurant." },
          { day: 11, title: "Da Nang Free Day", details: "Enjoy a leisurely breakfast and a full free day in Da Nang. You can relax at My Khe Beach, explore more of the city, or indulge in some shopping. Overnight in Da Nang." },
          { day: 12, title: "Da Nang ‚Üí Ho Chi Minh City Flight", details: "After breakfast, transfer to Da Nang Airport for your flight to Ho Chi Minh City. Upon arrival, your private driver will meet you and transfer you to your hotel. Enjoy a free evening to explore the vibrant city." },
          { day: 13, title: "Ho Chi Minh City Tour & Cu Chi Tunnels", details: "Morning: Visit the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers. Learn about their ingenious living conditions and guerrilla tactics. Afternoon: Explore Ho Chi Minh City's highlights including the Reunification Palace, Notre Dame Cathedral, Central Post Office, and Ben Thanh Market. Lunch will be at a local restaurant." },
          { day: 14, title: "Mekong Delta Discovery & Can Tho", details: "Journey to the lush Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, visit local markets, and explore traditional villages. Experience a sampan ride through narrow canals and savor a local lunch amidst the tranquil scenery. Continue to Can Tho for overnight." },
          { day: 15, title: "Cai Rang Floating Market & Return to Ho Chi Minh City", details: "Early morning visit to Cai Rang Floating Market, the largest in the Mekong Delta. Experience the bustling trade from your boat. After a local breakfast, return to Ho Chi Minh City. Enjoy a free afternoon for relaxation or last-minute shopping." },
          { day: 16, title: "Ho Chi Minh City Departure", details: "Enjoy a leisurely breakfast at your hotel. Depending on your flight schedule, you'll have free time for last-minute souvenir shopping or a final stroll. Your private driver will transfer you to Tan Son Nhat International Airport (SGN) for your onward departure." }
        ]
      },
      18: {
        id: "vn-18-extended-detailed",
        name: "Vietnam in 18 Days ‚Äì Extended North & Central (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & Leisure", details: "Arrive at Tan Son Nhat International Airport (SGN), where your private driver will meet you and transfer you to your hotel in Ho Chi Minh City. After check-in, enjoy a relaxed evening, perhaps with a stroll around the vibrant city center or a quiet dinner." },
          { day: 2, title: "Saigon City Highlights Tour", details: "Explore the iconic landmarks of Ho Chi Minh City on a full-day tour. Visit the Reunification Palace, Notre Dame Cathedral, and the historic Central Post Office. Gain insights into the Vietnam War at the War Remnants Museum, and experience the lively atmosphere of Ben Thanh Market. Lunch will be at a local restaurant." },
          { day: 3, title: "Mekong Delta Full-Day Excursion", details: "Journey to the lush Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, visit local markets, and explore traditional villages. Experience a sampan ride through narrow canals and savor a local lunch amidst the tranquil scenery before returning to Ho Chi Minh City." },
          { day: 4, title: "Cu Chi Tunnels Half-Day Excursion", details: "In the morning, embark on a half-day trip to the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers during the war. Learn about their ingenious living conditions and guerrilla tactics. You'll have the afternoon free back in Ho Chi Minh City for personal exploration or relaxation." },
          { day: 5, title: "Ho Chi Minh City ‚Üí Da Nang Flight & Transfer to Hoi An", details: "After breakfast, transfer to Tan Son Nhat Airport for your flight to Da Nang. Upon arrival, your private driver will transfer you directly to your hotel in Hoi An. In the evening, take a leisurely walk through the enchanting lantern-lit streets of Hoi An Ancient Town." },
          { day: 6, title: "Hoi An Ancient Town Walking Tour", details: "Discover the charm of Hoi An Ancient Town, a UNESCO World Heritage site, on a guided walking tour. Visit the iconic Japanese Covered Bridge, the Phuc Kien Assembly Hall, and a traditional merchant's house. Explore the bustling local market and learn about Hoi An's rich history as a trading port. Enjoy a local lunch." },
          { day: 7, title: "Hoi An Countryside Experience or Beach Day", details: "Today, choose your preferred activity: either a delightful countryside experience including a visit to Tra Que Vegetable Village for a hands-on farming lesson and a fun basket boat ride in the Coconut Forest, or a relaxing day at An Bang Beach. Lunch will be arranged according to your choice. Enjoy the evening at leisure in Hoi An." },
          { day: 8, title: "Hoi An Free Day", details: "Enjoy a full free day in Hoi An for shopping, tailoring, cycling to the beach, or simply relaxing by the river. Overnight in Hoi An." },
          { day: 9, title: "Hoi An ‚Üí Ba Na Hills Full-Day & Da Nang", details: "Depart for Ba Na Hills: cable car ride, Golden Bridge, Le Jardin d'Amour gardens, Linh Ung Pagoda, Fantasy Park and French Village, with buffet lunch. Transfer to Da Nang for overnight." },
          { day: 10, title: "Da Nang City Highlights Tour", details: "Explore the iconic landmarks of Da Nang on a full-day city tour. Visit Marble Mountain, Son Tra Peninsula (Lady Buddha), and the Cham Museum. Experience the vibrant atmosphere of Han Market and see the Dragon Bridge. Lunch at a local restaurant." },
          { day: 11, title: "Da Nang ‚Üí Hue City Full-Day Tour", details: "Travel to Hue and explore the Ancient Citadel, take a boat on the Perfume River to Thien Mu Pagoda, visit Tu Duc Tomb and browse Dong Ba Market before checking in to your hotel in Hue." },
          { day: 12, title: "Hue ‚Üí Hanoi Flight", details: "Breakfast, private transfer to Hue airport, short flight to Hanoi, pick-up and transfer to hotel. Free time to experience the Old Quarter in the evening." },
          { day: 13, title: "Hanoi City Highlights Tour", details: "Discover Hanoi's rich history and culture on a full-day city tour. Visit the Ho Chi Minh Complex (Mausoleum exterior, Presidential Palace, Stilt House), One Pillar Pagoda, and the Temple of Literature. Explore the vibrant Old Quarter and enjoy a traditional water puppet show. Lunch at a local restaurant." },
          { day: 14, title: "Ninh Binh Full-Day Excursion", details: "Take a full-day trip to Ninh Binh, often called 'Ha Long Bay on land.' Visit Hoa Lu, Vietnam's ancient capital, and take a scenic boat trip through the stunning karst landscapes of Trang An or Tam Coc. Climb to the Mua Cave viewpoint for panoramic views of the rice fields and rivers. Lunch at a local restaurant. Return to Hanoi in the late afternoon." },
          { day: 15, title: "Hanoi ‚Üí Ha Long Bay Overnight Cruise", details: "After breakfast, transfer to Ha Long Bay. Upon arrival, embark on an overnight cruise. Enjoy a welcome drink, lunch, and explore a stunning cave. Participate in kayaking or swimming activities, enjoy a sunset party, and a cooking class before dinner onboard. Overnight on the cruise." },
          { day: 16, title: "Ha Long Bay Morning & Return to Hanoi", details: "Start your day with Tai Chi on the sundeck. Enjoy breakfast and visit a floating village or another cave. Brunch will be served onboard as the cruise sails back to the harbor. Disembark and transfer back to your hotel in Hanoi. Enjoy a free evening." },
          { day: 17, title: "Hanoi Free Day / Optional Incense Village", details: "Enjoy a full free day in Hanoi for shopping, cafes, museums, or an optional half-day trip to Quang Phu Cau Incense Village to see traditional incense making. Overnight in Hanoi." },
          { day: 18, title: "Hanoi Departure", details: "Enjoy a leisurely breakfast at your hotel. Depending on your flight schedule, you'll have free time for last-minute souvenir shopping or a final stroll. Your private driver will transfer you to Noi Bai International Airport (HAN) for your onward departure." }
        ]
      },
      20: {
        id: "vn-20-signature-detailed",
        name: "Vietnam in 20 Days ‚Äì Vietnam & Inland Valleys (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & Leisure", details: "Arrive at Tan Son Nhat International Airport (SGN), where your private driver will meet you and transfer you to your hotel in Ho Chi Minh City. After check-in, enjoy a relaxed evening, perhaps with a stroll around the vibrant city center or a quiet dinner." },
          { day: 2, title: "Saigon City Highlights Tour", details: "Explore the iconic landmarks of Ho Chi Minh City on a full-day tour. Visit the Reunification Palace, Notre Dame Cathedral, and the historic Central Post Office. Gain insights into the Vietnam War at the War Remnants Museum, and experience the lively atmosphere of Ben Thanh Market. Lunch will be at a local restaurant." },
          { day: 3, title: "Mekong Delta Full-Day Excursion", details: "Journey to the lush Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, visit local markets, and explore traditional villages. Experience a sampan ride through narrow canals and savor a local lunch amidst the tranquil scenery before returning to Ho Chi Minh City." },
          { day: 4, title: "Cu Chi Tunnels Half-Day Excursion", details: "In the morning, embark on a half-day trip to the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers during the war. Learn about their ingenious living conditions and guerrilla tactics. You'll have the afternoon free back in Ho Chi Minh City for personal exploration or relaxation." },
          { day: 5, title: "Ho Chi Minh City ‚Üí Da Nang Flight & Transfer to Hoi An", details: "After breakfast, transfer to Tan Son Nhat Airport for your flight to Da Nang. Upon arrival, your private driver will transfer you directly to your hotel in Hoi An. In the evening, take a leisurely walk through the enchanting lantern-lit streets of Hoi An Ancient Town." },
          { day: 6, title: "Hoi An Ancient Town Walking Tour", details: "Discover the charm of Hoi An Ancient Town, a UNESCO World Heritage site, on a guided walking tour. Visit the iconic Japanese Covered Bridge, the Phuc Kien Assembly Hall, and a traditional merchant's house. Explore the bustling local market and learn about Hoi An's rich history as a trading port. Enjoy a local lunch." },
          { day: 7, title: "Hoi An Countryside Experience or Beach Day", details: "Today, choose your preferred activity: either a delightful countryside experience including a visit to Tra Que Vegetable Village for a hands-on farming lesson and a fun basket boat ride in the Coconut Forest, or a relaxing day at An Bang Beach. Lunch will be arranged according to your choice. Enjoy the evening at leisure in Hoi An." },
          { day: 8, title: "Hoi An Free Day", details: "Enjoy a full free day in Hoi An for shopping, tailoring, cycling to the beach, or simply relaxing by the river. Overnight in Hoi An." },
          { day: 9, title: "Hoi An ‚Üí Ba Na Hills Full-Day & Da Nang", details: "Depart for Ba Na Hills: cable car ride, Golden Bridge, Le Jardin d'Amour gardens, Linh Ung Pagoda, Fantasy Park and French Village, with buffet lunch. Transfer to Da Nang for overnight." },
          { day: 10, title: "Da Nang City Highlights Tour", details: "Explore the iconic landmarks of Da Nang on a full-day city tour. Visit Marble Mountain, Son Tra Peninsula (Lady Buddha), and the Cham Museum. Experience the vibrant atmosphere of Han Market and see the Dragon Bridge. Lunch at a local restaurant." },
          { day: 11, title: "Da Nang ‚Üí Hue City Full-Day Tour", details: "Travel to Hue and explore the Ancient Citadel, take a boat on the Perfume River to Thien Mu Pagoda, visit Tu Duc Tomb and browse Dong Ba Market before checking in to your hotel in Hue." },
          { day: 12, title: "Hue ‚Üí Hanoi Flight", details: "Breakfast, private transfer to Hue airport, short flight to Hanoi, pick-up and transfer to hotel. Free time to experience the Old Quarter in the evening." },
          { day: 13, title: "Hanoi City Highlights Tour", details: "Discover Hanoi's rich history and culture on a full-day city tour. Visit the Ho Chi Minh Complex (Mausoleum exterior, Presidential Palace, Stilt House), One Pillar Pagoda, and the Temple of Literature. Explore the vibrant Old Quarter and enjoy a traditional water puppet show. Lunch at a local restaurant." },
          { day: 14, title: "Ninh Binh Full-Day Excursion", details: "Take a full-day trip to Ninh Binh, often called 'Ha Long Bay on land.' Visit Hoa Lu, Vietnam's ancient capital, and take a scenic boat trip through the stunning karst landscapes of Trang An or Tam Coc. Climb to the Mua Cave viewpoint for panoramic views of the rice fields and rivers. Lunch at a local restaurant. Return to Hanoi in the late afternoon." },
          { day: 15, title: "Extra Day in Ninh Binh", details: "Extra day in Ninh Binh for slower exploration and village walks. Visit additional temples, enjoy countryside cycling, or explore local craft villages. Overnight in Ninh Binh or return to Hanoi." },
          { day: 16, title: "Hanoi ‚Üí Sapa by Limousine Bus", details: "Early pick-up by limousine bus for a comfortable 5‚Äì6 hour journey to Sapa. Check in to your hotel and enjoy free time around Sapa town. Overnight in Sapa." },
          { day: 17, title: "Sapa Trekking ‚Äì Y Linh Ho, Lao Chai & Ta Van", details: "Guided trek through terraced valleys and minority villages: pass a waterfall and hydro station, visit Y Linh Ho, Lao Chai and Ta Van villages with a simple local lunch en route, then drive back to Sapa." },
          { day: 18, title: "Fansipan Peak & Return to Hanoi", details: "Morning cable car ride to Fansipan, the Roof of Indochina, with time to explore temples and viewpoints. Return to Sapa for lunch, then afternoon limousine bus back to Hanoi, arriving in the evening. Overnight in Hanoi." },
          { day: 19, title: "Hanoi ‚Üí Ha Long Bay Overnight Cruise", details: "After breakfast, transfer to Ha Long Bay. Upon arrival, embark on an overnight cruise. Enjoy a welcome drink, lunch, and explore a stunning cave. Participate in kayaking or swimming activities, enjoy a sunset party, and a cooking class before dinner onboard. Overnight on the cruise." },
          { day: 20, title: "Ha Long Bay Morning & Return to Hanoi, Departure", details: "Start your day with Tai Chi on the sundeck. Enjoy breakfast and visit a floating village or another cave. Brunch will be served onboard as the cruise sails back to the harbor. Disembark and transfer back to Hanoi. Depending on your flight schedule, transfer to Noi Bai International Airport (HAN) for your onward departure." }
        ]
      },
      21: {
        id: "vn-21-symphony-detailed",
        name: "Private Vietnam 21 Days 20 Nights ‚Äì Symphony of Vietnam (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival", details: "Arrive at Tan Son Nhat Airport, meet your guide/driver with a name sign, transfer to your central hotel and enjoy free time to rest or explore nearby streets. Overnight in Ho Chi Minh City." },
          { day: 2, title: "Ho Chi Minh City Full Day", details: "City tour including Reunification Palace, Notre Dame Cathedral, Central Post Office, Chinatown, Thien Hau Pagoda, Binh Tay Market, War Remnants Museum and Ben Thanh Market, with lunch at a local restaurant." },
          { day: 3, title: "Mekong Delta Full Day", details: "Drive to My Tho; visit Vinh Trang Pagoda, cruise the Mekong River to islands, enjoy sampan rides through canals, local music, fruit, honey tea and coconut candy workshop before returning to Ho Chi Minh City." },
          { day: 4, title: "Cu Chi Tunnels Half Day", details: "Transfer to Cu Chi; watch an introductory film, explore the multi-level tunnel system, see hidden traps, bunkers, Hoang Cam stove and guerrilla kitchens; taste cassava and tea, optional shooting range, then return to the city." },
          { day: 5, title: "Fly to Da Nang ‚Äì Hoi An", details: "Transfer to the airport and fly to Da Nang; meet your driver on arrival and continue by road to Hoi An. Check in and enjoy free time in this charming lantern-lit town." },
          { day: 6, title: "Hoi An Walking Half-Day Tour", details: "Explore Hoi An Ancient Town: Tan Ky Old House, Fukien Assembly Hall, Japanese Covered Bridge and Hoi An Market, with time for a caf√© stop or lantern-making workshop. Free time in the afternoon." },
          { day: 7, title: "Tra Que & Coconut Palm Forest", details: "Bamboo basket boat trip through the Coconut Palm Forest, then visit Tra Que Vegetable Village for a fresh local lunch and insight into traditional farming. Gentle countryside cycling or walk back to town." },
          { day: 8, title: "Free Day in Hoi An", details: "Enjoy a full free day for shopping, tailoring, cycling to the beach or simply relaxing by the river. Overnight in Hoi An." },
          { day: 9, title: "Ba Na Hills Full Day ‚Äì Overnight Da Nang", details: "Depart for Ba Na Hills: cable car ride, Golden Bridge, Le Jardin d'Amour gardens, Linh Ung Pagoda, Fantasy Park and French Village, with buffet lunch. Transfer to Da Nang for overnight." },
          { day: 10, title: "Da Nang City Full Day", details: "Discover Marble Mountain, Son Tra Peninsula (Lady Buddha), Cham Museum, Dragon Bridge and Han Market, with lunch at a local restaurant. Overnight in Da Nang." },
          { day: 11, title: "Da Nang ‚Äì Hue City Full Day", details: "Travel to Hue and explore the Ancient Citadel, take a boat on the Perfume River to Thien Mu Pagoda, visit Tu Duc Tomb and browse Dong Ba Market before checking in to your hotel in Hue." },
          { day: 12, title: "Hue ‚Äì Fly to Hanoi", details: "Breakfast and free time until transfer to the airport for a short flight to Hanoi. On arrival, transfer to your hotel and relax. Overnight in Hanoi." },
          { day: 13, title: "Hanoi City Full Day", details: "Visit the Ho Chi Minh Complex (Mausoleum exterior as per opening times, Presidential Palace, Stilt House), One Pillar Pagoda, Temple of Literature, a museum (Ethnology or Women's) and explore the Old Quarter, Train Street and Hoan Kiem Lake with Ngoc Son Temple." },
          { day: 14, title: "Hoa Lu ‚Äì Trang An ‚Äì Mua Cave", details: "Full-day excursion to Ninh Binh: visit Hoa Lu ancient capital and temples, boat trip through Trang An's caves and karsts, then climb Mua Cave viewpoint for panoramic rice field and river views. Return to Hanoi." },
          { day: 15, title: "Hanoi ‚Äì Sapa by Limousine Bus", details: "Early pick-up by limousine bus for a comfortable 5‚Äì6 hour journey to Sapa. Check in to your hotel and enjoy free time around Sapa town. Overnight in Sapa." },
          { day: 16, title: "Sapa Trekking ‚Äì Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van", details: "Guided trek through terraced valleys and minority villages: pass a waterfall and hydro station, visit Y Linh Ho, Lao Chai and Ta Van villages with a simple local lunch en route, then drive back to Sapa." },
          { day: 17, title: "Sapa ‚Äì Fansipan Peak ‚Äì Hanoi", details: "Morning cable car ride to Fansipan, the Roof of Indochina, with time to explore temples and viewpoints. Return to Sapa for lunch, then afternoon limousine bus back to Hanoi. Overnight in Hanoi." },
          { day: 18, title: "Hanoi ‚Äì Ha Long Bay Overnight Cruise", details: "Shuttle from Hanoi to Ha Long Bay, board your cruise, enjoy welcome drinks and lunch while sailing to Bai Tu Long/Ha Long, visit a cave or do kayaking/swimming, join sunset activities and cooking demonstration, then dinner onboard." },
          { day: 19, title: "Ha Long Bay ‚Äì Hanoi", details: "Morning Tai Chi and light breakfast, visit another cave or fishing village, early brunch while cruising back to harbor, disembark and take the shuttle back to Hanoi. Overnight in Hanoi." },
          { day: 20, title: "Quang Phu Cau Incense Village", details: "Half-day trip from Hanoi to Quang Phu Cau incense village to see incense production, colorful drying courtyards and meet local artisans. Return to Hanoi for free time in the afternoon." },
          { day: 21, title: "Departure from Hanoi", details: "Breakfast and free time until your private transfer to Noi Bai International Airport for your onward flight." }
        ]
      },
      22: {
        id: "vn-22-panorama-detailed",
        name: "Vietnam Panorama ‚Äì 22 Days (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh (Saigon) Arrival", details: "Arrival at Tan Son Nhat Airport, meet & greet, private transfer to central hotel, rest & free time." },
          { day: 2, title: "Ho Chi Minh City & Cu Chi Tunnels", details: "Morning: Visit the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers. Afternoon: Explore Ho Chi Minh City's highlights including the Reunification Palace, Notre Dame Cathedral, Central Post Office, and Ben Thanh Market. Lunch at a local restaurant." },
          { day: 3, title: "Ho Chi Minh ‚Äì Cai Be ‚Äì Floating Market ‚Äì Cu Lao An Binh ‚Äì Vinh Long", details: "Full-day boat program in Cai Be & An Binh Island, traditional crafts, rowboat canals, fruit tasting. Visit Vinh Long and experience local Mekong Delta life. Return to Ho Chi Minh City." },
          { day: 4, title: "Ho Chi Minh ‚Äì Cat Tien National Park", details: "Drive to Cat Tien National Park, explore the tropical forest, visit wildlife rescue center, and enjoy nature trails. Overnight in Cat Tien or return to Ho Chi Minh City." },
          { day: 5, title: "Ho Chi Minh ‚Äì Fly to Da Lat ‚Äì Waterfalls Tour", details: "Transfer to airport, flight to Da Lat. Upon arrival, visit Datanla Waterfall, Prenn Waterfall, and enjoy the cool mountain air. Check in to hotel and free evening." },
          { day: 6, title: "Da Lat ‚Äì Natural Countryside Landscapes", details: "Explore Da Lat's countryside: visit flower farms, coffee plantations, and ethnic minority villages. Enjoy scenic views of the Central Highlands. Lunch at a local restaurant." },
          { day: 7, title: "Dalat ‚Äì Fly to Danang ‚Äì Hoi An", details: "Transfer to Da Lat airport, fly to Da Nang, private transfer to Hoi An hotel. Free evening to explore the lantern-lit Ancient Town." },
          { day: 8, title: "Hoi An Basket Boat, Tra Que Village & Ancient Town Tour", details: "Morning: Basket boat ride in Coconut Forest. Afternoon: Visit Tra Que Vegetable Village for farming experience and local lunch. Evening: Walking tour of Hoi An Ancient Town, visiting Japanese Bridge, Assembly Halls, and traditional houses." },
          { day: 9, title: "Hoi An Cooking Class & My Son Sanctuary", details: "Morning: Visit My Son Sanctuary, a UNESCO World Heritage site with ancient Cham temples. Afternoon: Participate in a cooking class to learn Vietnamese cuisine. Return to Hoi An." },
          { day: 10, title: "Hoi An ‚Äì Da Nang ‚Äì Ba Na Hills Full Day", details: "Drive to Ba Na Hills, take cable car to the summit, visit Golden Bridge, Le Jardin d'Amour gardens, Linh Ung Pagoda, Fantasy Park and French Village. Buffet lunch included. Return to Da Nang for overnight." },
          { day: 11, title: "Da Nang City Half-Day Tour", details: "Visit Marble Mountain with pagodas, caves and viewpoints. Explore Son Tra Peninsula with Lady Buddha statue. Visit Cham Museum and Han Market. Lunch at a local restaurant." },
          { day: 12, title: "Danang ‚Äì Hue City Full-Day Tour", details: "Travel to Hue via Hai Van Pass. Explore the Ancient Citadel, take a boat on the Perfume River to Thien Mu Pagoda, visit Tu Duc Tomb and browse Dong Ba Market. Overnight in Hue." },
          { day: 13, title: "Hue ‚Äì Phong Nha Cave ‚Äì Train to Ha Noi", details: "Morning: Drive to Phong Nha, visit Paradise Cave or Phong Nha Cave by boat. Afternoon: Transfer to Dong Hoi station, board overnight train to Hanoi. Overnight on train." },
          { day: 14, title: "Ha Noi ‚Äì Ha Noi Half-Day Tour", details: "Arrive in Hanoi early morning, transfer to hotel for breakfast and check-in. Afternoon: Half-day city tour including Ho Chi Minh Complex, One Pillar Pagoda, and Temple of Literature. Free evening in Old Quarter." },
          { day: 15, title: "Ha Noi ‚Äì Bai Dinh ‚Äì Trang An ‚Äì Mua Cave Full-Day Tour", details: "Full-day trip to Ninh Binh: visit Bai Dinh Pagoda (largest in Vietnam), boat trip through Trang An's caves and karsts, climb Mua Cave viewpoint for panoramic views. Lunch at a local restaurant. Return to Hanoi." },
          { day: 16, title: "Ninh Binh ‚Äì Cuc Phuong National Park ‚Äì Ha Noi", details: "Drive to Cuc Phuong National Park, explore the ancient forest, visit the Endangered Primate Rescue Center, and enjoy nature trails. Return to Hanoi in the late afternoon." },
          { day: 17, title: "Ha Noi ‚Äì Ha Giang City (Group Tour)", details: "Early morning departure for Ha Giang. Scenic drive through mountain passes. Arrive in Ha Giang City, check in to hotel. Free evening to explore the town." },
          { day: 18, title: "Ha Giang City ‚Äì Quan Ba ‚Äì Yen Minh ‚Äì Dong Van Town (Group Tour)", details: "Continue the Ha Giang loop: visit Quan Ba Heaven's Gate, Yen Minh town, and drive to Dong Van. Visit Dong Van Old Quarter and enjoy mountain scenery. Overnight in Dong Van." },
          { day: 19, title: "Dong Van ‚Äì Meo Vac (Group Tour)", details: "Drive through Ma Pi Leng Pass, one of Vietnam's most spectacular mountain passes. Visit Meo Vac town and enjoy stunning views of the Nho Que River. Return to Ha Giang or continue to Hanoi." },
          { day: 20, title: "Ha Giang ‚Äì Ha Noi", details: "Return journey to Hanoi. Arrive in the afternoon, check in to hotel. Free evening for rest or exploration." },
          { day: 21, title: "Ha Noi ‚Äì Tuan Chau ‚Äì Ha Long Bay ‚Äì Lan Ha Bay ‚Äì Tra Bau", details: "Shuttle to Tuan Chau, board cruise for Lan Ha Bay. Welcome drink and lunch while cruising. Visit Tra Bau area, kayaking or swimming, sunset party, cooking class and dinner onboard. Overnight on cruise." },
          { day: 22, title: "Lan Ha Bay ‚Äì Cat Ba Island ‚Äì Tuan Chau ‚Äì Ha Noi Departure", details: "Morning Tai Chi, breakfast, visit Cat Ba Island or floating village, brunch on board. Disembark at Tuan Chau, transfer back to Hanoi. Depending on flight schedule, transfer to Noi Bai Airport for departure." }
        ]
      },
      24: {
        id: "vn-24-deep-detailed",
        name: "Vietnam in 24 Days ‚Äì Deep Discovery (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & Leisure", details: "Arrive at Tan Son Nhat International Airport (SGN), where your private driver will meet you and transfer you to your hotel in Ho Chi Minh City. After check-in, enjoy a relaxed evening, perhaps with a stroll around the vibrant city center or a quiet dinner." },
          { day: 2, title: "Saigon City Highlights Tour", details: "Explore the iconic landmarks of Ho Chi Minh City on a full-day tour. Visit the Reunification Palace, Notre Dame Cathedral, and the historic Central Post Office. Gain insights into the Vietnam War at the War Remnants Museum, and experience the lively atmosphere of Ben Thanh Market. Lunch will be at a local restaurant." },
          { day: 3, title: "Mekong Delta Full-Day Excursion", details: "Journey to the lush Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, visit local markets, and explore traditional villages. Experience a sampan ride through narrow canals and savor a local lunch amidst the tranquil scenery before returning to Ho Chi Minh City." },
          { day: 4, title: "Cu Chi Tunnels Half-Day Excursion", details: "In the morning, embark on a half-day trip to the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers during the war. Learn about their ingenious living conditions and guerrilla tactics. You'll have the afternoon free back in Ho Chi Minh City for personal exploration or relaxation." },
          { day: 5, title: "Ho Chi Minh ‚Äì Fly to Nha Trang", details: "Breakfast, transfer to airport, flight to Nha Trang, pick up & hotel check-in, free time." },
          { day: 6, title: "Nha Trang City & Mud Spa Tour", details: "Visit Oceanographic Institute, pagoda, cathedral, Cham Po Nagar, mud bath & hot springs, local lunch." },
          { day: 7, title: "Nha Trang Free Day", details: "Beach time, optional island trips, spa or leisure day at your own pace." },
          { day: 8, title: "Nha Trang ‚Äì Da Lat by Private Car", details: "Late morning departure, scenic mountain road to Da Lat, check-in & free evening." },
          { day: 9, title: "Da Lat City Tour", details: "Bao Dai Summer Palace, cable car, Truc Lam Zen Monastery, Datanla Waterfall, pagodas, flower park." },
          { day: 10, title: "Da Lat Free Day", details: "Free day for cafes, markets, lakes, or optional activities." },
          { day: 11, title: "Da Lat ‚Äì Fly to Da Nang ‚Äì Hoi An", details: "Transfer to Da Lat airport, fly to Da Nang, private transfer to Hoi An hotel." },
          { day: 12, title: "Hoi An Walking Tour & Tra Que / Basket Boat", details: "Walking tour of Hoi An Old Town, Tra Que Vegetable Village lunch & activities, basket boat in Coconut Forest." },
          { day: 13, title: "Hoi An Free Day (Tailors, Beach or Spa)", details: "Full free day in Hoi An for shopping, tailoring, beach relaxation, spa treatments, or optional tours." },
          { day: 14, title: "Hoi An ‚Äì Ba Na Hills Full Day ‚Äì Da Nang", details: "Cable car to Ba Na Hills, Golden Bridge, Le Jardin D'Amour, Linh Ung Pagoda, Fantasy Park, buffet lunch. Transfer to Da Nang for overnight." },
          { day: 15, title: "Da Nang City Full-Day Tour", details: "Marble Mountain (pagodas, caves, viewpoints), Son Tra Peninsula with Lady Buddha, Cham Museum, Dragon Bridge, Han Market, lunch." },
          { day: 16, title: "Da Nang ‚Äì Hue City Full-Day Tour", details: "Travel to Hue and explore the Ancient Citadel, take a boat on the Perfume River to Thien Mu Pagoda, visit Tu Duc Tomb and browse Dong Ba Market before checking in to your hotel in Hue." },
          { day: 17, title: "Hue ‚Äì Fly to Ha Noi", details: "Breakfast, transfer to Hue airport, fly to Hanoi, private transfer & check-in." },
          { day: 18, title: "Ha Noi City Full Day", details: "Ho Chi Minh Complex (Mausoleum exterior, Presidential Palace, Stilt House), One Pillar Pagoda, Temple of Literature, museum (Ethnology or Women's), Train Street, Old Quarter and Hoan Kiem Lake." },
          { day: 19, title: "Ha Noi ‚Äì Hoa Lu ‚Äì Trang An ‚Äì Mua Cave", details: "Full-day excursion to Ninh Binh: visit Hoa Lu ancient capital and temples, boat trip through Trang An's caves and karsts, climb Mua Cave viewpoint for panoramic rice field and river views. Return to Hanoi." },
          { day: 20, title: "Ha Noi ‚Äì Sa Pa by Limousine Bus", details: "Early pick-up by limousine bus for a comfortable 5‚Äì6 hour journey to Sapa. Check in to your hotel and enjoy free time around Sapa town. Overnight in Sapa." },
          { day: 21, title: "Sa Pa Trekking ‚Äì Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van", details: "Guided trek through terraced valleys and minority villages: pass a waterfall and hydro station, visit Y Linh Ho, Lao Chai and Ta Van villages with a simple local lunch en route, then drive back to Sapa." },
          { day: 22, title: "Sa Pa ‚Äì Fansipan Peak ‚Äì Ha Noi", details: "Morning cable car ride to Fansipan, the Roof of Indochina, with time to explore temples and viewpoints. Return to Sapa for lunch, then afternoon limousine bus back to Hanoi. Overnight in Hanoi." },
          { day: 23, title: "Ha Noi Free Day (Caf√©s, Museums and Shopping)", details: "Full free day in Hanoi for caf√©s, museums, shopping, or optional tours. Perfect for rest and personal exploration." },
          { day: 24, title: "Ha Noi ‚Äì Ha Long Bay Overnight Cruise ‚Äì Ha Noi Departure", details: "Shuttle to Ha Long Bay, board cruise, welcome drinks and lunch, visit cave, kayaking/swimming, sunset party, cooking class, dinner onboard. Next morning: Tai Chi, breakfast, brunch, disembark and return to Hanoi. Transfer to Noi Bai Airport for departure." }
        ]
      },
      26: {
        id: "vn-26-explorer-detailed",
        name: "Vietnam in 26 Days ‚Äì Mountains, Coast & Countryside (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh City Arrival & Leisure", details: "Arrive at Tan Son Nhat International Airport (SGN), where your private driver will meet you and transfer you to your hotel in Ho Chi Minh City. After check-in, enjoy a relaxed evening, perhaps with a stroll around the vibrant city center or a quiet dinner." },
          { day: 2, title: "Saigon City Highlights Tour", details: "Explore the iconic landmarks of Ho Chi Minh City on a full-day tour. Visit the Reunification Palace, Notre Dame Cathedral, and the historic Central Post Office. Gain insights into the Vietnam War at the War Remnants Museum, and experience the lively atmosphere of Ben Thanh Market. Lunch will be at a local restaurant." },
          { day: 3, title: "Mekong Delta Full-Day Excursion", details: "Journey to the lush Mekong Delta for a full-day tour. Enjoy a boat trip on the Mekong River, visit local markets, and explore traditional villages. Experience a sampan ride through narrow canals and savor a local lunch amidst the tranquil scenery before returning to Ho Chi Minh City." },
          { day: 4, title: "Cu Chi Tunnels Half-Day Excursion", details: "In the morning, embark on a half-day trip to the Cu Chi Tunnels, an intricate underground network used by Viet Cong soldiers during the war. Learn about their ingenious living conditions and guerrilla tactics. You'll have the afternoon free back in Ho Chi Minh City for personal exploration or relaxation." },
          { day: 5, title: "Ho Chi Minh ‚Äì Fly to Nha Trang", details: "Breakfast, transfer to airport, flight to Nha Trang, pick up & hotel check-in, free time." },
          { day: 6, title: "Nha Trang City & Mud Spa Tour", details: "Visit Oceanographic Institute, pagoda, cathedral, Cham Po Nagar, mud bath & hot springs, local lunch." },
          { day: 7, title: "Nha Trang Free Day", details: "Beach time, optional island trips, spa or leisure day at your own pace." },
          { day: 8, title: "Nha Trang ‚Äì Da Lat by Private Car", details: "Late morning departure, scenic mountain road to Da Lat, check-in & free evening." },
          { day: 9, title: "Da Lat City Tour", details: "Bao Dai Summer Palace, cable car, Truc Lam Zen Monastery, Datanla Waterfall, pagodas, flower park." },
          { day: 10, title: "Da Lat Free Day (Extra Relaxed Exploration)", details: "Extra free day in Da Lat for cafes, markets, lakes, optional activities, or simply enjoying the cool mountain air at a relaxed pace." },
          { day: 11, title: "Da Lat ‚Äì Fly to Da Nang ‚Äì Hoi An", details: "Transfer to Da Lat airport, fly to Da Nang, private transfer to Hoi An hotel." },
          { day: 12, title: "Hoi An Walking Tour & Tra Que / Basket Boat", details: "Walking tour of Hoi An Old Town, Tra Que Vegetable Village lunch & activities, basket boat in Coconut Forest." },
          { day: 13, title: "Hoi An Free Day", details: "Full free day in Hoi An for shopping, tailoring, beach, or optional tours." },
          { day: 14, title: "Hoi An ‚Äì Ba Na Hills Full Day ‚Äì Da Nang", details: "Cable car to Ba Na Hills, Golden Bridge, Le Jardin D'Amour, Linh Ung Pagoda, Fantasy Park, buffet lunch. Transfer to Da Nang for overnight." },
          { day: 15, title: "Da Nang City Full-Day Tour", details: "Marble Mountain (pagodas, caves, viewpoints), Son Tra Peninsula with Lady Buddha, Cham Museum, Dragon Bridge, Han Market, lunch." },
          { day: 16, title: "Da Nang ‚Äì Hue City Full-Day Tour", details: "Travel to Hue and explore the Ancient Citadel, take a boat on the Perfume River to Thien Mu Pagoda, visit Tu Duc Tomb and browse Dong Ba Market before checking in to your hotel in Hue." },
          { day: 17, title: "Hue Free Day (Extra Relaxed Exploration)", details: "Extra free day in Hue for more relaxed exploration: visit additional tombs, enjoy Perfume River activities, explore local markets, or simply relax." },
          { day: 18, title: "Hue ‚Äì Fly to Ha Noi", details: "Breakfast, transfer to Hue airport, fly to Hanoi, private transfer & check-in." },
          { day: 19, title: "Ha Noi City Full Day", details: "Ho Chi Minh Complex (Mausoleum exterior, Presidential Palace, Stilt House), One Pillar Pagoda, Temple of Literature, museum (Ethnology or Women's), Train Street, Old Quarter and Hoan Kiem Lake." },
          { day: 20, title: "Ha Noi ‚Äì Hoa Lu ‚Äì Trang An ‚Äì Mua Cave", details: "Full-day excursion to Ninh Binh: visit Hoa Lu ancient capital and temples, boat trip through Trang An's caves and karsts, climb Mua Cave viewpoint for panoramic rice field and river views. Return to Hanoi." },
          { day: 21, title: "Ninh Binh ‚Äì Cuc Phuong National Park ‚Äì Ha Noi (Additional Village Walks)", details: "Drive to Cuc Phuong National Park, explore the ancient forest, visit the Endangered Primate Rescue Center, enjoy nature trails and additional village walks. Return to Hanoi in the late afternoon." },
          { day: 22, title: "Ha Noi ‚Äì Ha Giang City (Group Tour)", details: "Early morning departure for Ha Giang. Scenic drive through mountain passes. Arrive in Ha Giang City, check in to hotel. Free evening to explore the town." },
          { day: 23, title: "Ha Giang City ‚Äì Quan Ba ‚Äì Yen Minh ‚Äì Dong Van Town (Group Tour)", details: "Continue the Ha Giang loop: visit Quan Ba Heaven's Gate, Yen Minh town, and drive to Dong Van. Visit Dong Van Old Quarter and enjoy mountain scenery. Overnight in Dong Van." },
          { day: 24, title: "Dong Van ‚Äì Meo Vac (Group Tour) ‚Äì Ha Noi", details: "Drive through Ma Pi Leng Pass, one of Vietnam's most spectacular mountain passes. Visit Meo Vac town and enjoy stunning views. Return journey to Hanoi, arriving in the evening." },
          { day: 25, title: "Ha Noi ‚Äì Ha Long Bay Overnight Cruise", details: "Shuttle to Ha Long Bay, board cruise, welcome drinks and lunch, visit cave, kayaking/swimming, sunset party, cooking class, dinner onboard. Overnight on cruise." },
          { day: 26, title: "Ha Long Bay ‚Äì Ha Noi Departure", details: "Morning Tai Chi, breakfast, visit floating village or another cave, brunch on board. Disembark and transfer back to Hanoi. Transfer to Noi Bai Airport for departure." }
        ]
      },
      28: {
        id: "vn-28-month-detailed",
        name: "Vietnam in 28 Days ‚Äì Almost a Full Month (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh (Saigon) Arrival", details: "Arrival at Tan Son Nhat Airport, meet & greet, private transfer to central hotel, rest & free time." },
          { day: 2, title: "Ho Chi Minh ‚Äì Cai Be ‚Äì Floating Market ‚Äì An Binh Island ‚Äì Vinh Long ‚Äì Can Tho", details: "Full-day boat program in Cai Be & An Binh Island, traditional crafts, rowboat canals, fruit tasting. Continue to Can Tho for overnight." },
          { day: 3, title: "Can Tho ‚Äì Cai Rang Floating Market ‚Äì Ho Chi Minh City", details: "Morning visit to Cai Rang floating market, breakfast on boat, local life experience, return to Ho Chi Minh City." },
          { day: 4, title: "Ho Chi Minh ‚Äì Flight to Nha Trang", details: "Breakfast, transfer to airport, flight to Nha Trang, pick up & hotel check-in, free time." },
          { day: 5, title: "Nha Trang City & Mud Spa", details: "Oceanographic Institute, pagoda, cathedral, Cham Po Nagar, mud bath & hot springs, local lunch." },
          { day: 6, title: "Nha Trang Free Day", details: "Beach time, optional island trips, spa or leisure day at your own pace." },
          { day: 7, title: "Nha Trang ‚Äì Da Lat by Private Car", details: "Late morning departure, scenic mountain road to Da Lat, check-in & free evening." },
          { day: 8, title: "Da Lat City Tour", details: "Bao Dai Summer Palace, cable car, Truc Lam Zen Monastery, Datanla Waterfall, pagodas, flower park." },
          { day: 9, title: "Da Lat Free Day", details: "Free day for cafes, markets, lakes, or optional activities." },
          { day: 10, title: "Da Lat ‚Äì Flight to Da Nang ‚Äì Hoi An", details: "Transfer to Da Lat airport, fly to Da Nang, private transfer to Hoi An hotel." },
          { day: 11, title: "Hoi An Ancient Town ‚Äì Tra Que & Basket Boat", details: "Walking tour of Hoi An Old Town, Tra Que Vegetable Village lunch & activities, basket boat in Coconut Forest." },
          { day: 12, title: "Ba Na Hills Day Trip", details: "Cable car to Ba Na Hills, Golden Bridge, Le Jardin D'Amour, Linh Ung Pagoda, Fantasy Park, buffet lunch." },
          { day: 13, title: "My Son Sanctuary Half Day", details: "Morning visit to My Son Hindu temples, Cham dance show, return to Hoi An, afternoon free." },
          { day: 14, title: "Hoi An Free Day", details: "Relax on the beach, tailor visits, lantern streets, or optional tours." },
          { day: 15, title: "Hoi An ‚Äì Marble Mountain ‚Äì Hai Van Pass ‚Äì Hue", details: "Drive via Marble Mountain and Hai Van Pass to Hue, lunch en route, check-in, free time." },
          { day: 16, title: "Hue City Tour", details: "Imperial tombs, Perfume River boat to Thien Mu Pagoda, Tu Duc Tomb, Dong Ba Market, lunch in town." },
          { day: 17, title: "Hue ‚Äì Flight to Hanoi", details: "Breakfast, transfer to Hue airport, fly to Hanoi, private transfer & check-in." },
          { day: 18, title: "Hanoi City Afternoon Tour by Jeep", details: "Free morning. Afternoon Jeep tour: Old Quarter, Train Street, French Quarter, Ho Chi Minh area, West Lake, street food & egg coffee." },
          { day: 19, title: "Bai Dinh ‚Äì Trang An ‚Äì Mua Cave", details: "Full-day trip to Ninh Binh: Bai Dinh Pagoda, Trang An boat caves, climb Mua Cave viewpoint." },
          { day: 20, title: "Quang Phu Cau Incense Village", details: "Half/day or full-day visit to incense-making village, photography & workshop, lunch at local restaurant." },
          { day: 21, title: "Hanoi ‚Äì Sapa by Limousine Bus", details: "Comfortable transfer to Sapa, check-in, free time to explore Sapa town." },
          { day: 22, title: "Sapa Trek ‚Äì Cat Cat ‚Äì Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van", details: "Guided trekking through minority villages & rice terraces, lunch en route, car back to Sapa." },
          { day: 23, title: "Sapa Waterfalls & Passes ‚Äì O Quy Ho, Silver & Love Waterfalls", details: "Scenic drive through Hoang Lien National Park, visit waterfalls & viewpoints, optional orchard stop." },
          { day: 24, title: "Fansipan Half Day ‚Äì Return to Hanoi", details: "Cable car to Fansipan summit, temples & views, then limousine bus back to Hanoi." },
          { day: 25, title: "Hanoi Free Day", details: "Full free day in Hanoi for shopping, cafes, museums, or optional tours." },
          { day: 26, title: "Hanoi ‚Äì Mai Chau", details: "Drive to Mai Chau valley, lunch, afternoon cycling through minority villages, evening cultural show & local rice wine." },
          { day: 27, title: "Mai Chau ‚Äì Hanoi", details: "Morning village walk, lunch at ecolodge, afternoon transfer back to Hanoi." },
          { day: 28, title: "Hanoi ‚Äì Ha Long Bay Cruise & Return to Hanoi, Departure", details: "Shuttle to Ha Long, board La Regina Classic Cruise, visit cave, sunset, cooking class & dinner on board. Next morning: Taichi, visit floating village, brunch, disembark & transfer back to Hanoi. Transfer to Noi Bai Airport for departure." }
        ]
      },
      30: {
        id: "vn-30-full-month-detailed",
        name: "Private Vietnam 30 Days 29 Nights ‚Äì Vietnam Full Month (Detailed)",
        days: [
          { day: 1, title: "Ho Chi Minh (Saigon) Arrival", details: "Arrival at Tan Son Nhat Airport, meet & greet, private transfer to central hotel, rest & free time." },
          { day: 2, title: "Ho Chi Minh ‚Äì Cai Be Floating Market ‚Äì An Binh Island ‚Äì Vinh Long ‚Äì Can Tho", details: "Full-day boat program in Cai Be & An Binh Island, traditional crafts, rowboat canals, fruit tasting. Continue to Can Tho for overnight." },
          { day: 3, title: "Can Tho ‚Äì Cai Rang Floating Market ‚Äì Ho Chi Minh City", details: "Morning visit to Cai Rang floating market, local lunch, transfer back to Ho Chi Minh City." },
          { day: 4, title: "Ho Chi Minh ‚Äì Flight to Nha Trang", details: "Breakfast, transfer to airport, flight to Nha Trang, pick up & hotel check-in, free time." },
          { day: 5, title: "Nha Trang City & Mud Spa", details: "Oceanographic Institute, pagoda, cathedral, Cham Po Nagar, mud bath & hot springs, local lunch." },
          { day: 6, title: "Nha Trang Free Day", details: "Beach time, optional island trips, spa or leisure day at your own pace." },
          { day: 7, title: "Nha Trang ‚Äì Da Lat by Private Car", details: "Late morning departure, scenic mountain road to Da Lat, check-in & free evening." },
          { day: 8, title: "Da Lat City Tour", details: "Bao Dai Summer Palace, cable car, Truc Lam Zen Monastery, Datanla Waterfall, pagodas, flower park." },
          { day: 9, title: "Da Lat Free Day", details: "Free day for cafes, markets, lakes, or optional activities." },
          { day: 10, title: "Da Lat ‚Äì Flight to Da Nang ‚Äì Hoi An", details: "Transfer to Da Lat airport, fly to Da Nang, private transfer to Hoi An hotel." },
          { day: 11, title: "Hoi An Ancient Town ‚Äì Tra Que & Basket Boat", details: "Walking tour of Hoi An Old Town, Tra Que Vegetable Village lunch & activities, basket boat in Coconut Forest." },
          { day: 12, title: "Ba Na Hills Day Trip", details: "Cable car to Ba Na Hills, Golden Bridge, Le Jardin D'Amour, Linh Ung Pagoda, Fantasy Park, buffet lunch." },
          { day: 13, title: "My Son Sanctuary Half Day", details: "Morning visit to My Son Hindu temples, Cham dance show, return to Hoi An, afternoon free." },
          { day: 14, title: "Hoi An Free Day", details: "Relax on the beach, tailor visits, lantern streets, or optional tours." },
          { day: 15, title: "Hoi An ‚Äì Marble Mountain ‚Äì Hai Van Pass ‚Äì Hue", details: "Drive via Marble Mountain and Hai Van Pass to Hue, lunch en route, check-in, free time." },
          { day: 16, title: "Hue City Tour", details: "Imperial tombs, Perfume River boat to Thien Mu Pagoda, Tu Duc Tomb, Dong Ba Market, lunch in town." },
          { day: 17, title: "Hue ‚Äì Flight to Hanoi", details: "Breakfast, transfer to Hue airport, fly to Hanoi, private transfer & check-in." },
          { day: 18, title: "Hanoi City Afternoon Tour by Jeep", details: "Free morning. Afternoon Jeep tour: Old Quarter, Train Street, French Quarter, Ho Chi Minh area, West Lake, street food & egg coffee." },
          { day: 19, title: "Bai Dinh ‚Äì Trang An ‚Äì Mua Cave", details: "Full-day trip to Ninh Binh: Bai Dinh Pagoda, Trang An boat caves, climb Mua Cave viewpoint." },
          { day: 20, title: "Quang Phu Cau Incense Village", details: "Half/day or full-day visit to incense-making village, photography & workshop, lunch at local restaurant." },
          { day: 21, title: "Hanoi ‚Äì Sapa by Limousine Bus", details: "Comfortable transfer to Sapa, check-in, free time to explore Sapa town." },
          { day: 22, title: "Sapa Trek ‚Äì Cat Cat ‚Äì Y Linh Ho ‚Äì Lao Chai ‚Äì Ta Van", details: "Guided trekking through minority villages & rice terraces, lunch en route, car back to Sapa." },
          { day: 23, title: "Sapa Waterfalls & Passes ‚Äì O Quy Ho, Silver & Love Waterfalls", details: "Scenic drive through Hoang Lien National Park, visit waterfalls & viewpoints, optional orchard stop." },
          { day: 24, title: "Fansipan Half Day ‚Äì Return to Hanoi", details: "Cable car to Fansipan summit, temples & views, then limousine bus back to Hanoi." },
          { day: 25, title: "Hanoi Free Day", details: "Full free day in Hanoi for shopping, cafes, museums, or optional tours." },
          { day: 26, title: "Hanoi ‚Äì Mai Chau", details: "Drive to Mai Chau valley, lunch, afternoon cycling through minority villages, evening cultural show & local rice wine." },
          { day: 27, title: "Mai Chau ‚Äì Hanoi", details: "Morning village walk, lunch at ecolodge, afternoon transfer back to Hanoi." },
          { day: 28, title: "Hanoi ‚Äì Ha Long Bay", details: "Shuttle to Ha Long, board La Regina Classic Cruise, visit cave, sunset, cooking class & dinner on board." },
          { day: 29, title: "Ha Long Bay ‚Äì Hanoi", details: "Taichi, visit floating village (kayak or bamboo boat), brunch, disembark & transfer back to Hanoi." },
          { day: 30, title: "Departure from Hanoi", details: "Free time until private airport transfer for your international departure." }
        ]
      }
    };

    function $(id) { return document.getElementById(id); }

    function formatDate(date) {
      const d = new Date(date);
      if (isNaN(d.getTime())) return "";
      const opts = { day: "2-digit", month: "short", year: "numeric" };
      return d.toLocaleDateString("en-GB", opts);
    }

    function formatDateTime(dateStr, timeStr) {
      if (!dateStr) return "";
      const d = formatDate(dateStr);
      if (!timeStr) return d;
      return `${d} ${timeStr}`;
    }

    function addDays(baseDate, daysToAdd) {
      const d = new Date(baseDate);
      d.setDate(d.getDate() + daysToAdd);
      return d.toISOString().split("T")[0];
    }

    function autoFillEndDate() {
      const startDate = $("startDate").value;
      const numDays = parseInt($("numDays").value, 10) || 1;
      if (startDate) {
        $("endDate").value = addDays(startDate, numDays - 1);
      } else {
        $("endDate").value = "";
      }
    }

    $("startDate").addEventListener("change", autoFillEndDate);
    $("numDays").addEventListener("change", autoFillEndDate);

    function hotelRatingToStars(rating) {
      if (!rating) return "";
      const r = rating.toLowerCase();
      if (r.includes("homestay")) return "Homestay";
      if (r.startsWith("3")) return "‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ";
      if (r.startsWith("4")) return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ";
      if (r.startsWith("5")) return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ";
      if (r.includes("luxury")) return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ";
      if (r.includes("mixed")) return "‚òÖ‚òÖ‚òÖ‚Äì‚òÖ‚òÖ‚òÖ‚òÖ";
      return rating;
    }

    function parseTimesFromText(text) {
      const result = { arrival: null, departure: null };
      if (!text) return result;
      const lower = text.toLowerCase();
      const timeRegex = /(\d{1,2})[:\.](\d{2})/g;
      const matches = [];
      let m;
      while ((m = timeRegex.exec(lower)) !== null) {
        const hh = m[1].padStart(2, "0");
        const mm = m[2];
        if (parseInt(hh, 10) < 24 && parseInt(mm, 10) < 60) {
          matches.push(`${hh}:${mm}`);
        }
      }
      if (matches[0]) result.arrival = matches[0];
      if (matches[1]) result.departure = matches[1];
      return result;
    }

    // ====== PLACES TO VISIT FEATURE ======
    // Mapping of attractions/places to their cities
    const ATTRACTION_TO_CITY = {
      // Siem Reap / Cambodia
      "Angkor Wat": "Siem Reap",
      "Angkor Thom": "Siem Reap",
      "Bayon Temple": "Siem Reap",
      "Ta Prohm": "Siem Reap",
      "Siem Reap": "Siem Reap",
      
      // Ha Long Bay
      "Ha Long Bay": "Ha Long Bay",
      "Ha Long Bay Cruise": "Ha Long Bay",
      "Lan Ha Bay": "Ha Long Bay",
      "Bai Tu Long Bay": "Ha Long Bay",
      
      // Hoi An
      "Hoi An": "Hoi An",
      "Hoi An Ancient Town": "Hoi An",
      "Hoi An Old Town": "Hoi An",
      "Japanese Covered Bridge": "Hoi An",
      
      // Ho Chi Minh City
      "Cu Chi Tunnels": "Ho Chi Minh City",
      "War Remnants Museum": "Ho Chi Minh City",
      "Reunification Palace": "Ho Chi Minh City",
      "Ho Chi Minh City": "Ho Chi Minh City",
      "Saigon": "Ho Chi Minh City",
      
      // Mekong Delta
      "Mekong Delta": "Mekong Delta",
      "Cai Rang Floating Market": "Can Tho",
      "Phong Dien Floating Market": "Can Tho",
      "Can Tho": "Can Tho",
      
      // Sapa
      "Sapa": "Sapa",
      "Fansipan": "Sapa",
      "Fansipan Mountain": "Sapa",
      "Rice Terraces": "Sapa",
      "Sapa Rice Terraces": "Sapa",
      
      // Hue
      "Hue": "Hue",
      "Hue Imperial City": "Hue",
      "Imperial Citadel": "Hue",
      "Royal Tombs": "Hue",
      
      // Phong Nha
      "Phong Nha": "Phong Nha",
      "Phong Nha Caves": "Phong Nha",
      "Paradise Cave": "Phong Nha",
      "Son Doong Cave": "Phong Nha",
      
      // Ninh Binh
      "Ninh Binh": "Ninh Binh",
      "Tam Coc": "Ninh Binh",
      "Trang An": "Ninh Binh",
      
      // Da Nang
      "Ba Na Hills": "Da Nang",
      "Golden Bridge": "Da Nang",
      "Marble Mountains": "Da Nang",
      "Da Nang": "Da Nang",
      
      // Hanoi
      "Hanoi": "Hanoi",
      "Hanoi Old Quarter": "Hanoi",
      "Ho Chi Minh Mausoleum": "Hanoi",
      "Temple of Literature": "Hanoi",
      
      // Other destinations
      "Mai Chau": "Mai Chau",
      "Mai Chau Valley": "Mai Chau",
      "Da Lat": "Da Lat",
      "Nha Trang": "Nha Trang",
      "Phu Quoc": "Phu Quoc",
      "Mui Ne": "Mui Ne",
      "Phnom Penh": "Phnom Penh",
      "Battambang": "Battambang"
    };

    // Popular attractions list for checkboxes
    const POPULAR_ATTRACTIONS = [
      { name: "Angkor Wat", city: "Siem Reap" },
      { name: "Ha Long Bay Cruise", city: "Ha Long Bay" },
      { name: "Hoi An Ancient Town", city: "Hoi An" },
      { name: "Cu Chi Tunnels", city: "Ho Chi Minh City" },
      { name: "Mekong Delta Floating Markets", city: "Mekong Delta" },
      { name: "Sapa Rice Terraces", city: "Sapa" },
      { name: "Hue Imperial City", city: "Hue" },
      { name: "Phong Nha Caves", city: "Phong Nha" },
      { name: "Ninh Binh (Tam Coc/Trang An)", city: "Ninh Binh" },
      { name: "Ba Na Hills Golden Bridge", city: "Da Nang" },
      { name: "Hanoi Old Quarter", city: "Hanoi" },
      { name: "Fansipan Mountain", city: "Sapa" }
    ];

    // Initialize places to visit checkboxes
    function initializePlacesToVisit() {
      const container = $("placesToVisitCheckboxes");
      if (!container) return;
      
      container.innerHTML = POPULAR_ATTRACTIONS.map(attr => `
        <label style="display: block; padding: 4px 0; cursor: pointer; font-size: 12px;">
          <input type="checkbox" value="${attr.name}" data-city="${attr.city}" 
                 style="margin-right: 6px;" />
          ${attr.name} <span style="color: #666;">(${attr.city})</span>
        </label>
      `).join("");
    }

    // Parse places to visit from checkboxes and custom text
    function parsePlacesToVisit() {
      const selectedPlaces = [];
      
      // Get checked boxes
      const checkboxes = $("placesToVisitCheckboxes")?.querySelectorAll('input[type="checkbox"]:checked') || [];
      checkboxes.forEach(cb => {
        selectedPlaces.push(cb.value);
      });
      
      // Get custom places
      const customText = $("customPlaces")?.value.trim() || "";
      if (customText) {
        const customPlaces = customText.split(',').map(p => p.trim()).filter(p => p.length > 0);
        selectedPlaces.push(...customPlaces);
      }
      
      return selectedPlaces;
    }

    // Extract required cities from selected places
    function extractRequiredCities(places) {
      const requiredCities = new Set();
      
      places.forEach(place => {
        // Try exact match first
        if (ATTRACTION_TO_CITY[place]) {
          requiredCities.add(ATTRACTION_TO_CITY[place]);
          return;
        }
        
        // Try case-insensitive match
        const placeLower = place.toLowerCase();
        for (const [attraction, city] of Object.entries(ATTRACTION_TO_CITY)) {
          if (attraction.toLowerCase() === placeLower || placeLower.includes(attraction.toLowerCase())) {
            requiredCities.add(city);
            break;
          }
        }
        
        // Try matching city names directly
        const allCities = ["Ho Chi Minh City", "Hanoi", "Da Nang", "Hoi An", "Hue", "Ha Long Bay", 
                          "Ninh Binh", "Sapa", "Can Tho", "Phu Quoc", "Nha Trang", "Da Lat", "Mui Ne",
                          "Phnom Penh", "Siem Reap", "Battambang", "Mekong Delta", "Phong Nha", "Mai Chau"];
        for (const city of allCities) {
          if (placeLower.includes(city.toLowerCase()) || city.toLowerCase().includes(placeLower)) {
            requiredCities.add(city);
            break;
          }
        }
      });
      
      return Array.from(requiredCities);
    }

    // Check if selected places fit the number of days and show warning
    function checkPlacesFitDays(numDays, requiredCities) {
      const warningDiv = $("placesWarning");
      const warningText = $("placesWarningText");
      
      if (!warningDiv || !warningText) return;
      
      if (requiredCities.length === 0) {
        warningDiv.style.display = "none";
        return;
      }
      
      // Estimate minimum days needed (at least 1 day per city, more for major attractions)
      const majorAttractions = ["Siem Reap", "Ha Long Bay", "Sapa"];
      let minDays = requiredCities.length;
      requiredCities.forEach(city => {
        if (majorAttractions.includes(city)) {
          minDays += 1; // Major attractions need at least 2 days
        }
      });
      
      if (numDays < minDays) {
        warningDiv.style.display = "block";
        warningText.textContent = `You've selected ${requiredCities.length} destination(s) (${requiredCities.join(", ")}) but only have ${numDays} day(s). Recommended minimum: ${minDays} days to properly visit all selected places. Consider increasing trip duration or reducing selections.`;
      } else {
        warningDiv.style.display = "none";
      }
    }

    // Initialize on page load
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initializePlacesToVisit);
    } else {
      initializePlacesToVisit();
    }

    // Update warning when days or places change
    $("numDays")?.addEventListener("change", () => {
      const numDays = parseInt($("numDays").value, 10) || 1;
      const places = parsePlacesToVisit();
      const requiredCities = extractRequiredCities(places);
      checkPlacesFitDays(numDays, requiredCities);
    });

    // Update warning when places change
    $("placesToVisitCheckboxes")?.addEventListener("change", () => {
      const numDays = parseInt($("numDays").value, 10) || 1;
      const places = parsePlacesToVisit();
      const requiredCities = extractRequiredCities(places);
      checkPlacesFitDays(numDays, requiredCities);
    });

    $("customPlaces")?.addEventListener("input", () => {
      const numDays = parseInt($("numDays").value, 10) || 1;
      const places = parsePlacesToVisit();
      const requiredCities = extractRequiredCities(places);
      checkPlacesFitDays(numDays, requiredCities);
    });

    // Initial warning check after initialization
    setTimeout(() => {
      const numDays = parseInt($("numDays")?.value, 10) || 1;
      const places = parsePlacesToVisit();
      const requiredCities = extractRequiredCities(places);
      checkPlacesFitDays(numDays, requiredCities);
    }, 100);

    function collectTravellerData() {
      let endCity = $("endCity").value || $("startCity").value;
      const specialRequests = $("specialRequests").value.trim();
      const placesToVisit = parsePlacesToVisit();

      let arrivalTime = $("arrivalTime").value;
      let departureTime = $("departureTime").value;

      if (!arrivalTime || !departureTime) {
        const parsed = parseTimesFromText(specialRequests);
        if (!arrivalTime && parsed.arrival) arrivalTime = parsed.arrival;
        if (!departureTime && parsed.departure) departureTime = parsed.departure;
        if (!$("arrivalTime").value && parsed.arrival) $("arrivalTime").value = parsed.arrival;
        if (!$("departureTime").value && parsed.departure) $("departureTime").value = parsed.departure;
      }

      state.traveller = {
        groupName: $("groupName").value.trim(),
        nationality: $("nationality").value,
        ageGroup: $("ageGroup").value,
        numDays: parseInt($("numDays").value, 10) || 1,
        startDate: $("startDate").value,
        endDate: $("endDate").value,
        arrivalTime,
        departureTime,
        area: $("area").value,
        startCity: $("startCity").value,
        endCity,
        tourType: $("tourType").value,
        tourLevel: $("tourLevel").value,
        hotelRating: $("hotelRating").value,
        foodPref: $("foodPref").value,
        specialRequests,
        placesToVisit,
        budgetHint: $("budgetHint").value,
        paceHint: $("paceHint").value
      };
    }

    function getDefaultCityForDay(dayIndex) {
      const { startCity, endCity, numDays } = state.traveller;
      if (numDays <= 1 || !endCity || endCity === startCity) return startCity;
      if (dayIndex === numDays - 1) return endCity;
      return startCity;
    }

    // ====== Geographic routing helpers ======
    const CITY_CORRIDOR = [
      { name: "Ho Chi Minh City", region: "south" },
      { name: "Mekong Delta", region: "south" },
      { name: "Nha Trang", region: "central" },
      { name: "Da Lat", region: "central" },
      { name: "Hoi An", region: "central" },
      { name: "Hue", region: "central" },
      { name: "Phong Nha", region: "central" },
      { name: "Ninh Binh", region: "north" },
      { name: "Hanoi", region: "north" },
      { name: "Ha Long Bay", region: "north" },
      { name: "Sapa", region: "north" }
    ];

    const BIG_STAY_CITIES = new Set([
      "Ho Chi Minh City",
      "Hoi An",
      "Hue",
      "Hanoi",
      "Ha Long Bay",
      "Sapa"
    ]);

    function findCityIndexInCorridor(cityName) {
      if (!cityName) return -1;
      return CITY_CORRIDOR.findIndex(c => c.name === cityName);
    }

    // ========= CAMBODIA EXTENSION CONFIG =========
    const CAMBODIA_BLOCK = ["Phnom Penh", "Siem Reap", "Siem Reap", "Siem Reap"];

    function isCambodiaArea(area) {
      if (!area) return false;
      const a = area.toLowerCase();
      return a.includes("cambodia");
    }

    // Decide at which position to inject the 4-day Cambodia block
    function decideCambodiaInsertionIndex(vnRoute, travellerProfile) {
      if (!Array.isArray(vnRoute) || vnRoute.length === 0) return 0;

      const startCity = travellerProfile.startCity || vnRoute[0];
      const endCity   = travellerProfile.endCity   || vnRoute[vnRoute.length - 1];

      const northCities  = new Set(["Hanoi", "Ninh Binh", "Ha Long Bay", "Sapa"]);
      const southCities  = new Set(["Ho Chi Minh City", "Mekong Delta", "Can Tho"]);
      const centralCities = new Set(["Hoi An", "Hue", "Da Nang", "Da Lat", "Nha Trang", "Phong Nha"]);

      const classify = (city) => {
        if (northCities.has(city)) return "north";
        if (southCities.has(city)) return "south";
        if (centralCities.has(city)) return "central";
        return "other";
      };

      const startRegion = classify(startCity);
      const endRegion   = classify(endCity);
      const len = vnRoute.length;

      // Short trips: inject after day 1
      if (travellerProfile.numDays <= 11 || travellerProfile.numberOfDays <= 11) {
        return Math.min(1, len);
      }

      // North ‚Üí South: Cambodia roughly in the middle
      if (startRegion === "north" && (endRegion === "south" || endRegion === "central")) {
        return Math.floor(len / 2);
      }

      // South ‚Üí North: also mid-ish
      if (startRegion === "south" && (endRegion === "north" || endRegion === "central")) {
        return Math.floor(len / 2);
      }

      // Central or unclear: slightly after first third
      return Math.max(1, Math.floor(len / 3));
    }

    // Inject Cambodia 4-day block into an existing Vietnam-only route
    function applyCambodiaExtensionToRoute(vnRoute, travellerProfile) {
      const totalDays = travellerProfile.numDays || travellerProfile.numberOfDays || vnRoute.length;
      const CAMBODIA_DAYS = 4;

      if (!isCambodiaArea(travellerProfile.area)) {
        return vnRoute; // no change
      }

      if (totalDays <= CAMBODIA_DAYS + 1) {
        // Trip too short: just append Cambodia and trim to length
        const mergedShort = [...vnRoute, ...CAMBODIA_BLOCK];
        return mergedShort.slice(0, totalDays);
      }

      const vnDays = totalDays - CAMBODIA_DAYS;
      if (vnDays <= 1) {
        const merged = [...vnRoute.slice(0, 1), ...CAMBODIA_BLOCK];
        return merged.slice(0, totalDays);
      }

      // Compress Vietnam route down to vnDays
      let compressed = [];

      if (vnRoute.length <= vnDays) {
        compressed = vnRoute.slice();
      } else {
        // keep first and last city, distribute others
        compressed.push(vnRoute[0]);
        const remainingSlots = vnDays - 2;
        const innerLen = vnRoute.length - 2;
        for (let i = 0; i < remainingSlots; i++) {
          const idx = 1 + Math.round((i * innerLen) / Math.max(1, remainingSlots - 1));
          compressed.push(vnRoute[idx]);
        }
        compressed.push(vnRoute[vnRoute.length - 1]);
      }

      // Decide where to inject Cambodia in the compressed VN route
      const insertIndex = decideCambodiaInsertionIndex(compressed, travellerProfile);
      const before = compressed.slice(0, insertIndex);
      const after  = compressed.slice(insertIndex);

      let fullRoute = [...before, ...CAMBODIA_BLOCK, ...after];

      // Ensure final length == totalDays
      if (fullRoute.length > totalDays) {
        // Trim from the middle section between first and last city
        const toRemove = fullRoute.length - totalDays;
        const keepStart = Math.ceil((fullRoute.length - toRemove) / 2);
        const prefix = fullRoute.slice(0, keepStart);
        const suffix = fullRoute.slice(fullRoute.length - (totalDays - keepStart));
        fullRoute = [...prefix, ...suffix];
      } else if (fullRoute.length < totalDays) {
        const lastCity = fullRoute[fullRoute.length - 1];
        while (fullRoute.length < totalDays) {
          fullRoute.push(lastCity);
        }
      }

      return fullRoute;
    }

    // Build a geographic route (array of city names) based on start, end, days, and area.
    // Check if a city is in Cambodia
    function isCambodiaCity(cityName) {
      if (!cityName) return false;
      const cambodiaCities = ["Phnom Penh", "Siem Reap", "Battambang"];
      return cambodiaCities.includes(cityName);
    }

    // Check if a city is in Vietnam
    function isVietnamCity(cityName) {
      if (!cityName) return false;
      return CITY_CORRIDOR.some(c => c.name === cityName) || 
             ["Da Nang", "Can Tho", "Phu Quoc", "Mui Ne"].includes(cityName);
    }

    // Build intelligent Vietnam-Cambodia routes that maximize Vietnam coverage
    function buildVietnamCambodiaRoute(travellerProfile) {
      const startCity = travellerProfile.startCity;
      const endCity = travellerProfile.endCity;
      const days = travellerProfile.numDays || travellerProfile.numberOfDays || 1;

      if (!startCity || !endCity || days <= 0) return null;

      const startIsCambodia = isCambodiaCity(startCity);
      const endIsCambodia = isCambodiaCity(endCity);
      const startIsVietnam = isVietnamCity(startCity);
      const endIsVietnam = isVietnamCity(endCity);

      // Only handle Vietnam <-> Cambodia routes
      if (!((startIsVietnam && endIsCambodia) || (startIsCambodia && endIsVietnam))) {
        return null;
      }

      // Determine Vietnam portion and Cambodia portion
      let vietnamStart, vietnamEnd, cambodiaCity;
      if (startIsVietnam && endIsCambodia) {
        vietnamStart = startCity;
        vietnamEnd = null; // Will be determined based on route
        cambodiaCity = endCity;
      } else {
        vietnamStart = null; // Will be determined based on route
        vietnamEnd = endCity;
        cambodiaCity = startCity;
      }

      // Calculate how many days to spend in Vietnam vs Cambodia FIRST
      let vietnamDays, cambodiaDays;
      
      if (days <= 7) {
        vietnamDays = Math.max(2, Math.floor(days * 0.6));
        cambodiaDays = days - vietnamDays;
      } else if (days <= 14) {
        vietnamDays = Math.max(4, Math.floor(days * 0.7));
        cambodiaDays = days - vietnamDays;
      } else {
        vietnamDays = Math.max(8, Math.floor(days * 0.75));
        cambodiaDays = days - vietnamDays;
      }

      // Ensure we have at least 2 days in Cambodia for meaningful experience
      if (cambodiaDays < 2 && days >= 4) {
        cambodiaDays = 2;
        vietnamDays = days - cambodiaDays;
      }

      // For Vietnam-to-Cambodia: maximize Vietnam coverage
      // Build comprehensive Vietnam route before crossing border
      let vietnamRoute = [];
      
      if (startIsVietnam && endIsCambodia) {
        // Starting in Vietnam, ending in Cambodia
        // For Cambodia trips, focus on South and Central Vietnam (closer to border)
        // Don't go all the way north unless trip is very long
        
        const startIdx = findCityIndexInCorridor(vietnamStart);
        
        if (startIdx === -1) {
          // Start city not in corridor
          if (vietnamStart === "Ho Chi Minh City") {
            // From HCMC to Cambodia: focus on South and Central Vietnam
            vietnamRoute = buildVietnamRouteToCambodiaFromSouth(days, vietnamDays);
          } else if (vietnamStart === "Hanoi") {
            // From Hanoi to Cambodia: go south but focus on Central/South
            vietnamRoute = buildVietnamRouteToCambodiaFromNorth(days, vietnamDays);
          } else {
            // Other Vietnam cities - build route toward Cambodia
            const closestIdx = findClosestCorridorIndex(vietnamStart);
            if (closestIdx >= 0) {
              vietnamRoute = buildVietnamRouteToCambodiaFromIndex(closestIdx, days, vietnamDays);
            }
          }
        } else {
          // Start city is in corridor
          if (startIdx <= 2) {
            // Starting in South (HCMC, Mekong, Nha Trang) - stay in South/Central
            vietnamRoute = buildVietnamRouteToCambodiaFromSouth(days, vietnamDays);
          } else if (startIdx >= 7) {
            // Starting in North - go south toward Cambodia
            vietnamRoute = buildVietnamRouteToCambodiaFromNorth(days, vietnamDays);
          } else {
            // Starting in Central - explore Central and South
            vietnamRoute = buildVietnamRouteToCambodiaFromIndex(startIdx, days, vietnamDays);
          }
        }
      } else {
        // Starting in Cambodia, ending in Vietnam
        // Build route through Vietnam ending at destination
        const endIdx = findCityIndexInCorridor(vietnamEnd);
        
        if (endIdx === -1) {
          if (vietnamEnd === "Ho Chi Minh City") {
            vietnamRoute = buildVietnamRouteFromCambodiaToSouth(days, vietnamDays);
          } else if (vietnamEnd === "Hanoi") {
            vietnamRoute = buildVietnamRouteFromCambodiaToNorth(days, vietnamDays);
          } else {
            const closestIdx = findClosestCorridorIndex(vietnamEnd);
            if (closestIdx >= 0) {
              vietnamRoute = buildVietnamRouteFromCambodiaToIndex(closestIdx, vietnamDays);
            }
          }
        } else {
          if (endIdx <= 2) {
            vietnamRoute = buildVietnamRouteFromCambodiaToSouth(days, vietnamDays);
          } else if (endIdx >= 7) {
            vietnamRoute = buildVietnamRouteFromCambodiaToNorth(days, vietnamDays);
          } else {
            vietnamRoute = buildVietnamRouteFromCambodiaToIndex(endIdx, vietnamDays);
          }
        }
      }
      
      // Ensure route matches vietnamDays exactly
      if (vietnamRoute.length === 0) {
        // Fallback: create simple route
        vietnamRoute = startIsVietnam ? [vietnamStart] : [vietnamEnd];
        while (vietnamRoute.length < vietnamDays) {
          vietnamRoute.push(vietnamRoute[vietnamRoute.length - 1]);
        }
        vietnamRoute = vietnamRoute.slice(0, vietnamDays);
      } else {
        // Ensure route starts with the actual start city (for Vietnam->Cambodia)
        if (startIsVietnam && endIsCambodia && vietnamRoute[0] !== vietnamStart) {
          vietnamRoute[0] = vietnamStart;
        }
        
        // Trim or extend to match exactly
        if (vietnamRoute.length > vietnamDays) {
          vietnamRoute = vietnamRoute.slice(0, vietnamDays);
          // Ensure last day is a good transition city (near border) for Vietnam->Cambodia
          if (startIsVietnam && endIsCambodia) {
            const borderCities = ["Ho Chi Minh City", "Mekong Delta"];
            if (!borderCities.includes(vietnamRoute[vietnamRoute.length - 1]) && vietnamRoute.length > 0) {
              vietnamRoute[vietnamRoute.length - 1] = borderCities[0];
            }
          }
        } else if (vietnamRoute.length < vietnamDays) {
          // Extend route by repeating key cities
          const lastCity = vietnamRoute[vietnamRoute.length - 1];
          while (vietnamRoute.length < vietnamDays) {
            vietnamRoute.push(lastCity);
          }
        }
      }

      // Build Cambodia portion
      const cambodiaRoute = Array(cambodiaDays).fill(cambodiaCity);

      // Combine routes - ensure total length equals days
      let finalRoute;
      if (startIsVietnam && endIsCambodia) {
        finalRoute = [...vietnamRoute, ...cambodiaRoute];
      } else {
        finalRoute = [...cambodiaRoute, ...vietnamRoute];
      }
      
      // Ensure final route matches exact number of days
      if (finalRoute.length !== days) {
        if (finalRoute.length > days) {
          finalRoute = finalRoute.slice(0, days);
        } else {
          const lastCity = finalRoute[finalRoute.length - 1];
          while (finalRoute.length < days) {
            finalRoute.push(lastCity);
          }
        }
      }
      
      return finalRoute;
    }

    // Helper: Find closest corridor index for a city
    function findClosestCorridorIndex(cityName) {
      // For cities not in corridor, map to closest
      const cityMap = {
        "Da Nang": 4, // Closest to Hoi An
        "Can Tho": 1, // Closest to Mekong Delta
        "Phu Quoc": 0, // Closest to HCMC
        "Mui Ne": 2, // Closest to Nha Trang
      };
      return cityMap[cityName] ?? -1;
    }

    // Build Vietnam route from South (HCMC) toward Cambodia - focus on South/Central
    function buildVietnamRouteToCambodiaFromSouth(totalDays, vietnamDays) {
      // For Cambodia trips: 
      // - 15+ days: cover South, Central, AND North Vietnam
      // - <15 days: focus on South and Central only
      let fullRoute;
      
      if (totalDays >= 15) {
        // Long trips (15+ days): Full Vietnam coverage - South, Central, and North
        fullRoute = [
          "Ho Chi Minh City",
          "Ho Chi Minh City", 
          "Mekong Delta",
          "Nha Trang",
          "Da Lat",
          "Hoi An",
          "Hoi An",
          "Hue",
          "Phong Nha",
          "Ninh Binh",
          "Hanoi",
          "Hanoi",
          "Ha Long Bay",
          "Sapa"
        ];
      } else {
        // Shorter trips (<15 days): focus on South and Central only
        fullRoute = [
          "Ho Chi Minh City",
          "Ho Chi Minh City", 
          "Mekong Delta",
          "Nha Trang",
          "Da Lat",
          "Hoi An",
          "Hoi An",
          "Hue"
        ];
      }
      
      return distributeDaysAcrossRoute(fullRoute, vietnamDays, false);
    }

    // Build Vietnam route from North toward Cambodia - go south through Central
    function buildVietnamRouteToCambodiaFromNorth(totalDays, vietnamDays) {
      let fullRoute;
      
      if (totalDays >= 15) {
        // Long trips (15+ days): Full Vietnam coverage - North, Central, and South
        fullRoute = [
          "Hanoi",
          "Hanoi",
          "Ninh Binh",
          "Ha Long Bay",
          "Sapa",
          "Phong Nha",
          "Hue",
          "Hoi An",
          "Hoi An",
          "Da Lat",
          "Nha Trang",
          "Mekong Delta",
          "Ho Chi Minh City",
          "Ho Chi Minh City"
        ];
      } else {
        // Shorter trips (<15 days): North and Central, heading toward South
        fullRoute = [
          "Hanoi",
          "Ninh Binh",
          "Phong Nha",
          "Hue",
          "Hoi An",
          "Hoi An",
          "Da Lat",
          "Nha Trang",
          "Ho Chi Minh City"
        ];
      }
      
      return distributeDaysAcrossRoute(fullRoute, vietnamDays, false);
    }

    // Build route from a corridor index toward Cambodia
    function buildVietnamRouteToCambodiaFromIndex(startIdx, totalDays, vietnamDays) {
      const corridor = CITY_CORRIDOR.map(c => c.name);
      // For Cambodia trips, determine route based on start position and trip length
      let route;
      
      if (totalDays >= 15) {
        // Long trips (15+ days): Include full Vietnam coverage - South, Central, and North
        if (startIdx <= 2) {
          // Starting in South - go through Central to North, then back toward border
          route = [
            ...corridor.slice(0, startIdx + 1), // South cities up to start
            ...corridor.slice(startIdx + 1), // Central and North
            "Ho Chi Minh City" // End near border for Cambodia crossing
          ];
        } else if (startIdx <= 6) {
          // Starting in Central - explore all regions
          route = [
            ...corridor.slice(0, startIdx + 1), // South and Central up to start
            ...corridor.slice(startIdx + 1), // Rest of Central and North
            ...corridor.slice(0, 2) // Back to South for border crossing
          ];
        } else {
          // Starting in North - go through Central to South
          route = corridor; // Full corridor
        }
      } else {
        // Shorter trips (<15 days): Focus on South and Central only
        if (startIdx <= 2) {
          // Already in South - explore South and Central
          route = corridor.slice(0, Math.min(7, corridor.length));
        } else if (startIdx <= 6) {
          // In Central - explore Central and South
          route = corridor.slice(0, Math.min(startIdx + 4, corridor.length));
        } else {
          // In North - go south through Central
          route = corridor.slice(0, Math.min(startIdx + 1, corridor.length)).reverse();
        }
      }
      
      return distributeDaysAcrossRoute(route, vietnamDays, false);
    }

    // Build Vietnam route from Cambodia to South (ending in HCMC)
    function buildVietnamRouteFromCambodiaToSouth(totalDays, vietnamDays) {
      const fullRoute = [
        "Ho Chi Minh City",
        "Ho Chi Minh City",
        "Mekong Delta",
        "Nha Trang",
        "Da Lat",
        "Hoi An",
        "Hoi An"
      ];
      
      return distributeDaysAcrossRoute(fullRoute, vietnamDays, false);
    }

    // Build Vietnam route from Cambodia to North (ending in Hanoi)
    function buildVietnamRouteFromCambodiaToNorth(totalDays, vietnamDays) {
      let fullRoute;
      
      if (totalDays >= 15) {
        // Long trips (15+ days): Full Vietnam coverage - South, Central, and North
        fullRoute = [
          "Ho Chi Minh City",
          "Ho Chi Minh City",
          "Mekong Delta",
          "Nha Trang",
          "Da Lat",
          "Hoi An",
          "Hoi An",
          "Hue",
          "Phong Nha",
          "Ninh Binh",
          "Hanoi",
          "Hanoi",
          "Ha Long Bay",
          "Sapa"
        ];
      } else {
        // Shorter trips (<15 days): South, Central, and touch North
        fullRoute = [
          "Ho Chi Minh City",
          "Mekong Delta",
          "Nha Trang",
          "Da Lat",
          "Hoi An",
          "Hoi An",
          "Hue",
          "Phong Nha",
          "Ninh Binh",
          "Hanoi"
        ];
      }
      
      return distributeDaysAcrossRoute(fullRoute, vietnamDays, false);
    }

    // Build route from Cambodia to a corridor index
    function buildVietnamRouteFromCambodiaToIndex(endIdx, vietnamDays) {
      const corridor = CITY_CORRIDOR.map(c => c.name);
      // From Cambodia, go north through corridor to end index
      const route = corridor.slice(0, Math.min(endIdx + 1, corridor.length));
      return distributeDaysAcrossRoute(route, vietnamDays, false);
    }

    // Build round-trip route by city name (for cities not in corridor)
    // IMPORTANT: No backtracking - go out in one direction, return via different route or extend stays
    function buildRoundTripRouteByName(startCity, totalDays) {
      // Map cities to their region for route planning
      const cityRegionMap = {
        "Ho Chi Minh City": "south",
        "Can Tho": "south",
        "Phu Quoc": "south",
        "Mui Ne": "south",
        "Da Nang": "central",
        "Hoi An": "central",
        "Hue": "central",
        "Da Lat": "central",
        "Nha Trang": "central",
        "Hanoi": "north",
        "Ha Long Bay": "north",
        "Sapa": "north",
        "Ninh Binh": "north",
        "Phnom Penh": "cambodia",
        "Siem Reap": "cambodia",
        "Battambang": "cambodia"
      };
      
      const region = cityRegionMap[startCity] || "south";
      let explorationRoute = [];
      
      if (totalDays >= 15) {
        // Long trips: Comprehensive tour - go in ONE direction, extend stays, return only at end
        if (region === "south" || region === "cambodia") {
          // Start in South, go North, extend stays, return only at end
          explorationRoute = [
            startCity,
            startCity,
            "Mekong Delta",
            "Nha Trang",
            "Nha Trang",
            "Da Lat",
            "Da Lat",
            "Hoi An",
            "Hoi An",
            "Hoi An",
            "Hue",
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Ninh Binh",
            "Hanoi",
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            "Ha Long Bay",
            "Sapa",
            "Sapa",
            "Hanoi",
            startCity // Return only at the end
          ];
        } else if (region === "central") {
          // Start in Central, go North then South, extend stays
          explorationRoute = [
            startCity,
            startCity,
            "Hue",
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Ninh Binh",
            "Hanoi",
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            "Ha Long Bay",
            "Sapa",
            "Sapa",
            "Hanoi",
            "Ninh Binh",
            "Phong Nha",
            "Hue",
            "Hoi An",
            "Da Lat",
            "Da Lat",
            "Nha Trang",
            "Nha Trang",
            "Mekong Delta",
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            startCity // Return only at the end
          ];
        } else {
          // North - go South, extend stays, return only at end
          explorationRoute = [
            startCity,
            startCity,
            "Sapa",
            "Sapa",
            "Ha Long Bay",
            "Ha Long Bay",
            "Ninh Binh",
            "Ninh Binh",
            "Phong Nha",
            "Hue",
            "Hue",
            "Hoi An",
            "Hoi An",
            "Hoi An",
            "Da Lat",
            "Da Lat",
            "Nha Trang",
            "Nha Trang",
            "Mekong Delta",
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            startCity // Return only at the end
          ];
        }
      } else if (totalDays >= 8) {
        // Medium trips: Explore without backtracking
        if (region === "south" || region === "cambodia") {
          explorationRoute = [
            startCity,
            startCity,
            "Mekong Delta",
            "Nha Trang",
            "Da Lat",
            "Hoi An",
            "Hoi An",
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            startCity // Return only at the end
          ];
        } else if (region === "central") {
          explorationRoute = [
            startCity,
            startCity,
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            "Hanoi",
            "Ninh Binh",
            "Phong Nha",
            "Hue",
            "Hoi An",
            "Da Lat",
            "Nha Trang",
            "Mekong Delta",
            "Ho Chi Minh City",
            startCity // Return only at the end
          ];
        } else {
          // North
          explorationRoute = [
            startCity,
            startCity,
            "Ninh Binh",
            "Ha Long Bay",
            "Sapa",
            "Hanoi",
            "Phong Nha",
            "Hue",
            "Hoi An",
            "Hoi An",
            "Da Lat",
            "Nha Trang",
            "Mekong Delta",
            "Ho Chi Minh City",
            startCity // Return only at the end
          ];
        }
      } else {
        // Short trips: Explore nearby without backtracking
        if (region === "south" || region === "cambodia") {
          explorationRoute = [
            startCity,
            startCity,
            "Mekong Delta",
            "Nha Trang",
            "Da Lat",
            "Hoi An",
            startCity // Return only at the end
          ];
        } else if (region === "central") {
          explorationRoute = [
            startCity,
            startCity,
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Hanoi",
            startCity // Return only at the end
          ];
        } else {
          // North
          explorationRoute = [
            startCity,
            startCity,
            "Ninh Binh",
            "Ha Long Bay",
            "Sapa",
            startCity // Return only at the end
          ];
        }
      }
      
      // Ensure route starts and ends with start city
      if (explorationRoute[0] !== startCity) {
        explorationRoute[0] = startCity;
      }
      if (explorationRoute[explorationRoute.length - 1] !== startCity) {
        explorationRoute[explorationRoute.length - 1] = startCity;
      }
      
      return distributeDaysAcrossRoute(explorationRoute, totalDays, false);
    }

    // Build a round-trip route from a start city (exploring Vietnam and returning)
    function buildRoundTripRoute(startCity, totalDays, startIdx) {
      // Determine route scope based on trip length
      // IMPORTANT: For round trips, we go in ONE direction and extend stays
      // instead of backtracking. Only return to start city at the very end.
      let explorationRoute = [];
      
      if (totalDays >= 15) {
        // Long trips (15-30 days): Comprehensive Vietnam tour
        // Go out from start city in one direction, extend stays, return only at end
        if (startIdx <= 2) {
          // Starting in South (HCMC, Mekong, Nha Trang) - go North, extend stays
          explorationRoute = [
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            "Mekong Delta",
            "Nha Trang",
            "Nha Trang",
            "Da Lat",
            "Da Lat",
            "Hoi An",
            "Hoi An",
            "Hoi An",
            "Hue",
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Ninh Binh",
            "Hanoi",
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            "Ha Long Bay",
            "Sapa",
            "Sapa",
            "Hanoi",
            "Ho Chi Minh City" // Return only at the end
          ];
        } else if (startIdx >= 7) {
          // Starting in North (Hanoi, Ha Long Bay, Sapa) - go South, extend stays
          explorationRoute = [
            "Hanoi",
            "Hanoi",
            "Sapa",
            "Sapa",
            "Ha Long Bay",
            "Ha Long Bay",
            "Ninh Binh",
            "Ninh Binh",
            "Phong Nha",
            "Hue",
            "Hue",
            "Hoi An",
            "Hoi An",
            "Hoi An",
            "Da Lat",
            "Da Lat",
            "Nha Trang",
            "Nha Trang",
            "Mekong Delta",
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            "Hanoi" // Return only at the end
          ];
        } else {
          // Starting in Central (Da Lat, Hoi An, Hue, Phong Nha) - go North then South, extend stays
          explorationRoute = [
            "Hoi An",
            "Hoi An",
            "Hue",
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Ninh Binh",
            "Hanoi",
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            "Ha Long Bay",
            "Sapa",
            "Sapa",
            "Hanoi",
            "Ninh Binh",
            "Phong Nha",
            "Hue",
            "Hoi An",
            "Da Lat",
            "Da Lat",
            "Nha Trang",
            "Nha Trang",
            "Mekong Delta",
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            "Hoi An" // Return only at the end
          ];
        }
      } else if (totalDays >= 8) {
        // Medium trips (8-14 days): Explore multiple regions without backtracking
        if (startIdx <= 2) {
          // Starting in South - go North, extend stays
          explorationRoute = [
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            "Mekong Delta",
            "Nha Trang",
            "Da Lat",
            "Hoi An",
            "Hoi An",
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            "Ho Chi Minh City" // Return only at the end
          ];
        } else if (startIdx >= 7) {
          // Starting in North - go South, extend stays
          explorationRoute = [
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            "Sapa",
            "Hanoi",
            "Ninh Binh",
            "Phong Nha",
            "Hue",
            "Hoi An",
            "Hoi An",
            "Da Lat",
            "Nha Trang",
            "Mekong Delta",
            "Ho Chi Minh City",
            "Hanoi" // Return only at the end
          ];
        } else {
          // Starting in Central - go North then South, extend stays
          explorationRoute = [
            "Hoi An",
            "Hoi An",
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Hanoi",
            "Hanoi",
            "Ha Long Bay",
            "Hanoi",
            "Ninh Binh",
            "Phong Nha",
            "Hue",
            "Hoi An",
            "Da Lat",
            "Nha Trang",
            "Mekong Delta",
            "Ho Chi Minh City",
            "Hoi An" // Return only at the end
          ];
        }
      } else {
        // Short trips (4-7 days): Explore nearby regions without backtracking
        if (startIdx <= 2) {
          // Starting in South - explore South and nearby Central
          explorationRoute = [
            "Ho Chi Minh City",
            "Ho Chi Minh City",
            "Mekong Delta",
            "Nha Trang",
            "Da Lat",
            "Hoi An",
            "Ho Chi Minh City" // Return only at the end
          ];
        } else if (startIdx >= 7) {
          // Starting in North - explore North
          explorationRoute = [
            "Hanoi",
            "Hanoi",
            "Ninh Binh",
            "Ha Long Bay",
            "Sapa",
            "Hanoi",
            "Hanoi" // Extend stay instead of backtracking
          ];
        } else {
          // Starting in Central - explore Central and nearby regions
          explorationRoute = [
            "Hoi An",
            "Hoi An",
            "Hue",
            "Phong Nha",
            "Ninh Binh",
            "Hanoi",
            "Hoi An" // Return only at the end
          ];
        }
      }
      
      // Ensure route starts and ends with the start city
      if (explorationRoute[0] !== startCity) {
        explorationRoute[0] = startCity;
      }
      if (explorationRoute[explorationRoute.length - 1] !== startCity) {
        explorationRoute[explorationRoute.length - 1] = startCity;
      }
      
      // Distribute days across the route (this will extend stays further if needed)
      return distributeDaysAcrossRoute(explorationRoute, totalDays, false);
    }

    // Distribute days across a route, spending more time in key cities
    function distributeDaysAcrossRoute(route, targetDays, goingNorth) {
      if (route.length === 0) return [];
      if (targetDays <= route.length) {
        // Fewer days than cities - sample evenly
        const result = [];
        for (let i = 0; i < targetDays; i++) {
          const idx = Math.round((i / (targetDays - 1)) * (route.length - 1));
          result.push(route[idx]);
        }
        return result;
      }

      // More days than cities - distribute extra nights
      const keyCities = new Set(["Ho Chi Minh City", "Hoi An", "Hue", "Hanoi", "Ha Long Bay", "Sapa"]);
      const baseNights = new Array(route.length).fill(1);
      let extra = targetDays - route.length;

      // Distribute extra nights to key cities, start, and end
      while (extra > 0) {
        for (let i = 0; i < route.length && extra > 0; i++) {
          const city = route[i];
          const isStart = i === 0;
          const isEnd = i === route.length - 1;
          if (keyCities.has(city) || isStart || isEnd) {
            baseNights[i] += 1;
            extra -= 1;
          }
        }
        // If still have extra, distribute evenly
        if (extra > 0) {
          for (let i = 0; i < route.length && extra > 0; i++) {
            baseNights[i] += 1;
            extra -= 1;
          }
        }
      }

      const result = [];
      for (let i = 0; i < route.length; i++) {
        for (let n = 0; n < baseNights[i]; n++) {
          result.push(route[i]);
        }
      }

      return result;
    }

    // Modify route to include required cities from places to visit
    function prioritizeRequiredCities(route, requiredCities, days) {
      if (!requiredCities || requiredCities.length === 0) return route;
      
      const routeSet = new Set(route);
      const missingCities = requiredCities.filter(city => !routeSet.has(city));
      
      if (missingCities.length === 0) {
        // All required cities are already in route
        return route;
      }
      
      // Separate Cambodia cities from other missing cities (they need special handling)
      const cambodiaCities = missingCities.filter(city => getCityRegion(city) === "cambodia");
      const otherMissingCities = missingCities.filter(city => getCityRegion(city) !== "cambodia");
      
      // Need to add missing cities to route
      let enhancedRoute = [...route];
      
      // Debug: log if we have Cambodia cities to add
      if (cambodiaCities.length > 0) {
        console.log("Adding Cambodia cities:", cambodiaCities, "to route of", enhancedRoute.length, "days");
      }
      
      // First, handle Cambodia cities - insert them after Central Vietnam, before North
      if (cambodiaCities.length > 0) {
        const cambodiaCity = cambodiaCities[0]; // Use first Cambodia city
        // Cambodia cities need 2-3 days minimum (especially Siem Reap for Angkor Wat needs 3 days)
        let cambodiaDays = 2;
        if (cambodiaCity === "Siem Reap") {
          cambodiaDays = Math.min(3, Math.max(3, Math.floor(days * 0.2))); // Siem Reap needs at least 3 days
        } else {
          cambodiaDays = Math.min(3, Math.max(2, Math.floor(days * 0.15)));
        }
        const cambodiaBlock = Array(cambodiaDays).fill(cambodiaCity);
        
        // Find best insertion point: after Central Vietnam (Hoi An/Hue), before North (Hanoi)
        const southCentralCities = ["Ho Chi Minh City", "Mekong Delta", "Nha Trang", "Da Lat", "Da Nang", "Hoi An", "Hue"];
        const northCities = ["Hanoi", "Ninh Binh", "Ha Long Bay", "Sapa"];
        
        let insertIndex = enhancedRoute.length;
        // Find last occurrence of South/Central city
        for (let i = enhancedRoute.length - 1; i >= 0; i--) {
          if (southCentralCities.includes(enhancedRoute[i])) {
            insertIndex = i + 1;
            break;
          }
        }
        
        // If no South/Central found, insert around 60% through route
        if (insertIndex === enhancedRoute.length) {
          insertIndex = Math.max(1, Math.floor(enhancedRoute.length * 0.6));
        }
        
        // Insert Cambodia block
        enhancedRoute.splice(insertIndex, 0, ...cambodiaBlock);
        console.log("Added Cambodia:", cambodiaCity, "x", cambodiaDays, "days at index", insertIndex, "Route now:", enhancedRoute.length, "days");
      }
      
      // Then handle other missing cities
      otherMissingCities.forEach(city => {
        const cityIdx = findCityIndexInCorridor(city);
        if (cityIdx === -1) {
          // City not in corridor - append or prepend based on region
          const cityRegion = getCityRegion(city);
          const startIdx = findCityIndexInCorridor(route[0]);
          
          if (cityRegion === "south") {
            if (startIdx <= 2) {
              enhancedRoute.splice(1, 0, city);
            } else {
              enhancedRoute.push(city);
            }
          } else if (cityRegion === "north") {
            if (startIdx <= 2) {
              enhancedRoute.push(city);
            } else {
              enhancedRoute.splice(1, 0, city);
            }
          } else {
            const midPoint = Math.floor(enhancedRoute.length / 2);
            enhancedRoute.splice(midPoint, 0, city);
          }
        } else {
          // City is in corridor - insert at logical position
          let insertIndex = enhancedRoute.length;
          for (let i = 0; i < enhancedRoute.length; i++) {
            const routeCityIdx = findCityIndexInCorridor(enhancedRoute[i]);
            if (routeCityIdx !== -1 && routeCityIdx > cityIdx) {
              insertIndex = i;
              break;
            }
          }
          enhancedRoute.splice(insertIndex, 0, city);
        }
      });
      
      // Ensure route doesn't exceed days (but prioritize required cities, especially Cambodia)
      if (enhancedRoute.length > days) {
        const startCity = enhancedRoute[0];
        const endCity = enhancedRoute[enhancedRoute.length - 1];
        const requiredSet = new Set(requiredCities);
        
        // Separate Cambodia cities from other required cities (they need multiple days)
        const cambodiaRequired = requiredCities.filter(c => getCityRegion(c) === "cambodia");
        const otherRequired = requiredCities.filter(c => getCityRegion(c) !== "cambodia");
        
        // Build essential route: start + Cambodia cities (with multiple days) + other required + end
        const essential = [startCity];
        
        // Add Cambodia cities with appropriate days (2-3 days for Siem Reap)
        cambodiaRequired.forEach(city => {
          const cambodiaDays = city === "Siem Reap" ? 3 : 2; // Siem Reap needs 3 days for Angkor Wat
          for (let i = 0; i < cambodiaDays && essential.length < days - 1; i++) {
            essential.push(city);
          }
        });
        
        // Add other required cities (1 day each)
        otherRequired.forEach(city => {
          if (city !== startCity && city !== endCity && !essential.includes(city) && essential.length < days - 1) {
            essential.push(city);
          }
        });
        
        // Add end city
        if (endCity !== startCity && !essential.includes(endCity) && essential.length < days) {
          essential.push(endCity);
        }
        
        // If essential route fits, use it and fill remaining slots
        if (essential.length <= days) {
          const essentialSet = new Set(essential);
          const others = enhancedRoute.filter(city => !essentialSet.has(city));
          const remainingSlots = days - essential.length;
          
          // Build final route: start + others (up to remaining slots) + essential cities + end
          enhancedRoute = [startCity];
          
          // Add non-essential cities up to remaining slots
          others.forEach(city => {
            if (enhancedRoute.length < days - (essential.length - 1) && !essentialSet.has(city)) {
              enhancedRoute.push(city);
            }
          });
          
          // Add essential cities (Cambodia + other required)
          essential.slice(1).forEach(city => {
            if (!enhancedRoute.includes(city) && enhancedRoute.length < days) {
              enhancedRoute.push(city);
            }
          });
          
          // Ensure end city is last
          if (endCity !== startCity) {
            // Remove end city if it's in the middle
            enhancedRoute = enhancedRoute.filter(c => c !== endCity);
            enhancedRoute.push(endCity);
          }
          
          // Trim to exact days if still over
          if (enhancedRoute.length > days) {
            // Keep: start, all Cambodia days (preserve multiple days), other required, end
            const cambodiaDaysInRoute = enhancedRoute.filter(c => getCityRegion(c) === "cambodia"); // All occurrences
            const otherRequiredInRoute = enhancedRoute.filter(c => otherRequired.includes(c));
            const nonEssential = enhancedRoute.filter(c => 
              c !== startCity && c !== endCity && 
              getCityRegion(c) !== "cambodia" && 
              !otherRequired.includes(c)
            );
            
            enhancedRoute = [startCity];
            // Add ALL Cambodia days (preserve multiple days for Siem Reap)
            cambodiaDaysInRoute.forEach(city => {
              if (enhancedRoute.length < days - 1) {
                enhancedRoute.push(city);
              }
            });
            // Add other required cities (once each)
            const addedOtherRequired = new Set();
            otherRequiredInRoute.forEach(city => {
              if (!addedOtherRequired.has(city) && enhancedRoute.length < days - 1) {
                enhancedRoute.push(city);
                addedOtherRequired.add(city);
              }
            });
            // Fill remaining slots with non-essential cities
            nonEssential.forEach(city => {
              if (enhancedRoute.length < days - 1) {
                enhancedRoute.push(city);
              }
            });
            // Ensure end city is last
            if (endCity !== startCity) {
              enhancedRoute.push(endCity);
            }
            // Final trim to exact days (but preserve Cambodia days)
            if (enhancedRoute.length > days) {
              // Count Cambodia days
              const cambodiaCount = enhancedRoute.filter(c => getCityRegion(c) === "cambodia").length;
              // We need: start (1) + Cambodia days + end (1) = minimum
              const minLength = 1 + cambodiaCount + 1;
              if (days >= minLength) {
                // Trim non-essential cities first
                const trimmed = [startCity];
                let added = 1;
                // Add Cambodia days
                enhancedRoute.forEach(city => {
                  if (getCityRegion(city) === "cambodia" && added < days - 1) {
                    trimmed.push(city);
                    added++;
                  }
                });
                // Add other required
                enhancedRoute.forEach(city => {
                  if (otherRequired.includes(city) && !trimmed.includes(city) && added < days - 1) {
                    trimmed.push(city);
                    added++;
                  }
                });
                // Add non-essential
                enhancedRoute.forEach(city => {
                  if (city !== startCity && city !== endCity && 
                      getCityRegion(city) !== "cambodia" && 
                      !otherRequired.includes(city) && 
                      added < days - 1) {
                    trimmed.push(city);
                    added++;
                  }
                });
                // Add end
                if (endCity !== startCity) {
                  trimmed.push(endCity);
                }
                enhancedRoute = trimmed.slice(0, days);
              } else {
                // Not enough days - prioritize Cambodia
                enhancedRoute = [startCity];
                // Add as many Cambodia days as possible
                cambodiaDaysInRoute.slice(0, days - 2).forEach(city => {
                  enhancedRoute.push(city);
                });
                enhancedRoute.push(endCity);
                enhancedRoute = enhancedRoute.slice(0, days);
              }
            }
            // Ensure end city is still last
            if (enhancedRoute[enhancedRoute.length - 1] !== endCity && endCity !== startCity) {
              enhancedRoute[enhancedRoute.length - 1] = endCity;
            }
          }
          
          // Fill if under days
          if (enhancedRoute.length < days) {
            const lastCity = enhancedRoute[enhancedRoute.length - 1];
            while (enhancedRoute.length < days) {
              enhancedRoute.push(lastCity);
            }
          }
        } else {
          // Essential route is too long - prioritize start, Cambodia (with days), end
          const cambodiaInEssential = essential.filter(c => getCityRegion(c) === "cambodia");
          const otherEssential = essential.filter(c => c !== startCity && c !== endCity && !cambodiaInEssential.includes(c));
          
          enhancedRoute = [startCity];
          // Add Cambodia cities (preserve their days)
          cambodiaInEssential.forEach(city => {
            if (enhancedRoute.length < days - 1) {
              enhancedRoute.push(city);
            }
          });
          // Add other essential cities
          otherEssential.slice(0, days - enhancedRoute.length - 1).forEach(city => {
            enhancedRoute.push(city);
          });
          // Add end city
          if (endCity !== startCity && enhancedRoute.length < days) {
            enhancedRoute.push(endCity);
          }
          // Final trim
          enhancedRoute = enhancedRoute.slice(0, days);
          // Ensure end city is last
          if (enhancedRoute[enhancedRoute.length - 1] !== endCity && endCity !== startCity) {
            enhancedRoute[enhancedRoute.length - 1] = endCity;
          }
        }
      }
      
      // Final safety check: ensure all required Cambodia cities are in the route
      const finalCambodiaCount = enhancedRoute.filter(c => getCityRegion(c) === "cambodia").length;
      const requiredCambodiaCount = cambodiaCities.length > 0 ? (cambodiaCities[0] === "Siem Reap" ? 3 : 2) : 0;
      if (requiredCambodiaCount > 0 && finalCambodiaCount < requiredCambodiaCount && enhancedRoute.length < days) {
        // Add missing Cambodia days if there's room
        const cambodiaCity = cambodiaCities[0];
        const missingDays = requiredCambodiaCount - finalCambodiaCount;
        // Find insertion point (after last South/Central city, before North)
        let insertIdx = enhancedRoute.length - 1;
        const southCentralCities = ["Ho Chi Minh City", "Mekong Delta", "Nha Trang", "Da Lat", "Da Nang", "Hoi An", "Hue"];
        for (let i = enhancedRoute.length - 1; i >= 0; i--) {
          if (southCentralCities.includes(enhancedRoute[i])) {
            insertIdx = i + 1;
            break;
          }
        }
        // Insert missing Cambodia days if we have room
        if (enhancedRoute.length + missingDays <= days) {
          const missingBlock = Array(missingDays).fill(cambodiaCity);
          enhancedRoute.splice(insertIdx, 0, ...missingBlock);
        }
      }
      
      return enhancedRoute;
    }

    // Helper to get city region
    function getCityRegion(cityName) {
      const southCities = new Set(["Ho Chi Minh City", "Mekong Delta", "Can Tho", "Phu Quoc", "Mui Ne", "Nha Trang"]);
      const northCities = new Set(["Hanoi", "Ha Long Bay", "Sapa", "Ninh Binh"]);
      const centralCities = new Set(["Da Nang", "Hoi An", "Hue", "Da Lat", "Phong Nha"]);
      const cambodiaCities = new Set(["Phnom Penh", "Siem Reap", "Battambang"]);
      
      if (southCities.has(cityName)) return "south";
      if (northCities.has(cityName)) return "north";
      if (centralCities.has(cityName)) return "central";
      if (cambodiaCities.has(cityName)) return "cambodia";
      return "unknown";
    }

    // Calculate route efficiency score (lower is better - fewer transfers, less backtracking)
    function calculateRouteEfficiency(route) {
      if (!route || route.length < 2) return 0;
      
      let score = 0;
      let totalDistance = 0;
      let transferCount = 0;
      
      for (let i = 0; i < route.length - 1; i++) {
        const fromCity = route[i];
        const toCity = route[i + 1];
        
        if (fromCity !== toCity) {
          transferCount++;
          const distance = calculateDistance(fromCity, toCity);
          if (distance) {
            totalDistance += distance;
          }
        }
      }
      
      // Penalize: many transfers, long distances, backtracking
      score = transferCount * 10 + (totalDistance / 100);
      
      // Check for backtracking (visiting same city twice with other cities in between)
      const cityVisits = {};
      for (let i = 0; i < route.length; i++) {
        const city = route[i];
        if (!cityVisits[city]) {
          cityVisits[city] = [];
        }
        cityVisits[city].push(i);
      }
      
      // Penalize backtracking
      for (const [city, positions] of Object.entries(cityVisits)) {
        if (positions.length > 1) {
          // Check if positions are far apart (backtracking)
          for (let i = 0; i < positions.length - 1; i++) {
            const gap = positions[i + 1] - positions[i];
            if (gap > 2) {
              score += gap * 5; // Penalize backtracking
            }
          }
        }
      }
      
      return score;
    }

    // Ensure route follows geographic logic (no unnecessary backtracking)
    function ensureGeographicLogic(route, startCity, endCity) {
      if (!route || route.length < 3) return route;
      
      const optimized = [route[0]]; // Start city
      const visited = new Set([route[0]]);
      const isRoundTrip = startCity === endCity;
      
      // Get city indices for direction tracking
      const getCityIndex = (city) => {
        const idx = findCityIndexInCorridor(city);
        return idx !== -1 ? idx : (city.includes("Ho Chi Minh") || city.includes("Mekong") ? 0 : 
                                    city.includes("Hanoi") || city.includes("Sapa") || city.includes("Ha Long") ? 10 : 5);
      };
      
      // Build route following geographic order
      for (let i = 1; i < route.length - 1; i++) {
        const city = route[i];
        const prevCity = optimized[optimized.length - 1];
        
        // If same city, add it (extending stay)
        if (city === prevCity) {
          optimized.push(city);
          continue;
        }
        
        // For round trips, prevent backtracking by extending stays instead
        if (isRoundTrip && visited.has(city) && city !== endCity) {
          // Instead of backtracking, extend stay in previous city
          optimized.push(prevCity);
          continue;
        }
        
        // Check if we've visited this city before (backtracking)
        if (visited.has(city) && city !== endCity) {
          // Skip backtracking unless it's the end city
          // For round trips, extend stay in previous city instead
          if (isRoundTrip) {
            optimized.push(prevCity);
          }
          continue;
        }
        
        // Check geographic order - detect direction reversal
        const cityIdx = getCityIndex(city);
        const prevCityIdx = getCityIndex(prevCity);
        const prevPrevCityIdx = optimized.length > 1 ? getCityIndex(optimized[optimized.length - 2]) : prevCityIdx;
        
        // Detect if we're reversing direction (backtracking)
        if (optimized.length > 1 && prevPrevCityIdx !== prevCityIdx) {
          const wasGoingNorth = prevCityIdx > prevPrevCityIdx;
          const nowGoingNorth = cityIdx > prevCityIdx;
          
          // If direction reversed and we've already visited this city, it's backtracking
          if (wasGoingNorth !== nowGoingNorth && visited.has(city) && city !== endCity) {
            // Extend stay in previous city instead
            optimized.push(prevCity);
            continue;
          }
        }
        
        // Check distance to end city for non-round trips
        if (!isRoundTrip) {
          const distanceToEnd = calculateDistance(city, endCity);
          const prevDistanceToEnd = calculateDistance(prevCity, endCity);
          
          // If moving significantly away from end city and we've visited this city, skip it
          if (distanceToEnd && prevDistanceToEnd && distanceToEnd > prevDistanceToEnd * 1.5 && visited.has(city)) {
            optimized.push(prevCity);
            continue;
          }
        }
        
        optimized.push(city);
        visited.add(city);
      }
      
      // Ensure end city is last
      if (endCity && endCity !== optimized[optimized.length - 1]) {
        optimized.push(endCity);
      }
      
      return optimized;
    }

    // Optimize route for tour level - adjust transfers and stays
    function optimizeRouteForLevel(route, days, tourLevel) {
      if (!route || route.length === 0) return route;
      
      const levelLower = (tourLevel || "").toLowerCase();
      let optimizedRoute = [...route];
      
      if (levelLower === "easy") {
        // Easy level: minimize transfers, maximize stays in each city (minimum 2 nights per city)
        const grouped = [];
        let currentCity = null;
        let currentCount = 0;
        
        for (const city of optimizedRoute) {
          if (city === currentCity) {
            currentCount++;
          } else {
            if (currentCity) {
              // For easy level, ensure minimum 2 nights per city (except Ha Long Bay cruises)
              const minNights = (currentCity === "Ha Long Bay" || currentCity === "Lan Ha Bay") ? 1 : 2;
              grouped.push({ city: currentCity, nights: Math.max(currentCount, minNights) });
            }
            currentCity = city;
            currentCount = 1;
          }
        }
        if (currentCity) {
          const minNights = (currentCity === "Ha Long Bay" || currentCity === "Lan Ha Bay") ? 1 : 2;
          grouped.push({ city: currentCity, nights: Math.max(currentCount, minNights) });
        }
        
        // Rebuild route with extended stays, but respect total days
        const newRoute = [];
        let totalDays = 0;
        for (const { city, nights } of grouped) {
          const nightsToAdd = Math.min(nights, days - totalDays);
          for (let i = 0; i < nightsToAdd && totalDays < days; i++) {
            newRoute.push(city);
            totalDays++;
          }
        }
        
        // Fill remaining days with last city (extend stay)
        while (newRoute.length < days && newRoute.length > 0) {
          newRoute.push(newRoute[newRoute.length - 1]);
        }
        
        return newRoute.slice(0, days);
        
      } else if (levelLower === "moderate") {
        // Moderate: balanced approach - ensure at least 1 night per city, prefer 2
        const grouped = [];
        let currentCity = null;
        let currentCount = 0;
        
        for (const city of optimizedRoute) {
          if (city === currentCity) {
            currentCount++;
          } else {
            if (currentCity) {
              // Moderate: prefer 2 nights but allow 1 for transit
              const preferredNights = currentCount >= 2 ? currentCount : Math.max(1, currentCount);
              grouped.push({ city: currentCity, nights: preferredNights });
            }
            currentCity = city;
            currentCount = 1;
          }
        }
        if (currentCity) {
          const preferredNights = currentCount >= 2 ? currentCount : Math.max(1, currentCount);
          grouped.push({ city: currentCity, nights: preferredNights });
        }
        
        // Rebuild route
        const newRoute = [];
        let totalDays = 0;
        for (const { city, nights } of grouped) {
          const nightsToAdd = Math.min(nights, days - totalDays);
          for (let i = 0; i < nightsToAdd && totalDays < days; i++) {
            newRoute.push(city);
            totalDays++;
          }
        }
        
        while (newRoute.length < days && newRoute.length > 0) {
          newRoute.push(newRoute[newRoute.length - 1]);
        }
        
        return newRoute.slice(0, days);
        
      } else {
        // Intensive/Adventurous: can handle more transfers, shorter stays OK
        // Keep route as is but ensure no unnecessary backtracking
        return optimizedRoute;
      }
    }

    // Returns null if it cannot find a sensible corridor, so that existing logic can be used instead.
    function buildGeographicRoute(travellerProfile) {
      const startCity = travellerProfile.startCity;
      const endCity = travellerProfile.endCity;
      const days = travellerProfile.numDays || travellerProfile.numberOfDays || 1;
      const area = (travellerProfile.area || "").toLowerCase();
      const tourLevel = travellerProfile.tourLevel || "";

      if (!startCity || !endCity || days <= 0) return null;

      // Extract required cities from places to visit
      const placesToVisit = travellerProfile.placesToVisit || [];
      const requiredCities = extractRequiredCities(placesToVisit);

      // Check if required cities include Cambodia cities
      const hasRequiredCambodia = requiredCities.some(city => {
        const region = getCityRegion(city);
        return region === "cambodia";
      });

      // Check for Vietnam-Cambodia routes first (or if Cambodia is required)
      const vietnamCambodiaRoute = buildVietnamCambodiaRoute(travellerProfile);
      if (vietnamCambodiaRoute) {
        // Prioritize required cities in Vietnam-Cambodia route
        let finalRoute = vietnamCambodiaRoute;
        if (requiredCities.length > 0) {
          finalRoute = prioritizeRequiredCities(vietnamCambodiaRoute, requiredCities, days);
        }
        // Optimize for tour level
        return optimizeRouteForLevel(finalRoute, days, tourLevel);
      }

      // If Cambodia is required but route doesn't include it, we'll handle it in prioritizeRequiredCities
      // Continue with normal route building - prioritizeRequiredCities will add Cambodia cities

      const startIdx = findCityIndexInCorridor(startCity);
      const endIdx = findCityIndexInCorridor(endCity);

      // If start and end are the same, create a round-trip itinerary exploring Vietnam
      // The tourist arrives and departs from the same city but wants to see as much as possible
      if (startCity === endCity) {
        // Handle cities not in corridor by finding closest match
        let effectiveStartIdx = startIdx;
        if (effectiveStartIdx === -1) {
          effectiveStartIdx = findClosestCorridorIndex(startCity);
        }
        
        // Extract required cities from places to visit
        const placesToVisit = travellerProfile.placesToVisit || [];
        const requiredCities = extractRequiredCities(placesToVisit);
        
        if (effectiveStartIdx === -1) {
          // City not found - use smart round trip based on city name
          let roundTripRoute = buildRoundTripRouteByName(startCity, days);
          if (requiredCities.length > 0) {
            roundTripRoute = prioritizeRequiredCities(roundTripRoute, requiredCities, days);
          }
          roundTripRoute = applyCambodiaExtensionToRoute(roundTripRoute, travellerProfile);
          roundTripRoute = optimizeRouteForLevel(roundTripRoute, days, tourLevel);
          return ensureGeographicLogic(roundTripRoute, startCity, endCity);
        } else {
          let roundTripRoute = buildRoundTripRoute(startCity, days, effectiveStartIdx);
          if (requiredCities.length > 0) {
            roundTripRoute = prioritizeRequiredCities(roundTripRoute, requiredCities, days);
          }
          roundTripRoute = applyCambodiaExtensionToRoute(roundTripRoute, travellerProfile);
          roundTripRoute = optimizeRouteForLevel(roundTripRoute, days, tourLevel);
          return ensureGeographicLogic(roundTripRoute, startCity, endCity);
        }
      }

      // If we cannot locate both cities, fall back to previous logic
      if (startIdx === -1 || endIdx === -1) return null;

      const step = startIdx <= endIdx ? 1 : -1;

      // Build the corridor between start and end (inclusive)
      const corridor = [];
      for (let i = startIdx; step === 1 ? i <= endIdx : i >= endIdx; i += step) {
        corridor.push(CITY_CORRIDOR[i].name);
      }

      const corridorCities = corridor.length;

      if (corridorCities === 0) return null;

      // CASE 1: fewer or equal days than corridor cities ‚Üí compress
      if (days <= corridorCities) {
        if (days === 1) {
          const singleRoute = [corridor[0]];
          let finalRoute = applyCambodiaExtensionToRoute(singleRoute, travellerProfile);
          if (requiredCities.length > 0) {
            finalRoute = prioritizeRequiredCities(finalRoute, requiredCities, days);
          }
          return finalRoute;
        }
        const route = [];
        for (let d = 0; d < days; d++) {
          const idx = Math.round((d * (corridorCities - 1)) / (days - 1));
          route.push(corridor[idx]);
        }
        let finalRoute = applyCambodiaExtensionToRoute(route, travellerProfile);
        if (requiredCities.length > 0) {
          finalRoute = prioritizeRequiredCities(finalRoute, requiredCities, days);
        }
        return finalRoute;
      }

      // CASE 2: more days than corridor cities ‚Üí start with 1 night per city,
      // then distribute extra nights across key hubs.
      const baseNights = new Array(corridorCities).fill(1);
      let extra = days - corridorCities;

      // Give extra nights to big hubs, start, and end, in a round-robin way
      while (extra > 0) {
        for (let i = 0; i < corridorCities && extra > 0; i++) {
          const city = corridor[i];
          const isStart = i === 0;
          const isEnd = i === corridorCities - 1;
          if (BIG_STAY_CITIES.has(city) || isStart || isEnd) {
            baseNights[i] += 1;
            extra -= 1;
          }
        }
      }

      const route = [];
      for (let i = 0; i < corridorCities; i++) {
        for (let n = 0; n < baseNights[i]; n++) {
          route.push(corridor[i]);
        }
      }

      // Apply Cambodia extension if needed
      let finalRoute = applyCambodiaExtensionToRoute(route, travellerProfile);
      
      // Prioritize required cities from places to visit
      if (requiredCities.length > 0) {
        finalRoute = prioritizeRequiredCities(finalRoute, requiredCities, days);
      }

      // Optimize route for tour level (geographic logic + level considerations)
      finalRoute = optimizeRouteForLevel(finalRoute, days, tourLevel);
      
      // Ensure route is geographically logical (no unnecessary backtracking)
      finalRoute = ensureGeographicLogic(finalRoute, startCity, endCity);

      return finalRoute;
    }

    function buildCountrywideRoute(startCity, endCity, numberOfDays) {
      // Only handle the common case: 10 days, HCMC -> Sapa (or Hanoi/Sapa combo)
      if (startCity === "Ho Chi Minh City" && (endCity === "Sapa" || endCity === "Hanoi") && numberOfDays === 10) {
        return [
          "Ho Chi Minh City", // Day 1 ‚Äì arrival & city
          "Ho Chi Minh City", // Day 2 ‚Äì Cu Chi + city
          "Ho Chi Minh City", // Day 3 ‚Äì Mekong Delta (return to HCMC)
          "Hoi An",           // Day 4 ‚Äì fly to Da Nang, transfer to Hoi An
          "Hoi An",           // Day 5 ‚Äì Hoi An full day
          "Hue",              // Day 6 ‚Äì Hoi An ‚Üí Hue via Hai Van
          "Hanoi",            // Day 7 ‚Äì Hue ‚Üí Hanoi flight
          "Hanoi",            // Day 8 ‚Äì Hanoi city
          "Sapa",             // Day 9 ‚Äì Hanoi ‚Üí Sapa
          "Sapa"              // Day 10 ‚Äì Sapa day / departure
        ];
      }

      // Fallback: return null to let existing logic handle other cases
      return null;
    }

    function buildSmartRoute() {
      const t = state.traveller;
      const startCity = t.startCity;
      const endCity = t.endCity;
      const numDays = t.numDays;

      // If no end city or too short trip ‚Üí no smart routing
      if (!startCity || !endCity || numDays < 4) {
        return null;
      }
      
      // If same city, use round-trip logic (handled by buildGeographicRoute)
      if (startCity === endCity) {
        return null; // Let buildGeographicRoute handle round trips
      }

      let corridor = null;

      // Smart corridor between Ho Chi Minh City and Hanoi via Central Vietnam
      if (
        (startCity === "Ho Chi Minh City" && endCity === "Hanoi") ||
        (startCity === "Hanoi" && endCity === "Ho Chi Minh City")
      ) {
        corridor = ["Ho Chi Minh City", "Da Nang", "Hoi An", "Hue", "Hanoi"];
        // If starting from Hanoi, reverse the corridor
        if (startCity === "Hanoi") {
          corridor = corridor.slice().reverse();
        }
      }

      // If no corridor rule matched, fall back to default behaviour
      if (!corridor) return null;

      const pathLen = corridor.length;
      if (numDays === 1) {
        return [startCity];
      }

      // Distribute days along the corridor (start ‚Üí end, auto-spread middle days)
      const route = [];
      for (let i = 0; i < numDays; i++) {
        const tPos = (i / (numDays - 1)) * (pathLen - 1);
        let idx = Math.round(tPos);
        if (idx < 0) idx = 0;
        if (idx > pathLen - 1) idx = pathLen - 1;
        route.push(corridor[idx]);
      }
      return route;
    }

    // ====== ACTIVITY DIFFICULTY MAPPING ======
    // Map activities to difficulty levels for filtering
    const ACTIVITY_DIFFICULTY = {
      // Easy activities (suitable for all levels)
      easy: [
        "Free morning", "Free afternoon", "Free time", "Rest", "Caf√©", "Leisure",
        "Walking tour", "Market visit", "Shopping", "Beach", "Relax", "Evening at leisure",
        "Rooftop bar", "Street food", "Night market", "Water Puppet Show", "Museum visit",
        "Temple visit", "Pagoda", "Old Quarter", "City tour", "Guided visit"
      ],
      // Moderate activities (some walking/physical activity)
      moderate: [
        "Boat trip", "Sampan ride", "Cycling", "Bicycle", "Walking", "Trekking",
        "Cooking class", "Workshop", "Village visit", "Countryside", "Floating market",
        "Cave visit", "Hiking", "Nature walk", "Garden", "Park"
      ],
      // Intensive/Adventurous activities (strenuous)
      intensive: [
        "Mountain", "Peak", "Summit", "Climb", "Trek", "Adventure", "Extreme",
        "Fansipan", "Sapa trekking", "Ha Giang", "Mai Chau trek", "Sandboarding",
        "Kitesurfing", "Rock climbing", "Caving", "Deep cave", "Underground"
      ]
    };

    // Check if activity matches difficulty level
    function isActivitySuitableForLevel(activity, tourLevel) {
      if (!tourLevel || !activity) return true; // Default: show all if no level specified
      
      const activityLower = activity.toLowerCase();
      const levelLower = tourLevel.toLowerCase();
      
      // Easy level: only show easy activities
      if (levelLower === "easy") {
        return ACTIVITY_DIFFICULTY.easy.some(keyword => activityLower.includes(keyword)) ||
               (!ACTIVITY_DIFFICULTY.moderate.some(keyword => activityLower.includes(keyword)) &&
                !ACTIVITY_DIFFICULTY.intensive.some(keyword => activityLower.includes(keyword)));
      }
      
      // Moderate level: show easy + moderate
      if (levelLower === "moderate") {
        return !ACTIVITY_DIFFICULTY.intensive.some(keyword => activityLower.includes(keyword));
      }
      
      // Intensive/Adventurous: show all activities
      return true;
    }

    // Filter activities by difficulty level
    function filterActivitiesByLevel(activities, tourLevel) {
      if (!tourLevel || !activities || activities.length === 0) return activities;
      return activities.filter(activity => isActivitySuitableForLevel(activity, tourLevel));
    }

    // Get pacing recommendations based on level
    function getPacingForLevel(tourLevel, hasTransfer) {
      const levelLower = (tourLevel || "").toLowerCase();
      
      if (hasTransfer) {
        // Transfer days should be lighter
        if (levelLower === "easy") {
          return { morning: "light", afternoon: "light", evening: "rest" };
        } else if (levelLower === "moderate") {
          return { morning: "light", afternoon: "moderate", evening: "rest" };
        } else {
          return { morning: "moderate", afternoon: "moderate", evening: "optional" };
        }
      }
      
      // Regular days based on level
      if (levelLower === "easy") {
        return { morning: "moderate", afternoon: "light", evening: "rest" };
      } else if (levelLower === "moderate") {
        return { morning: "moderate", afternoon: "moderate", evening: "optional" };
      } else {
        return { morning: "intensive", afternoon: "moderate", evening: "optional" };
      }
    }

    // ====== UNIQUE ACTIVITY ENGINE (Option A ‚Äì Auto Mode) ======

    function assignUniqueActivities(route, days, tourLevel = null) {
      // Group consecutive days by city
      const stretches = [];
      let currentCity = null;
      let startIndex = 0;

      for (let i = 0; i < route.length; i++) {
        if (route[i] !== currentCity) {
          if (currentCity !== null) {
            stretches.push({
              city: currentCity,
              start: startIndex,
              length: i - startIndex
            });
          }
          currentCity = route[i];
          startIndex = i;
        }
      }
      // push last stretch
      stretches.push({
        city: currentCity,
        start: startIndex,
        length: route.length - startIndex
      });

      // Perform assignment
      stretches.forEach(stretch => {
        const city = stretch.city;
        const len = stretch.length;
        let mList = ACTIVITY_LIBRARY[city]?.morning || [];
        let aList = ACTIVITY_LIBRARY[city]?.afternoon || [];
        let eList = ACTIVITY_LIBRARY[city]?.evening || [];

        // Filter activities by difficulty level
        if (tourLevel) {
          mList = filterActivitiesByLevel(mList, tourLevel);
          aList = filterActivitiesByLevel(aList, tourLevel);
          eList = filterActivitiesByLevel(eList, tourLevel);
        }

        // Generic safe fillers (level-appropriate)
        let genericM, genericA, genericE;
        if (tourLevel && tourLevel.toLowerCase() === "easy") {
          genericM = ["Free morning for rest or caf√© time."];
          genericA = ["Optional light sightseeing or market visit."];
          genericE = ["Evening at leisure with free time."];
        } else if (tourLevel && tourLevel.toLowerCase() === "moderate") {
          genericM = ["Morning sightseeing and orientation."];
          genericA = ["Guided highlights tour or optional activities."];
          genericE = ["Evening at leisure, suggested night walk."];
        } else {
          genericM = ["Free morning for rest or caf√© time."];
          genericA = ["Optional sightseeing or market visit."];
          genericE = ["Evening at leisure, suggested night walk."];
        }

        for (let offset = 0; offset < len; offset++) {
          const dayIndex = stretch.start + offset;
          const prevCity = dayIndex > 0 ? route[dayIndex - 1] : null;
          const hasTransfer = prevCity && prevCity !== city;
          
          // Adjust pacing based on transfer and level
          const pacing = getPacingForLevel(tourLevel, hasTransfer);

          const pick = (list, idx, generic, pacingLevel) => {
            if (list.length === 0) return generic[0];
            
            // On transfer days, prefer lighter activities
            if (hasTransfer && pacingLevel === "light") {
              const lightActivities = list.filter(a => 
                !a.toLowerCase().includes("trek") && 
                !a.toLowerCase().includes("climb") &&
                !a.toLowerCase().includes("hike")
              );
              if (lightActivities.length > 0) {
                const cycleIndex = idx % lightActivities.length;
                return lightActivities[cycleIndex];
              }
            }
            
            // Cycle through activities, but use different ones
            const cycleIndex = idx % list.length;
            // If we're cycling, add variation text only if needed
            if (idx >= list.length && cycleIndex === 0) {
              return list[cycleIndex] + " (continued)";
            }
            return list[cycleIndex];
          };

          days[dayIndex].morning   = pick(mList, offset, genericM, pacing.morning);
          days[dayIndex].afternoon = pick(aList, offset, genericA, pacing.afternoon);
          
          // Evening: lighter on transfer days, especially for Easy level
          if (hasTransfer && (tourLevel && tourLevel.toLowerCase() === "easy")) {
            days[dayIndex].evening = "Rest and free evening after transfer.";
          } else {
            days[dayIndex].evening = pick(eList, offset, genericE, pacing.evening);
          }
        }
      });

      return days;
    }

    const ACTIVITY_LIBRARY = {
      "Hanoi": {
        morning: [
          "Ho Chi Minh Mausoleum & Presidential Palace",
          "Visit the Museum of Ethnology",
          "Tran Quoc Pagoda & West Lake walk"
        ],
        afternoon: [
          "Temple of Literature & Old Quarter tour",
          "Hoa Lo Prison Museum",
          "French Quarter walking tour"
        ],
        evening: [
          "Street food tour at Hoan Kiem",
          "Water Puppet Show",
          "Lake night walk + caf√©"
        ]
      },

      "Ninh Binh": {
        morning: [
          "Boat trip at Trang An",
          "Tam Coc sampan ride"
        ],
        afternoon: [
          "Bich Dong Pagoda visit",
          "Cuc Phuong nature walk"
        ],
        evening: [
          "Relax at countryside lodge",
          "Riverside dinner"
        ]
      },

      "Phong Nha": {
        morning: [
          "Paradise Cave exploration",
          "Phong Nha Cave boat ride"
        ],
        afternoon: [
          "Phong Nha highlights tour",
          "Eco-trail with local guide"
        ],
        evening: [
          "Relax at farmstay",
          "Dinner by the river"
        ]
      },

      "Hue": {
        morning: [
          "Citadel & Imperial City",
          "Perfume River boat to Thien Mu Pagoda"
        ],
        afternoon: [
          "Tombs of Khai Dinh or Minh Mang",
          "Local handicraft village visit"
        ],
        evening: [
          "Royal-style dinner",
          "Walk along Truong Tien Bridge"
        ]
      },

      "Hoi An": {
        morning: [
          "Basket boat tour in Coconut Forest",
          "Local cooking class"
        ],
        afternoon: [
          "Old Town walking tour (UNESCO)",
          "Silk village visit"
        ],
        evening: [
          "Lantern boat ride",
          "Hoi An night market"
        ]
      },

      "Da Lat": {
        morning: [
          "Bao Dai Palace & Old Railway Station",
          "Crazy House visit"
        ],
        afternoon: [
          "Coffee farm & waterfall tour",
          "Countryside motorbike loop"
        ],
        evening: [
          "Da Lat night market",
          "Warm caf√© night"
        ]
      },

      "Nha Trang": {
        morning: [
          "Island-hopping & snorkelling",
          "Cable car to VinWonders"
        ],
        afternoon: [
          "Mud bath & spa experience",
          "Long Son Pagoda visit"
        ],
        evening: [
          "Seafood dinner",
          "Beach night walk"
        ]
      },

      "Mekong Delta": {
        morning: [
          "Cai Be floating market visit",
          "Rural village bicycle ride"
        ],
        afternoon: [
          "Coconut workshop & boat canals",
          "Local craft village"
        ],
        evening: [
          "Homestay dinner",
          "Relaxed riverside walk"
        ]
      },

      "Ho Chi Minh City": {
        morning: [
          "War Remnants Museum",
          "Cu Chi Tunnels"
        ],
        afternoon: [
          "Ben Thanh Market & Coffee Workshop",
          "French Quarter walking tour"
        ],
        evening: [
          "Rooftop bar",
          "Street food night tour"
        ]
      },

      "Phnom Penh": {
        morning: [
          "Royal Palace and Silver Pagoda visit",
          "Tuol Sleng Genocide Museum (S21)"
        ],
        afternoon: [
          "Choeung Ek Killing Fields memorial visit",
          "Central Market or Russian Market shopping"
        ],
        evening: [
          "Sunset cruise on the Mekong River",
          "Street food and riverside walk"
        ]
      },

      "Siem Reap": {
        morning: [
          "Angkor Wat sunrise tour",
          "Bayon Temple at Angkor Thom"
        ],
        afternoon: [
          "Ta Prohm (Tomb Raider temple) visit",
          "Floating village excursion on Tonle Sap"
        ],
        evening: [
          "Apsara dance dinner show",
          "Pub Street and Old Market evening walk"
        ]
      }
    };

    function getActivitiesFor(city, dayPart) {
      const cityData = ACTIVITIES[city];
      if (!cityData || !cityData[dayPart] || cityData[dayPart].length === 0) {
        if (dayPart === "morning") return [`Sightseeing & easy introduction to ${city}.`];
        if (dayPart === "afternoon") return [`Guided highlights tour in ${city}.`];
        return [`Relaxed evening in ${city} with free time.`];
      }
      return cityData[dayPart];
    }

    function getHotelsFor(city) {
      const hotels = HOTEL_OPTIONS[city] || [];
      // Return formatted strings with star ratings: "Hotel Name (4‚òÖ‚òÖ‚òÖ‚òÖ)" or "Homestay Name" for homestays
      return hotels.map(h => {
        if (typeof h === 'string') {
          // Legacy format - return as is
          return h;
        }
        // New format with star rating
        const stars = h.stars || 0;
        if (stars === 0) {
          // Homestay - return name without stars
          return h.name;
        }
        const starSymbols = '‚òÖ'.repeat(stars);
        return `${h.name} (${stars}${starSymbols})`;
      });
    }
    
    // Helper function to extract hotel name without star rating
    function getHotelNameOnly(hotelString) {
      if (!hotelString) return "";
      // Remove star rating if present: "Hotel Name (4‚òÖ‚òÖ‚òÖ‚òÖ)" -> "Hotel Name"
      return hotelString.replace(/\s*\(\d+‚òÖ+\)\s*$/, "").trim();
    }

    function getCityCountry(cityName) {
      if (!cityName) return "";
      const cambodiaCities = new Set(["Phnom Penh", "Siem Reap"]);
      return cambodiaCities.has(cityName) ? "Cambodia" : "Vietnam";
    }

    // Calculate distance between two cities (Haversine formula)
    function calculateDistance(city1, city2) {
      const coords1 = CITY_COORDINATES[city1];
      const coords2 = CITY_COORDINATES[city2];
      
      if (!coords1 || !coords2) return null;
      
      const [lat1, lon1] = coords1;
      const [lat2, lon2] = coords2;
      
      const R = 6371; // Earth's radius in km
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    // Special route handling for common transfers with known times
    const SPECIAL_ROUTES = {
      "Hoi An-Da Nang": { time: 0.5, description: "Private car transfer from Hoi An to Da Nang (approx. 30 minutes, 30 km)." },
      "Da Nang-Hoi An": { time: 0.5, description: "Private car transfer from Da Nang to Hoi An (approx. 30 minutes, 30 km)." },
      "Hanoi-Ha Long Bay": { time: 2.5, description: "Private car transfer from Hanoi to Ha Long Bay (approx. 2.5 hours, 170 km)." },
      "Ha Long Bay-Hanoi": { time: 2.5, description: "Private car transfer from Ha Long Bay to Hanoi (approx. 2.5 hours, 170 km)." },
      "Hanoi-Sapa": { time: 5.5, description: "Private car or limousine bus transfer from Hanoi to Sapa (approx. 5-6 hours, 320 km). Overnight sleeper bus option available." },
      "Sapa-Hanoi": { time: 5.5, description: "Private car or limousine bus transfer from Sapa to Hanoi (approx. 5-6 hours, 320 km). Overnight sleeper bus option available." },
      "Hanoi-Ninh Binh": { time: 2, description: "Private car transfer from Hanoi to Ninh Binh (approx. 2 hours, 100 km)." },
      "Ninh Binh-Hanoi": { time: 2, description: "Private car transfer from Ninh Binh to Hanoi (approx. 2 hours, 100 km)." },
      "Hue-Hoi An": { time: 3, description: "Private car transfer from Hue to Hoi An via Hai Van Pass (approx. 3 hours, 130 km). Scenic route with photo stops." },
      "Hoi An-Hue": { time: 3, description: "Private car transfer from Hoi An to Hue via Hai Van Pass (approx. 3 hours, 130 km). Scenic route with photo stops." },
      "Ho Chi Minh City-Mekong Delta": { time: 2, description: "Private car transfer from Ho Chi Minh City to Mekong Delta (approx. 2 hours, 100 km)." },
      "Mekong Delta-Ho Chi Minh City": { time: 2, description: "Private car transfer from Mekong Delta to Ho Chi Minh City (approx. 2 hours, 100 km)." },
      "Da Nang-Hue": { time: 2.5, description: "Private car transfer from Da Nang to Hue via Hai Van Pass (approx. 2.5 hours, 100 km). Scenic route." },
      "Hue-Da Nang": { time: 2.5, description: "Private car transfer from Hue to Da Nang via Hai Van Pass (approx. 2.5 hours, 100 km). Scenic route." }
    };

    // Determine transfer mode and calculate travel time
    function calculateTransferTime(prevCity, currentCity) {
      if (!prevCity || !currentCity || prevCity === currentCity) {
        return { mode: "local", time: 0, description: "" };
      }

      // Check for special routes first
      const routeKey1 = `${prevCity}-${currentCity}`;
      const routeKey2 = `${currentCity}-${prevCity}`;
      if (SPECIAL_ROUTES[routeKey1]) {
        return { mode: "road", ...SPECIAL_ROUTES[routeKey1] };
      }
      if (SPECIAL_ROUTES[routeKey2]) {
        const special = SPECIAL_ROUTES[routeKey2];
        return { mode: "road", time: special.time, description: special.description.replace(routeKey2.split('-')[0], prevCity).replace(routeKey2.split('-')[1], currentCity) };
      }

      const distance = calculateDistance(prevCity, currentCity);
      if (distance === null) {
        return { mode: "unknown", time: 0, description: "Transfer details to be confirmed." };
      }

      const prevCountry = getCityCountry(prevCity);
      const currCountry = getCityCountry(currentCity);
      const crossBorder = prevCountry !== currCountry && prevCountry !== "" && currCountry !== "";

      // Major airports in Vietnam
      const hasMajorAirport = {
        "Ho Chi Minh City": true,
        "Hanoi": true,
        "Da Nang": true,
        "Nha Trang": true,
        "Hue": true,
        "Phu Quoc": true,
        "Can Tho": true,
        "Phnom Penh": true,
        "Siem Reap": true
      };

      // Determine if flight is needed (long distance or cross-border)
      // Cross-border always needs flight, or distances > 400km, or > 300km between major airports
      const needsFlight = crossBorder || distance > 400 || 
                         (distance > 300 && (hasMajorAirport[prevCity] && hasMajorAirport[currentCity]));

      if (needsFlight) {
        // Flight times: 1-2 hours flight + 2-3 hours airport time (check-in, security, waiting)
        const flightTime = distance < 600 ? 1 : distance < 1000 ? 1.5 : 2;
        const airportTime = 2.5; // Check-in, security, waiting
        const totalTime = flightTime + airportTime;
        
        // Airport transfers (30-60 min each side)
        const airportTransferTime = (hasMajorAirport[prevCity] ? 0.5 : 1) + 
                                   (hasMajorAirport[currentCity] ? 0.5 : 1);
        const totalTransferTime = totalTime + airportTransferTime;
        
        return {
          mode: "flight",
          time: totalTransferTime,
          description: `Flight from ${prevCity} to ${currentCity} (approx. ${flightTime} hour${flightTime > 1 ? 's' : ''} flight time). Allow ${totalTransferTime} hours total including airport transfers (${hasMajorAirport[prevCity] ? '30-45 min' : '45-60 min'} from ${prevCity}, ${hasMajorAirport[currentCity] ? '30-45 min' : '45-60 min'} to ${currentCity}), check-in, and security.`
        };
      } else {
        // Road transfer times based on distance
        // Average speed: 50-60 km/h on highways, 30-40 km/h on local roads
        let avgSpeed;
        if (distance > 200) {
          avgSpeed = 55; // Highway
        } else if (distance > 100) {
          avgSpeed = 45; // Mixed roads
        } else {
          avgSpeed = 35; // Local roads
        }
        const roadTime = Math.round((distance / avgSpeed) * 10) / 10; // Round to 1 decimal
        
        return {
          mode: "road",
          time: roadTime,
          description: `Private car transfer from ${prevCity} to ${currentCity} (approx. ${roadTime} hour${roadTime !== 1 ? 's' : ''} drive, ${Math.round(distance)} km).`
        };
      }
    }

    function buildTransferText(prevCity, currentCity) {
      if (!prevCity || !currentCity || prevCity === currentCity) {
        return "Transfer between cities (flight / car / train)‚Ä¶";
      }

      const transferInfo = calculateTransferTime(prevCity, currentCity);
      const prevCountry = getCityCountry(prevCity);
      const currCountry = getCityCountry(currentCity);
      const crossBorder = prevCountry !== currCountry && prevCountry !== "" && currCountry !== "";

      if (crossBorder) {
        return `Flight + private car transfer between ${prevCity} (${prevCountry}) and ${currentCity} (${currCountry}). ${transferInfo.description} Exact timing and vehicle to be confirmed according to flights and program.`;
      }

      return `Private car transfer between ${prevCity} and ${currentCity}. ${transferInfo.description} Exact timing and vehicle to be confirmed according to flights and program.`;
    }

    // Extract route (cities) from itinerary day descriptions
    function extractRouteFromItinerary(itineraryData, isDetailed = false) {
      if (!itineraryData || !itineraryData.days) return null;
      
      const startCity = extractCityName(itineraryData.startsIn);
      const endCity = extractCityName(itineraryData.endsIn);
      const numDays = itineraryData.days.length;
      
      // City mapping for variations
      const cityMap = {
        "Ho Chi Minh City": ["Ho Chi Minh City", "Saigon", "HCMC", "Ho Chi Minh"],
        "Da Nang": ["Da Nang", "Danang"],
        "Hoi An": ["Hoi An", "HoiAn"],
        "Hanoi": ["Hanoi", "Ha Noi"],
        "Sapa": ["Sapa", "Sa Pa"],
        "Ninh Binh": ["Ninh Binh", "NinhBinh"],
        "Ha Long Bay": ["Ha Long Bay", "Halong Bay", "Ha Long", "Halong"],
        "Mekong Delta": ["Mekong Delta", "Mekong"],
        "Can Tho": ["Can Tho", "CanTho"],
        "Nha Trang": ["Nha Trang", "NhaTrang"],
        "Da Lat": ["Da Lat", "Dalat"],
        "Hue": ["Hue"],
        "Mai Chau": ["Mai Chau", "MaiChau"],
        "Phong Nha": ["Phong Nha", "PhongNha"]
      };
      
      const route = [];
      let currentCity = startCity;
      
      if (isDetailed && Array.isArray(itineraryData.days)) {
        // Detailed itinerary: extract from day.details
        itineraryData.days.forEach((dayObj, index) => {
          const dayText = (dayObj.details || "").toLowerCase();
          
          // Check for transfer keywords
          const transferKeywords = ["fly to", "transfer to", "arrive in", "arrive at", "continue to", "travel to", "drive to"];
          let foundTransfer = false;
          
            for (const keyword of transferKeywords) {
              if (dayText.includes(keyword)) {
                // Extract city after transfer keyword - look for city names after the keyword
                const keywordIndex = dayText.indexOf(keyword);
                const textAfterKeyword = dayText.substring(keywordIndex + keyword.length);
                
                for (const [mainCity, variations] of Object.entries(cityMap)) {
                  for (const variant of variations) {
                    // Check if city appears after the transfer keyword
                    if (textAfterKeyword.includes(variant.toLowerCase())) {
                      currentCity = mainCity;
                      foundTransfer = true;
                      break;
                    }
                  }
                  if (foundTransfer) break;
                }
              }
            }
          
          // If no transfer found, check if city is mentioned
          if (!foundTransfer) {
            for (const [mainCity, variations] of Object.entries(cityMap)) {
              for (const variant of variations) {
                if (dayText.includes(variant.toLowerCase())) {
                  currentCity = mainCity;
                  break;
                }
              }
            }
          }
          
          route.push(currentCity);
        });
      } else if (Array.isArray(itineraryData.days)) {
        // Brief itinerary: extract from day strings
        itineraryData.days.forEach((dayStr, index) => {
          if (typeof dayStr === 'string') {
            const dayText = dayStr.toLowerCase();
            
            // Check for transfer keywords first
            const transferKeywords = ["fly to", "transfer to", "arrive in", "arrive at", "continue to", "travel to", "drive to"];
            let foundTransfer = false;
            
            for (const keyword of transferKeywords) {
              if (dayText.includes(keyword)) {
                // Extract city after transfer keyword - look for city names after the keyword
                const keywordIndex = dayText.indexOf(keyword);
                const textAfterKeyword = dayText.substring(keywordIndex + keyword.length);
                
                for (const [mainCity, variations] of Object.entries(cityMap)) {
                  for (const variant of variations) {
                    // Check if city appears after the transfer keyword
                    if (textAfterKeyword.includes(variant.toLowerCase())) {
                      currentCity = mainCity;
                      foundTransfer = true;
                      break;
                    }
                  }
                  if (foundTransfer) break;
                }
              }
            }
            
            // If no transfer found, check if a NEW city is mentioned (don't revert to previous cities)
            if (!foundTransfer) {
              // Only update if we find a different city mentioned
              for (const [mainCity, variations] of Object.entries(cityMap)) {
                if (mainCity === currentCity) continue; // Skip current city
                for (const variant of variations) {
                  if (dayText.includes(variant.toLowerCase())) {
                    // Only switch if it's clearly a new location (not just mentioned in context)
                    // Check if it's the main subject of the day
                    const cityIndex = dayText.indexOf(variant.toLowerCase());
                    const beforeCity = dayText.substring(Math.max(0, cityIndex - 20), cityIndex);
                    // If city appears after keywords like "in", "at", "to", it's likely the location
                    if (/in|at|to|arrive|transfer|fly|visit|explore/.test(beforeCity)) {
                      currentCity = mainCity;
                      break;
                    }
                  }
                }
                if (currentCity !== route[route.length - 1]) break;
              }
            }
            
            route.push(currentCity);
          } else {
            route.push(currentCity);
          }
        });
      }
      
      // Ensure we have the right number of days
      while (route.length < numDays) {
        route.push(route[route.length - 1] || endCity);
      }
      
      // Ensure route starts and ends correctly
      if (route.length > 0) {
        route[0] = startCity;
        route[route.length - 1] = endCity;
      }
      
      // Smart distribution: if route is mostly one city, distribute better
      const uniqueCities = [...new Set(route)];
      
      // Check if we need to redistribute
      const startCityCount = route.filter(c => c === startCity).length;
      const endCityCount = route.filter(c => c === endCity).length;
      
      // If start and end are different but route is heavily skewed, redistribute
      if (startCity !== endCity) {
        // If more than 70% of days are in start city, redistribute
        if (startCityCount / numDays > 0.7) {
          // Find transition point - usually around 60-70% through the trip
          const transitionDay = Math.max(1, Math.floor(numDays * 0.6));
          
          // For short trips (4-6 days), transition earlier
          if (numDays <= 6) {
            const transitionDay = Math.max(1, Math.floor(numDays * 0.5));
            for (let i = 0; i < numDays; i++) {
              if (i < transitionDay) {
                route[i] = startCity;
              } else {
                route[i] = endCity;
              }
            }
          } else {
            // For longer trips, transition around 60-65%
            for (let i = 0; i < numDays; i++) {
              if (i < transitionDay) {
                route[i] = startCity;
              } else {
                route[i] = endCity;
              }
            }
          }
        }
        // If we only found one unique city but start != end, distribute
        else if (uniqueCities.length === 1) {
          const transitionDay = Math.max(1, Math.floor(numDays * 0.5));
          for (let i = 0; i < numDays; i++) {
            if (i < transitionDay) {
              route[i] = startCity;
            } else {
              route[i] = endCity;
            }
          }
        }
      }
      
      // Ensure first and last days are correct
      if (route.length > 0) {
        route[0] = startCity;
        route[route.length - 1] = endCity;
      }
      
      return route.length > 0 ? route : null;
    }
    
    // Extract city name from "City, Country" or "City / City" format
    function extractCityName(locationStr) {
      if (!locationStr) return "";
      // Handle "Da Nang / Hoi An" format - take first city
      let city = locationStr.split(",")[0].trim();
      // If it contains "/", take the first part
      if (city.includes("/")) {
        city = city.split("/")[0].trim();
      }
      return city;
    }
    
    // Load itinerary template into generator
    function loadItineraryIntoGenerator(itineraryData, isDetailed = false) {
      if (!itineraryData) return;
      
      // Extract and store route
      const route = extractRouteFromItinerary(itineraryData, isDetailed);
      state.selectedItineraryTemplate = {
        route: route,
        data: itineraryData,
        isDetailed: isDetailed
      };
      
      // Auto-populate form fields
      if (itineraryData.startsIn) {
        const startCity = extractCityName(itineraryData.startsIn);
        const startCitySelect = $("startCity");
        if (startCitySelect) {
          startCitySelect.value = startCity;
        }
      }
      
      if (itineraryData.endsIn) {
        const endCity = extractCityName(itineraryData.endsIn);
        const endCitySelect = $("endCity");
        if (endCitySelect) {
          endCitySelect.value = endCity;
        }
      }
      
      if (itineraryData.days && Array.isArray(itineraryData.days)) {
        const numDays = itineraryData.days.length;
        const numDaysInput = $("numDays");
        if (numDaysInput) {
          numDaysInput.value = numDays;
          autoFillEndDate(); // Update end date
        }
      }
      
      if (itineraryData.tourType) {
        const tourTypeSelect = $("tourType");
        if (tourTypeSelect && itineraryData.tourType.includes("Private")) {
          tourTypeSelect.value = "Private tour";
        }
      }
      
      // Show success message
      const output = document.getElementById("itineraryArea");
      if (output) {
        output.innerHTML = `
          <div class="alert alert-success" style="padding: 15px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; color: #155724; margin: 20px 0;">
            <strong>‚úì Itinerary Template Loaded!</strong><br>
            ${isDetailed ? 'Detailed' : 'Brief'} itinerary "${itineraryData.name}" has been loaded into the generator.<br>
            Form fields have been auto-filled. Click "Generate / Refresh Itinerary" to create your customized itinerary.
          </div>
        `;
      }
    }
    
    // Expose function globally for onclick handlers
    window.loadItineraryIntoGenerator = loadItineraryIntoGenerator;

    // Parse brief itinerary day string and extract activities
    function parseBriefDayDescription(dayStr) {
      if (!dayStr || typeof dayStr !== 'string') return { morning: "", afternoon: "", evening: "", transfer: "" };
      
      // Remove "Day X ‚Äì" prefix
      const dayText = dayStr.replace(/^Day \d+[‚Äì-]\s*/i, "").trim();
      let morning = "";
      let afternoon = "";
      let evening = "";
      let transfer = "";
      
      // Extract transfer information first (before parsing activities)
      const transferPatterns = [
        /fly to [^,.]*/i,
        /transfer to [^,.]*/i,
        /arrive[^,.]*/i,
        /departure[^,.]*/i,
        /continue to [^,.]*/i,
        /travel to [^,.]*/i
      ];
      
      for (const pattern of transferPatterns) {
        const match = dayText.match(pattern);
        if (match) {
          transfer = match[0].trim();
          break;
        }
      }
      
      // Split by colon to separate title from description
      const parts = dayText.split(/[:;]/);
      const titlePart = parts[0] || "";
      const descPart = parts.length > 1 ? parts.slice(1).join(":").trim() : "";
      const mainPart = descPart || dayText;
      
      const lowerText = mainPart.toLowerCase();
      
      // Check for explicit time mentions
      if (lowerText.includes("morning") || lowerText.includes("half-day") && lowerText.includes("morning")) {
        const morningMatch = mainPart.match(/(morning|half-day)[^.]*?\./i);
        if (morningMatch) {
          morning = morningMatch[0].replace(/^(morning|half-day)\s*:?\s*/i, "").replace(/\.$/, "").trim();
        }
      }
      
      if (lowerText.includes("afternoon") || lowerText.includes("half-day") && lowerText.includes("afternoon")) {
        const afternoonMatch = mainPart.match(/afternoon[^.]*?\./i);
        if (afternoonMatch) {
          afternoon = afternoonMatch[0].replace(/^afternoon\s*:?\s*/i, "").replace(/\.$/, "").trim();
        }
      }
      
      if (lowerText.includes("evening") || lowerText.includes("night") || lowerText.includes("lantern")) {
        const eveningMatch = mainPart.match(/(evening|night|lantern)[^.]*?\./i);
        if (eveningMatch) {
          evening = eveningMatch[0].replace(/^(evening|night|lantern)\s*:?\s*/i, "").replace(/\.$/, "").trim();
        }
      }
      
      // If no explicit time mentions, intelligently parse based on content
      if (!morning && !afternoon && !evening) {
        // Check title for activity type
        const titleLower = titlePart.toLowerCase();
        
        // Split description by commas and periods
        const sentences = mainPart.split(/[.,]/).map(s => s.trim()).filter(s => s.length > 3);
        
        // Special handling for common patterns
        if (titleLower.includes("arrival")) {
          // Arrival day - usually evening activities
          if (sentences.length > 0) {
            evening = sentences.join(". ") || mainPart;
          } else {
            evening = mainPart;
          }
        } else if (titleLower.includes("departure") || titleLower.includes("free time")) {
          // Departure or free day
          if (sentences.length > 0) {
            afternoon = sentences[0] || mainPart;
            evening = sentences.slice(1).join(". ") || "Evening at leisure.";
          } else {
            afternoon = mainPart;
            evening = "Evening at leisure.";
          }
        } else if (titleLower.includes("highlights") || titleLower.includes("tour") || titleLower.includes("city")) {
          // City tour or highlights - usually full day, split across morning/afternoon
          if (sentences.length >= 2) {
            morning = sentences[0];
            afternoon = sentences.slice(1).join(". ");
            evening = "Evening at leisure.";
          } else if (sentences.length === 1) {
            // Single sentence - check if it's a list
            const items = sentences[0].split(/[&,]/).map(s => s.trim()).filter(s => s.length > 3);
            if (items.length >= 3) {
              morning = items.slice(0, Math.ceil(items.length / 2)).join(", ");
              afternoon = items.slice(Math.ceil(items.length / 2)).join(", ");
              evening = "Evening at leisure.";
            } else {
              afternoon = sentences[0];
              evening = "Evening at leisure.";
            }
          } else {
            afternoon = mainPart;
            evening = "Evening at leisure.";
          }
        } else if (titleLower.includes("half-day") || titleLower.includes("half day")) {
          // Half-day activity
          if (lowerText.includes("morning")) {
            morning = mainPart.replace(/morning/i, "").trim();
            afternoon = "Free afternoon.";
            evening = "Evening at leisure.";
          } else {
            morning = "Free morning.";
            afternoon = mainPart.replace(/afternoon/i, "").trim();
            evening = "Evening at leisure.";
          }
        } else {
          // Default: distribute activities
          if (sentences.length >= 3) {
            morning = sentences[0];
            afternoon = sentences[1];
            evening = sentences.slice(2).join(". ");
          } else if (sentences.length === 2) {
            morning = sentences[0];
            afternoon = sentences[1];
            evening = "Evening at leisure.";
          } else if (sentences.length === 1) {
            // Check if it's a list of items
            const items = sentences[0].split(/[&,]/).map(s => s.trim()).filter(s => s.length > 3);
            if (items.length >= 2) {
              morning = items[0];
              afternoon = items.slice(1).join(", ");
              evening = "Evening at leisure.";
            } else {
              afternoon = sentences[0];
              evening = "Evening at leisure.";
            }
          } else {
            afternoon = mainPart || titlePart;
            evening = "Evening at leisure.";
          }
        }
      }
      
      // Clean up: remove transfer text from activities
      if (transfer) {
        const transferClean = transfer.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        morning = morning.replace(new RegExp(transferClean, "gi"), "").trim();
        afternoon = afternoon.replace(new RegExp(transferClean, "gi"), "").trim();
        evening = evening.replace(new RegExp(transferClean, "gi"), "").trim();
      }
      
      // Clean up empty strings and normalize
      morning = morning.replace(/^[.,]\s*/, "").trim();
      afternoon = afternoon.replace(/^[.,]\s*/, "").trim();
      evening = evening.replace(/^[.,]\s*/, "").trim();
      
      return { 
        morning: morning || "", 
        afternoon: afternoon || "", 
        evening: evening || "", 
        transfer: transfer || "" 
      };
    }
    
    // Parse detailed itinerary day object and extract activities
    function parseDetailedDayDescription(dayObj) {
      if (!dayObj || !dayObj.details) return { morning: "", afternoon: "", evening: "", transfer: "" };
      
      const details = dayObj.details;
      let morning = "";
      let afternoon = "";
      let evening = "";
      let transfer = "";
      
      // Extract transfer information
      const transferKeywords = ["transfer", "fly to", "arrive", "departure", "continue to", "travel to", "drive to"];
      for (const keyword of transferKeywords) {
        if (details.toLowerCase().includes(keyword)) {
          const keywordIndex = details.toLowerCase().indexOf(keyword);
          const sentenceStart = Math.max(0, details.lastIndexOf(".", keywordIndex) + 1);
          const sentenceEnd = details.indexOf(".", keywordIndex);
          if (sentenceEnd !== -1) {
            transfer = details.substring(sentenceStart, sentenceEnd + 1).trim();
            break;
          }
        }
      }
      
      // Split by sentences and look for time indicators
      const sentences = details.split(/[.!?]+/).map(s => s.trim()).filter(s => s.length > 10);
      const lowerDetails = details.toLowerCase();
      
      // Check for explicit time mentions
      let morningSentences = [];
      let afternoonSentences = [];
      let eveningSentences = [];
      
      sentences.forEach(sentence => {
        const lower = sentence.toLowerCase();
        if (lower.includes("morning") || lower.includes("breakfast") || lower.includes("early")) {
          morningSentences.push(sentence);
        } else if (lower.includes("afternoon") || lower.includes("lunch") || lower.includes("midday")) {
          afternoonSentences.push(sentence);
        } else if (lower.includes("evening") || lower.includes("night") || lower.includes("dinner") || lower.includes("sunset")) {
          eveningSentences.push(sentence);
        }
      });
      
      // If we found time-specific sentences, use them
      if (morningSentences.length > 0) {
        morning = morningSentences.join(" ").trim();
      }
      if (afternoonSentences.length > 0) {
        afternoon = afternoonSentences.join(" ").trim();
      }
      if (eveningSentences.length > 0) {
        evening = eveningSentences.join(" ").trim();
      }
      
      // If no time-specific sentences, intelligently distribute
      if (!morning && !afternoon && !evening) {
        // Check title for clues
        const title = (dayObj.title || "").toLowerCase();
        if (title.includes("arrival") || title.includes("departure")) {
          // Arrival/departure days - activities are usually afternoon/evening
          if (sentences.length >= 2) {
            afternoon = sentences[0];
            evening = sentences.slice(1).join(" ");
          } else if (sentences.length === 1) {
            evening = sentences[0];
          }
        } else {
          // Regular activity day - distribute across morning/afternoon/evening
          const totalSentences = sentences.length;
          if (totalSentences >= 3) {
            morning = sentences[0];
            afternoon = sentences[1];
            evening = sentences.slice(2).join(" ");
          } else if (totalSentences === 2) {
            morning = sentences[0];
            afternoon = sentences[1];
            evening = "Evening at leisure.";
          } else if (totalSentences === 1) {
            afternoon = sentences[0];
            evening = "Evening at leisure.";
          }
        }
      }
      
      // Clean up transfer from activity descriptions
      if (transfer) {
        morning = morning.replace(new RegExp(transfer.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "gi"), "").trim();
        afternoon = afternoon.replace(new RegExp(transfer.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "gi"), "").trim();
        evening = evening.replace(new RegExp(transfer.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "gi"), "").trim();
      }
      
      return { 
        morning: morning || "", 
        afternoon: afternoon || "", 
        evening: evening || "", 
        transfer: transfer || "",
        title: dayObj.title || ""
      };
    }

    // Picture gallery functions
    function parsePictureData(pictureNotes) {
      if (!pictureNotes) return [];
      try {
        const data = JSON.parse(pictureNotes);
        return Array.isArray(data) ? data : [];
      } catch (e) {
        // Legacy format - might be URLs separated by newlines or commas
        if (pictureNotes.includes('http') || pictureNotes.includes('data:image')) {
          return pictureNotes.split(/[\n,]/).filter(url => url.trim().length > 0).map(url => url.trim());
        }
        return [];
      }
    }
    
    function savePictureData(dayIndex, images) {
      if (!state.daysData[dayIndex]) return;
      state.daysData[dayIndex].pictureNotes = JSON.stringify(images);
      renderItinerary();
    }
    
    function renderPictureGallery(pictureNotes, dayIndex) {
      const images = parsePictureData(pictureNotes);
      if (images.length === 0) {
        return `<div class="picture-gallery-placeholder">
          <span>Drag & drop 2-3 images here<br>or click to browse</span>
        </div>`;
      }
      
      // Limit to 3 images
      const displayImages = images.slice(0, 3);
      return displayImages.map((img, idx) => `
        <div class="picture-gallery-item">
          <img src="${img}" alt="Day ${dayIndex + 1} photo ${idx + 1}">
          <button class="remove-btn" onclick="removePicture(${dayIndex}, ${idx})" title="Remove image">√ó</button>
        </div>
      `).join('');
    }
    
    function handleDragOver(e) {
      e.preventDefault();
      e.stopPropagation();
      e.currentTarget.classList.add('drag-over');
    }
    
    function handleDragLeave(e) {
      e.preventDefault();
      e.stopPropagation();
      e.currentTarget.classList.remove('drag-over');
    }
    
    function handleImageDrop(e, dayIndex) {
      e.preventDefault();
      e.stopPropagation();
      e.currentTarget.classList.remove('drag-over');
      
      const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
      if (files.length === 0) return;
      
      processImageFiles(files, dayIndex);
    }
    
    function handleFileSelect(e, dayIndex) {
      const files = Array.from(e.target.files).filter(file => file.type.startsWith('image/'));
      if (files.length === 0) return;
      
      processImageFiles(files, dayIndex);
      e.target.value = ''; // Reset input
    }
    
    function processImageFiles(files, dayIndex) {
      const currentImages = parsePictureData(state.daysData[dayIndex]?.pictureNotes || '');
      const newImages = [];
      let processed = 0;
      const maxImages = 3;
      
      files.forEach(file => {
        if (currentImages.length + newImages.length >= maxImages) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          newImages.push(e.target.result);
          processed++;
          
          if (processed === Math.min(files.length, maxImages - currentImages.length)) {
            const allImages = [...currentImages, ...newImages].slice(0, maxImages);
            savePictureData(dayIndex, allImages);
          }
        };
        reader.readAsDataURL(file);
      });
    }
    
    function removePicture(dayIndex, imageIndex) {
      const currentImages = parsePictureData(state.daysData[dayIndex]?.pictureNotes || '');
      currentImages.splice(imageIndex, 1);
      savePictureData(dayIndex, currentImages);
    }
    
    // Expose functions globally for inline handlers
    window.handleImageDrop = handleImageDrop;
    window.handleDragOver = handleDragOver;
    window.handleDragLeave = handleDragLeave;
    window.handleFileSelect = handleFileSelect;
    window.removePicture = removePicture;
    window.renderPictureGallery = renderPictureGallery;

    function generateDaysData() {
      const t = state.traveller;
      state.daysData = [];

      // Check for loaded itinerary template first
      // BUT: only use it if it has intermediate cities (more than just start/end)
      if (state.selectedItineraryTemplate && state.selectedItineraryTemplate.route) {
        let templateRoute = [...state.selectedItineraryTemplate.route]; // Copy array
        
        // Always ensure route matches numDays
        if (templateRoute.length !== t.numDays) {
          while (templateRoute.length < t.numDays) {
            templateRoute.push(templateRoute[templateRoute.length - 1] || t.startCity);
          }
          templateRoute = templateRoute.slice(0, t.numDays);
        }
        
        // Check if template route has intermediate cities
        const uniqueCities = [...new Set(templateRoute)];
        const hasIntermediateCities = uniqueCities.length > 2 || 
          (uniqueCities.length === 2 && t.startCity && t.endCity && 
           uniqueCities.includes(t.startCity) && uniqueCities.includes(t.endCity) &&
           templateRoute.filter(c => c !== t.startCity && c !== t.endCity).length > 0);
        
        // If start and end are different but route lacks intermediate cities, skip template route
        if (t.startCity && t.endCity && t.startCity !== t.endCity && !hasIntermediateCities) {
          // Template route is too simple - skip it and use geographic route instead
          state.selectedItineraryTemplate = null;
        } else {
          // Template route is good - use it but ensure first/last days are correct
          if (t.startCity && t.endCity) {
            templateRoute[0] = t.startCity;
            templateRoute[t.numDays - 1] = t.endCity;
          }
          
          if (templateRoute.length === t.numDays) {
          // Use template route - build full day objects with actual itinerary activities
          for (let i = 0; i < t.numDays; i++) {
            const city = templateRoute[i] || t.startCity;
            const date = t.startDate ? addDays(t.startDate, i) : null;

            const morningOptions = getActivitiesFor(city, "morning");
            const afternoonOptions = getActivitiesFor(city, "afternoon");
            const eveningOptions = getActivitiesFor(city, "evening");

            const prevCity = i === 0 ? null : state.daysData[i - 1]?.city;
            const hasTransfer = prevCity && prevCity !== city;
            let transfer = buildTransferText(prevCity, city);
            
            // Get transfer time to adjust activities
            const transferInfo = calculateTransferTime(prevCity, city);
            const transferHours = transferInfo.time || 0;

            // Parse activities from itinerary template
            // Adjust activities based on transfer time and level
            const pacing = getPacingForLevel(t.tourLevel, hasTransfer);
            
            let morning = morningOptions[0] || "";
            let afternoon = afternoonOptions[0] || "";
            let evening = eveningOptions[0] || "";
            
            // On transfer days, especially with long transfers, reduce activities
            if (hasTransfer && transferHours > 3) {
              // Long transfer (>3 hours) - lighter day
              if (t.tourLevel && t.tourLevel.toLowerCase() === "easy") {
                morning = "Free morning before transfer.";
                afternoon = transfer.includes("Flight") ? "Afternoon arrival and hotel check-in." : afternoonOptions[0] || "Transfer and arrival.";
                evening = "Rest and free evening after travel.";
              } else {
                morning = morning || "Morning transfer preparation.";
                afternoon = transfer.includes("Flight") ? "Afternoon arrival and orientation." : afternoonOptions[0] || "Transfer and arrival.";
                evening = eveningOptions[0] || "Evening at leisure after transfer.";
              }
            } else if (hasTransfer && transferHours > 1.5) {
              // Medium transfer (1.5-3 hours) - moderate reduction
              if (t.tourLevel && t.tourLevel.toLowerCase() === "easy") {
                afternoon = transfer.includes("Flight") ? "Afternoon arrival and check-in." : afternoonOptions[0] || "Transfer and arrival.";
                evening = "Rest and free evening.";
              }
            }
            
            // Use activities from loaded itinerary template
            const template = state.selectedItineraryTemplate;
            if (template && template.data && template.data.days && Array.isArray(template.data.days) && template.data.days[i]) {
              const dayData = template.data.days[i];
              
              if (template.isDetailed && typeof dayData === 'object' && dayData.details) {
                // Detailed itinerary: parse day object with title and details
                const parsed = parseDetailedDayDescription(dayData);
                if (parsed.morning) morning = parsed.morning;
                if (parsed.afternoon) afternoon = parsed.afternoon;
                if (parsed.evening) evening = parsed.evening;
                if (parsed.transfer) {
                  transfer = parsed.transfer;
                }
              } else if (!template.isDetailed && typeof dayData === 'string') {
                // Brief itinerary: parse day string
                const parsed = parseBriefDayDescription(dayData);
                if (parsed.morning) morning = parsed.morning;
                if (parsed.afternoon) afternoon = parsed.afternoon;
                if (parsed.evening) evening = parsed.evening;
                if (parsed.transfer) {
                  transfer = parsed.transfer;
                }
              }
            }
            
            // Add airport pick-up/drop-off with time allowances if needed
            if (i === 0 && t.arrivalTime) {
              const city = templateRoute[i] || t.startCity;
              const hasMajorAirport = ["Ho Chi Minh City", "Hanoi", "Da Nang", "Nha Trang", "Hue", "Phu Quoc", "Can Tho", "Phnom Penh", "Siem Reap"].includes(city);
              const airportTransferTime = hasMajorAirport ? "30-45 minutes" : "45-60 minutes";
              
              if (transfer && !transfer.toLowerCase().includes("pick-up") && !transfer.toLowerCase().includes("arrival")) {
                transfer += (transfer ? " " : "") + `Airport pick-up according to arrival at ${t.arrivalTime}. Allow ${airportTransferTime} for airport transfer to hotel/city center.`;
              } else if (!transfer) {
                transfer = `Airport pick-up according to arrival at ${t.arrivalTime}. Allow ${airportTransferTime} for airport transfer to hotel/city center.`;
              }
            }
            if (i === t.numDays - 1 && t.departureTime) {
              const city = templateRoute[i] || t.endCity;
              const hasMajorAirport = ["Ho Chi Minh City", "Hanoi", "Da Nang", "Nha Trang", "Hue", "Phu Quoc", "Can Tho", "Phnom Penh", "Siem Reap"].includes(city);
              const airportTransferTime = hasMajorAirport ? "30-45 minutes" : "45-60 minutes";
              
              if (transfer && !transfer.toLowerCase().includes("drop-off") && !transfer.toLowerCase().includes("departure")) {
                transfer += (transfer ? " " : "") + `Airport drop-off according to departure at ${t.departureTime}. Allow ${airportTransferTime} for transfer from hotel/city center to airport, plus 2-3 hours for check-in and security.`;
              } else if (!transfer) {
                transfer = `Airport drop-off according to departure at ${t.departureTime}. Allow ${airportTransferTime} for transfer from hotel/city center to airport, plus 2-3 hours for check-in and security.`;
              }
            }
            
            // If no transfer was set, use default
            if (!transfer && prevCity && prevCity !== city) {
              transfer = buildTransferText(prevCity, city);
            } else if (!transfer) {
              transfer = "Transfer details to be confirmed.";
            }

            state.daysData.push({
              dayIndex: i,
              label: `Day ${i + 1}`,
              city,
              date,
              hotelCity: city,
              hotelName: getHotelNameOnly(getHotelsFor(city)[0] || ""),
              transfer,
              mealPlan: "B/L/D", // Default: Breakfast, Lunch, Dinner
              morning,
              afternoon,
              evening,
              morningOptions,
              afternoonOptions,
              eveningOptions,
              pictureNotes: ""
            });
            }
            // Don't call assignUniqueActivities - we're using the actual itinerary activities
            return; // Early return - template route handled
          } else {
            // Template route length doesn't match - clear it and fall through
            state.selectedItineraryTemplate = null;
          }
        }
      }

      // Check for geographic route first (includes intermediate cities like Da Nang, Hoi An, Hue, etc.)
      const geoRoute = buildGeographicRoute(t);
      if (geoRoute && Array.isArray(geoRoute) && geoRoute.length === t.numDays) {
        // Use geographic route - it includes all intermediate cities
        // Use geographic route - build full day objects
        for (let i = 0; i < t.numDays; i++) {
          const city = geoRoute[i];
          const date = t.startDate ? addDays(t.startDate, i) : null;

          const morningOptions = getActivitiesFor(city, "morning");
          const afternoonOptions = getActivitiesFor(city, "afternoon");
          const eveningOptions = getActivitiesFor(city, "evening");

          const prevCity = i === 0 ? null : state.daysData[i - 1]?.city;
          const hasTransfer = prevCity && prevCity !== city;
          const transferInfo = calculateTransferTime(prevCity, city);
          const transferHours = transferInfo.time || 0;
          let transfer = buildTransferText(prevCity, city);
          
          // Adjust activities based on transfer time and level
          const pacing = getPacingForLevel(t.tourLevel, hasTransfer);
          
          // On transfer days, adjust activities based on transfer time and tour level
          // Think like a tour guide: consider travel fatigue and customer needs
          if (hasTransfer && transferHours > 3) {
            // Long transfer (>3 hours): significant impact - flight or long drive
            if (t.tourLevel && t.tourLevel.toLowerCase() === "easy") {
              // Easy level: very light schedule, prioritize rest
              morningOptions = ["Free morning before transfer. Pack and prepare for departure."];
              afternoonOptions = (transfer.includes("Flight") || transfer.includes("flight")) 
                ? ["Afternoon arrival, airport pick-up, and hotel check-in. Rest time."] 
                : ["Transfer and arrival. Hotel check-in and rest."];
              eveningOptions = ["Rest and free evening after travel. Light dinner recommended."];
            } else if (t.tourLevel && t.tourLevel.toLowerCase() === "moderate") {
              // Moderate: light morning, arrival activities in afternoon
              morningOptions = morningOptions.slice(0, 1).map(opt => opt.includes("Free") ? opt : "Free morning before transfer or light breakfast.");
              afternoonOptions = (transfer.includes("Flight") || transfer.includes("flight"))
                ? ["Afternoon arrival, hotel check-in, and brief orientation walk."]
                : afternoonOptions.slice(0, 1);
              eveningOptions = ["Evening at leisure. Optional light exploration of local area."];
            } else {
              // Intensive/Adventurous: can handle more activities but still consider transfer
              morningOptions = morningOptions.slice(0, 1);
              afternoonOptions = (transfer.includes("Flight") || transfer.includes("flight"))
                ? ["Afternoon arrival, hotel check-in, and orientation tour."]
                : afternoonOptions.slice(0, 1);
              eveningOptions = eveningOptions.slice(0, 1);
            }
          } else if (hasTransfer && transferHours > 1.5) {
            // Medium transfer (1.5-3 hours): moderate impact
            if (t.tourLevel && t.tourLevel.toLowerCase() === "easy") {
              morningOptions = ["Free morning before transfer or light breakfast."];
              afternoonOptions = (transfer.includes("Flight") || transfer.includes("flight"))
                ? ["Afternoon arrival, hotel check-in, and rest."]
                : afternoonOptions.slice(0, 1);
              eveningOptions = ["Rest and free evening. Light dinner."];
            } else if (t.tourLevel && t.tourLevel.toLowerCase() === "moderate") {
              morningOptions = morningOptions.slice(0, 1);
              afternoonOptions = (transfer.includes("Flight") || transfer.includes("flight"))
                ? ["Afternoon arrival, hotel check-in, and brief orientation."]
                : afternoonOptions.slice(0, 1);
              eveningOptions = ["Evening at leisure with optional light activities."];
            }
            // Intensive: keep activities as is for medium transfers
          } else if (hasTransfer && transferHours > 0) {
            // Short transfer (<1.5 hours): minimal impact, but still consider level
            if (t.tourLevel && t.tourLevel.toLowerCase() === "easy") {
              // Easy: still lighten the schedule slightly
              afternoonOptions = (transfer.includes("Flight") || transfer.includes("flight"))
                ? ["Afternoon arrival and hotel check-in."]
                : afternoonOptions.slice(0, 1);
              eveningOptions = ["Evening at leisure."];
            }
          }

          // add airport pick-up / drop-off automatically on first/last day with time allowances
          if (i === 0 && t.arrivalTime) {
            const hasMajorAirport = ["Ho Chi Minh City", "Hanoi", "Da Nang", "Nha Trang", "Hue", "Phu Quoc", "Can Tho", "Phnom Penh", "Siem Reap"].includes(city);
            const airportTransferTime = hasMajorAirport ? "30-45 minutes" : "45-60 minutes";
            transfer += (transfer ? " " : "") + `Airport pick-up according to arrival at ${t.arrivalTime}. Allow ${airportTransferTime} for airport transfer to hotel/city center.`;
          }
          if (i === t.numDays - 1 && t.departureTime) {
            const hasMajorAirport = ["Ho Chi Minh City", "Hanoi", "Da Nang", "Nha Trang", "Hue", "Phu Quoc", "Can Tho", "Phnom Penh", "Siem Reap"].includes(city);
            const airportTransferTime = hasMajorAirport ? "30-45 minutes" : "45-60 minutes";
            transfer += (transfer ? " " : "") + `Airport drop-off according to departure at ${t.departureTime}. Allow ${airportTransferTime} for transfer from hotel/city center to airport, plus 2-3 hours for check-in and security.`;
          }

          state.daysData.push({
            dayIndex: i,
            label: `Day ${i + 1}`,
            city,
            date,
            hotelCity: city,
            hotelName: getHotelsFor(city)[0] || "",
            transfer,
            mealPlan: "B/L/D", // Default: Breakfast, Lunch, Dinner
            morning: morningOptions[0] || "",
            afternoon: afternoonOptions[0] || "",
            evening: eveningOptions[0] || "",
            morningOptions,
            afternoonOptions,
            eveningOptions,
            pictureNotes: ""
          });
        }
        assignUniqueActivities(geoRoute, state.daysData);
        return; // Early return - geographic route handled
      }

      // Check for country-wide route
      let countrywideRoute = (t.area === "Vietnam ‚Äì Country-wide" || t.area === "Country-wide")
        ? buildCountrywideRoute(t.startCity, t.endCity, t.numDays)
        : null;
      
      // Apply Cambodia extension to countrywide route if needed
      if (countrywideRoute) {
        countrywideRoute = applyCambodiaExtensionToRoute(countrywideRoute, t);
      }

      // Try to build a smart route (e.g. HCMC ‚Üí Da Nang ‚Üí Hoi An ‚Üí Hue ‚Üí Hanoi)
      let smartRoute = buildSmartRoute();
      
      // Apply Cambodia extension to smart route if needed
      if (smartRoute) {
        smartRoute = applyCambodiaExtensionToRoute(smartRoute, t);
      }

      for (let i = 0; i < t.numDays; i++) {
        let city;
        if (countrywideRoute && countrywideRoute[i]) {
          // Use country-wide route
          city = countrywideRoute[i];
        } else if (smartRoute && smartRoute[i]) {
          // Use smart route
          city = smartRoute[i];
        } else {
          // Use default logic
          city = getDefaultCityForDay(i);
        }
        const date = t.startDate ? addDays(t.startDate, i) : null;

        const morningOptions = getActivitiesFor(city, "morning");
        const afternoonOptions = getActivitiesFor(city, "afternoon");
        const eveningOptions = getActivitiesFor(city, "evening");

        const prevCity = i === 0 ? null : state.daysData[i - 1]?.city;
        let transfer = buildTransferText(prevCity, city);

        // add airport pick-up / drop-off automatically on first/last day with time allowances
        if (i === 0 && t.arrivalTime) {
          const hasMajorAirport = ["Ho Chi Minh City", "Hanoi", "Da Nang", "Nha Trang", "Hue", "Phu Quoc", "Can Tho", "Phnom Penh", "Siem Reap"].includes(city);
          const airportTransferTime = hasMajorAirport ? "30-45 minutes" : "45-60 minutes";
          transfer += (transfer ? " " : "") + `Airport pick-up according to arrival at ${t.arrivalTime}. Allow ${airportTransferTime} for airport transfer to hotel/city center.`;
        }
        if (i === t.numDays - 1 && t.departureTime) {
          const hasMajorAirport = ["Ho Chi Minh City", "Hanoi", "Da Nang", "Nha Trang", "Hue", "Phu Quoc", "Can Tho", "Phnom Penh", "Siem Reap"].includes(city);
          const airportTransferTime = hasMajorAirport ? "30-45 minutes" : "45-60 minutes";
          transfer += (transfer ? " " : "") + `Airport drop-off according to departure at ${t.departureTime}. Allow ${airportTransferTime} for transfer from hotel/city center to airport, plus 2-3 hours for check-in and security.`;
        }

        state.daysData.push({
          dayIndex: i,
          label: `Day ${i + 1}`,
          city,
          date,
          hotelCity: city,
          hotelName: getHotelsFor(city)[0] || "",
          transfer,
          mealPlan: "B/L/D", // Default: Breakfast, Lunch, Dinner
          morning: morningOptions[0] || "",
          afternoon: afternoonOptions[0] || "",
          evening: eveningOptions[0] || "",
          morningOptions,
          afternoonOptions,
          eveningOptions,
          pictureNotes: ""
        });
      }
      
      // Build route array from days and assign unique activities
      const routeArray = state.daysData.map(d => d.city);
      assignUniqueActivities(routeArray, state.daysData);
    }

    // City coordinates database (lat, lng)
    const CITY_COORDINATES = {
      "Ho Chi Minh City": [10.8231, 106.6297],
      "Hanoi": [21.0285, 105.8542],
      "Da Nang": [16.0544, 108.2022],
      "Hoi An": [15.8801, 108.3380],
      "Hue": [16.4637, 107.5909],
      "Ha Long Bay": [20.9101, 107.1839],
      "Ninh Binh": [20.2506, 105.9745],
      "Sapa": [22.3406, 103.8440],
      "Can Tho": [10.0452, 105.7469],
      "Phu Quoc": [10.2899, 103.9840],
      "Nha Trang": [12.2388, 109.1967],
      "Da Lat": [11.9404, 108.4583],
      "Mui Ne": [10.9381, 108.2778],
      "Phnom Penh": [11.5564, 104.9282],
      "Siem Reap": [13.4125, 103.8670],
      "Battambang": [13.0957, 103.2022],
      "Mekong Delta": [10.0452, 105.7469] // Using Can Tho coordinates
    };
    
    let itineraryMap = null; // Global map instance
    
    // Render map based on itinerary route
    function renderItineraryMap() {
      // Remove existing map if present
      const mapContainer = document.getElementById("itineraryMap");
      if (!mapContainer) return;
      
      // Destroy existing map
      if (itineraryMap) {
        itineraryMap.remove();
        itineraryMap = null;
      }
      
      // Get unique cities from itinerary route
      const route = state.daysData.map(d => d.city).filter((city, index, self) => 
        city && self.indexOf(city) === index
      );
      
      if (route.length === 0) {
        mapContainer.innerHTML = "<p style='padding:20px;text-align:center;color:#666;'>No route data available for map.</p>";
        return;
      }
      
      // Get coordinates for all cities in route
      const routeCoords = route
        .map(city => {
          const coords = CITY_COORDINATES[city];
          return coords ? { city, coords } : null;
        })
        .filter(item => item !== null);
      
      if (routeCoords.length === 0) {
        mapContainer.innerHTML = "<p style='padding:20px;text-align:center;color:#666;'>City coordinates not available.</p>";
        return;
      }
      
      // Calculate bounds to fit all cities
      const bounds = routeCoords.map(item => item.coords);
      const minLat = Math.min(...bounds.map(c => c[0]));
      const maxLat = Math.max(...bounds.map(c => c[0]));
      const minLng = Math.min(...bounds.map(c => c[1]));
      const maxLng = Math.max(...bounds.map(c => c[1]));
      
      // Initialize map centered on Vietnam
      itineraryMap = L.map("itineraryMap", {
        zoomControl: true,
        scrollWheelZoom: false // Disable scroll zoom for better print/PDF experience
      }).fitBounds([[minLat, minLng], [maxLat, maxLng]], {
        padding: [50, 50]
      });
      
      // Add simplified map tiles (minimal labels, clean design - matching example style)
      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '¬© OpenStreetMap contributors ¬© CARTO',
        subdomains: 'abcd',
        maxZoom: 19
      }).addTo(itineraryMap);
      
      // Add Vietnam border polygon (more accurate geographical coordinates)
      const vietnamBorder = [
        [23.3926, 102.1445], // Northwest corner
        [22.3969, 102.1445],
        [22.0000, 103.0000],
        [21.5000, 104.0000],
        [21.0000, 105.0000],
        [20.0000, 105.5000],
        [18.5000, 107.0000],
        [17.0000, 108.0000],
        [16.0000, 108.5000],
        [14.5000, 109.0000],
        [12.0000, 109.5000],
        [10.5000, 108.5000],
        [9.0000, 105.5000],
        [8.5000, 104.5000],  // Southwest corner
        [8.5000, 103.5000],
        [9.0000, 103.0000],
        [10.0000, 103.5000],
        [11.0000, 105.0000],
        [12.0000, 106.0000],
        [13.0000, 107.0000],
        [14.5000, 107.5000],
        [16.0000, 108.0000],
        [17.5000, 107.0000],
        [19.0000, 106.0000],
        [20.5000, 105.0000],
        [22.0000, 104.0000],
        [23.3926, 102.1445]  // Close polygon
      ];
      
      // Add Vietnam filled with prominent light blue color
      L.polygon(vietnamBorder, {
        color: '#2563eb',
        weight: 2.5,
        opacity: 1.0,
        fillColor: '#93c5fd',
        fillOpacity: 0.75,
        dashArray: '0',
        lineJoin: 'round',
        lineCap: 'round'
      }).addTo(itineraryMap);
      
      // Add white outline for better definition
      L.polygon(vietnamBorder, {
        color: '#ffffff',
        weight: 4,
        opacity: 0.9,
        fill: false,
        dashArray: '0',
        lineJoin: 'round',
        lineCap: 'round'
      }).addTo(itineraryMap);
      
      // Add neighboring countries (Laos, Cambodia, China) in white/light colors
      // Laos border (approximate)
      const laosBorder = [
        [22.5, 100.0],
        [22.5, 107.0],
        [14.0, 107.0],
        [14.0, 100.0],
        [22.5, 100.0]
      ];
      
      L.polygon(laosBorder, {
        color: '#d1d5db',
        weight: 1.5,
        opacity: 0.6,
        fillColor: '#f9fafb',
        fillOpacity: 0.9,
        dashArray: '0'
      }).addTo(itineraryMap);
      
      // China border (approximate - northern border)
      const chinaBorder = [
        [23.5, 102.0],
        [23.5, 110.0],
        [21.5, 110.0],
        [21.5, 102.0],
        [23.5, 102.0]
      ];
      
      L.polygon(chinaBorder, {
        color: '#d1d5db',
        weight: 1.5,
        opacity: 0.6,
        fillColor: '#f9fafb',
        fillOpacity: 0.9,
        dashArray: '0'
      }).addTo(itineraryMap);
      
      // Add Cambodia border if route includes Cambodia cities (light blue like Vietnam)
      const hasCambodia = routeCoords.some(item => 
        item.city === "Phnom Penh" || item.city === "Siem Reap" || item.city === "Battambang"
      );
      
      if (hasCambodia) {
        const cambodiaBorder = [
          [14.6869, 102.3489], // Northwest
          [14.6869, 107.6277], // Northeast
          [10.4865, 107.6277], // Southeast
          [10.4865, 102.3489], // Southwest
          [14.6869, 102.3489]  // Close polygon
        ];
        
        // Cambodia filled with light blue (matching Vietnam style)
        L.polygon(cambodiaBorder, {
          color: '#2563eb',
          weight: 2.5,
          opacity: 1.0,
          fillColor: '#93c5fd',
          fillOpacity: 0.75,
          dashArray: '0',
          lineJoin: 'round',
          lineCap: 'round'
        }).addTo(itineraryMap);
        
        // White outline for Cambodia
        L.polygon(cambodiaBorder, {
          color: '#ffffff',
          weight: 4,
          opacity: 0.9,
          fill: false,
          dashArray: '0',
          lineJoin: 'round',
          lineCap: 'round'
        }).addTo(itineraryMap);
      }
      
      // Add numbered markers for each city (with stacked numbers for multiple days)
      routeCoords.forEach((item, index) => {
        const dayNumbers = [];
        state.daysData.forEach((day, idx) => {
          if (day.city === item.city) {
            dayNumbers.push(idx + 1);
          }
        });
        
        // Create stacked numbers display (like "6 7" stacked vertically)
        let numberDisplay = '';
        if (dayNumbers.length > 1) {
          // Stack numbers vertically
          numberDisplay = dayNumbers.map(d => `<div style="line-height: 1.1;">${d}</div>`).join('');
        } else {
          numberDisplay = dayNumbers.length > 0 ? dayNumbers[0].toString() : (index + 1).toString();
        }
        
        // Numbered orange circle markers (matching example style)
        const customIcon = L.divIcon({
          className: 'custom-marker',
          html: `<div style="
            background-color: #f97316;
            width: ${dayNumbers.length > 1 ? '36px' : '32px'};
            height: ${dayNumbers.length > 1 ? '36px' : '32px'};
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: ${dayNumbers.length > 1 ? '13px' : '15px'};
            font-family: Arial, sans-serif;
            line-height: 1.1;
          ">${numberDisplay}</div>`,
          iconSize: [dayNumbers.length > 1 ? 36 : 32, dayNumbers.length > 1 ? 36 : 32],
          iconAnchor: [dayNumbers.length > 1 ? 18 : 16, dayNumbers.length > 1 ? 18 : 16]
        });
        
        const marker = L.marker(item.coords, { icon: customIcon }).addTo(itineraryMap);
        
        // Add city label (improved styling - bold black text)
        const cityLabel = L.marker(item.coords, {
          icon: L.divIcon({
            className: 'city-label',
            html: `<div style="
              font-weight: bold;
              font-size: 15px;
              color: #1f2937;
              text-shadow: 2px 2px 4px rgba(255,255,255,0.9), 0 0 8px rgba(255,255,255,0.8);
              margin-top: 40px;
              white-space: nowrap;
              letter-spacing: 0.5px;
            ">${item.city.toUpperCase()}</div>`,
            iconSize: [120, 25],
            iconAnchor: [60, 0]
          })
        }).addTo(itineraryMap);
        
        // Add popup with city name and day info
        const dayInfo = dayNumbers.length > 0 ? ` (Day ${dayNumbers.join(', ')})` : '';
        marker.bindPopup(`<b>${item.city}</b>${dayInfo}`);
      });
      
      // Add red star for start city (like the example)
      if (routeCoords.length > 0) {
        const startCity = routeCoords[0];
        const startIcon = L.divIcon({
          className: 'start-marker',
          html: `<div style="
            font-size: 24px;
            color: #dc2626;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
          ">‚òÖ</div>`,
          iconSize: [24, 24],
          iconAnchor: [12, 12]
        });
        
        const startMarker = L.marker(startCity.coords, { 
          icon: startIcon,
          zIndexOffset: 1000
        }).addTo(itineraryMap);
      }
      
      // Draw route lines - detect road vs flight transfers
      if (routeCoords.length > 1) {
        // Group route into segments and detect transfer type
        const routeSegments = [];
        for (let i = 0; i < routeCoords.length - 1; i++) {
          const fromCity = routeCoords[i].city;
          const toCity = routeCoords[i + 1].city;
          const fromCoords = routeCoords[i].coords;
          const toCoords = routeCoords[i + 1].coords;
          
          // Find transfer info from daysData
          const dayIndex = state.daysData.findIndex(d => d.city === toCity);
          const transfer = dayIndex >= 0 ? (state.daysData[dayIndex].transfer || "").toLowerCase() : "";
          
          // Detect transfer type: flight, railway, or road
          const distance = Math.sqrt(
            Math.pow(toCoords[0] - fromCoords[0], 2) + 
            Math.pow(toCoords[1] - fromCoords[1], 2)
          );
          const isFlight = transfer.includes("fly") || 
                          transfer.includes("flight") || 
                          distance > 0.8; // Long distance = likely flight
          const isRailway = transfer.includes("train") || 
                           transfer.includes("railway") || 
                           transfer.includes("rail");
          
          routeSegments.push({
            from: fromCoords,
            to: toCoords,
            fromCity: fromCity,
            toCity: toCity,
            isFlight: isFlight,
            isRailway: isRailway
          });
        }
        
        // Draw railway segments (dashed red lines)
        const railwaySegments = routeSegments.filter(s => s.isRailway);
        railwaySegments.forEach(segment => {
          const railwayLine = L.polyline([segment.from, segment.to], {
            color: '#dc2626',
            weight: 3,
            opacity: 0.95,
            dashArray: '8, 4', // Dashed red line
            lineJoin: 'round',
            lineCap: 'round'
          }).addTo(itineraryMap);
          
          // White outline for railway
          L.polyline([segment.from, segment.to], {
            color: '#ffffff',
            weight: 5,
            opacity: 0.6,
            dashArray: '8, 4',
            lineJoin: 'round',
            lineCap: 'round'
          }).addTo(itineraryMap);
        });
        
        // Draw road segments (solid blue lines)
        const roadSegments = routeSegments.filter(s => !s.isFlight && !s.isRailway);
        roadSegments.forEach(segment => {
          const roadLine = L.polyline([segment.from, segment.to], {
            color: '#2563eb',
            weight: 3,
            opacity: 0.95,
            dashArray: '0', // Solid line
            lineJoin: 'round',
            lineCap: 'round'
          }).addTo(itineraryMap);
          
          // White outline for road
          L.polyline([segment.from, segment.to], {
            color: '#ffffff',
            weight: 5,
            opacity: 0.6,
            dashArray: '0',
            lineJoin: 'round',
            lineCap: 'round'
          }).addTo(itineraryMap);
        });
        
        // Draw flight segments (dashed blue lines with airplane icons)
        const flightSegments = routeSegments.filter(s => s.isFlight);
        flightSegments.forEach(segment => {
          const flightLine = L.polyline([segment.from, segment.to], {
            color: '#2563eb',
            weight: 3,
            opacity: 0.95,
            dashArray: '12, 6', // Dashed line
            lineJoin: 'round',
            lineCap: 'round'
          }).addTo(itineraryMap);
          
          // White outline for flight
          L.polyline([segment.from, segment.to], {
            color: '#ffffff',
            weight: 5,
            opacity: 0.6,
            dashArray: '12, 6',
            lineJoin: 'round',
            lineCap: 'round'
          }).addTo(itineraryMap);
          
          // Add airplane icon on flight segment
          const midLat = (segment.from[0] + segment.to[0]) / 2;
          const midLng = (segment.from[1] + segment.to[1]) / 2;
          const bearing = calculateBearing(segment.from, segment.to);
          
          const airplaneMarker = L.marker([midLat, midLng], {
            icon: L.divIcon({
              className: 'airplane-marker',
              html: `<div style="
                transform: rotate(${bearing + 45}deg);
                font-size: 20px;
                color: #2563eb;
                filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
                line-height: 1;
                text-align: center;
              ">‚úà</div>`,
              iconSize: [20, 20],
              iconAnchor: [10, 10]
            }),
            zIndexOffset: 1000
          }).addTo(itineraryMap);
        });
      }
      
      // Helper function to calculate bearing
      function calculateBearing(start, end) {
        const startLat = start[0] * Math.PI / 180;
        const startLng = start[1] * Math.PI / 180;
        const endLat = end[0] * Math.PI / 180;
        const endLng = end[1] * Math.PI / 180;
        
        const dLng = endLng - startLng;
        const y = Math.sin(dLng) * Math.cos(endLat);
        const x = Math.cos(startLat) * Math.sin(endLat) - 
                  Math.sin(startLat) * Math.cos(endLat) * Math.cos(dLng);
        
        const bearing = Math.atan2(y, x) * 180 / Math.PI;
        return (bearing + 360) % 360;
      }
      
      // Add map legend (matching example style)
      const legend = L.control({ position: 'bottomleft' });
      legend.onAdd = function(map) {
        const div = L.DomUtil.create('div', 'map-legend');
        div.style.cssText = `
          background: rgba(255, 255, 255, 0.95);
          padding: 12px 16px;
          border-radius: 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          font-family: Arial, sans-serif;
          font-size: 13px;
          line-height: 1.8;
        `;
        
        const hasRailway = routeSegments.some(s => s.isRailway);
        const hasFlight = routeSegments.some(s => s.isFlight);
        
        let legendHTML = '<div style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">Legend</div>';
        
        // Road (solid blue line)
        legendHTML += `
          <div style="display: flex; align-items: center; margin-bottom: 6px;">
            <div style="width: 40px; height: 3px; background: #2563eb; margin-right: 10px; border-radius: 2px;"></div>
            <span>Road</span>
          </div>
        `;
        
        // Flight (dashed blue line with airplane)
        if (hasFlight) {
          legendHTML += `
            <div style="display: flex; align-items: center; margin-bottom: 6px;">
              <div style="width: 40px; height: 3px; background: repeating-linear-gradient(to right, #2563eb 0, #2563eb 8px, transparent 8px, transparent 14px); margin-right: 10px; position: relative;">
                <span style="position: absolute; left: 20px; top: -8px; font-size: 14px; color: #2563eb;">‚úà</span>
              </div>
              <span>Flight</span>
            </div>
          `;
        }
        
        // Railway (dashed red line)
        if (hasRailway) {
          legendHTML += `
            <div style="display: flex; align-items: center; margin-bottom: 6px;">
              <div style="width: 40px; height: 3px; background: repeating-linear-gradient(to right, #dc2626 0, #dc2626 6px, transparent 6px, transparent 10px); margin-right: 10px;"></div>
              <span>Railway</span>
            </div>
          `;
        }
        
        div.innerHTML = legendHTML;
        return div;
      };
      legend.addTo(itineraryMap);
    }

    function renderItinerary() {
      const t = state.traveller;
      const cont = $("itineraryArea");

      if (!t || !t.numDays) {
        cont.innerHTML = "<p>Please fill the form on the left and click <b>Generate / Refresh Itinerary</b>.</p>";
        return;
      }

      function getItineraryTitle(itinerary) {
        const groupName = itinerary.groupName && itinerary.groupName.trim()
          ? itinerary.groupName.trim()
          : "Unnamed group";

        const numDays = Array.isArray(itinerary.days)
          ? itinerary.days.length
          : itinerary.numDays || itinerary.duration || 0;

        const areaLabel = itinerary.area && itinerary.area.trim()
          ? itinerary.area.trim()
          : "Vietnam";

        return `${groupName} ‚Äì ${numDays} days in ${areaLabel}`;
      }

      const headerTitle = getItineraryTitle(t);
      const brandHeaderHtml = `
        <header class="brand-header">
          <div class="brand-header-left">
            <img src="vht_logo.png" alt="VHT Vietnam Holiday Tours logo" class="brand-logo">
            <div class="brand-title-block">
              <div class="brand-title">VHT ‚Äì Vietnam Holiday Tours</div>
              <div class="brand-subtitle">Tailor-made itinerary proposal</div>
            </div>
          </div>
        </header>
      `;
      let headerHtml = `
        <div class="itinerary-header">
          <h2>${headerTitle}</h2>
          <section class="trip-meta-card">
            <div class="itinerary-header-row">
              ${
                t.startDate
                  ? `<div class="badge"><span>Dates</span>${formatDateTime(t.startDate, t.arrivalTime)}${
                      t.endDate ? " ‚Üí " + formatDateTime(t.endDate, t.departureTime) : ""
                    }</div>`
                  : ""
              }
              ${t.area ? `<div class="badge"><span>Area</span>${t.area}</div>` : ""}
              ${t.nationality ? `<div class="badge"><span>Nationality</span>${t.nationality}</div>` : ""}
              ${t.ageGroup ? `<div class="badge"><span>Age</span>${t.ageGroup}</div>` : ""}
              ${t.tourType ? `<div class="badge"><span>Type</span>${t.tourType}</div>` : ""}
              ${t.tourLevel ? `<div class="badge"><span>Level</span>${t.tourLevel}</div>` : ""}
              ${t.hotelRating ? `<div class="badge"><span>Hotels</span>${t.hotelRating}</div>` : ""}
              ${t.foodPref ? `<div class="badge"><span>Food</span>${t.foodPref}</div>` : ""}
              ${t.startCity ? `<div class="badge"><span>Start</span>${t.startCity}</div>` : ""}
              ${t.endCity ? `<div class="badge"><span>End</span>${t.endCity}</div>` : ""}
              ${t.budgetHint ? `<div class="badge"><span>Budget</span>${t.budgetHint}</div>` : ""}
            </div>
            ${t.specialRequests ? `<div style="margin-top:6px;font-size:12px;"><b>Special requests:</b> ${t.specialRequests}</div>` : ""}
            ${t.paceHint ? `<div style="margin-top:4px;font-size:12px;"><b>Pace note:</b> ${t.paceHint}</div>` : ""}
            ${t.placesToVisit && t.placesToVisit.length > 0 ? `<div style="margin-top:6px;font-size:12px;"><b>Places to visit:</b> ${t.placesToVisit.join(", ")}</div>` : ""}
          </section>
        </div>
      `;

      function citySelect(dayIndex, currentCity) {
        // Collect all known cities from hotels and from the geographic corridor
        const hotelCities = HOTEL_OPTIONS ? Object.keys(HOTEL_OPTIONS) : [];
        const corridorCities = CITY_CORRIDOR ? CITY_CORRIDOR.map(c => c.name) : [];
        const allCities = Array.from(new Set([...hotelCities, ...corridorCities]));

        // Decide what should be selected:
        // 1) use the city passed in (currentCity),
        // 2) otherwise fall back to itineraryState if available,
        // 3) otherwise nothing selected.
        const stateCity =
          (window.itineraryState &&
            Array.isArray(window.itineraryState.days) &&
            window.itineraryState.days[dayIndex] &&
            window.itineraryState.days[dayIndex].city) ||
          "";
        const selectedCity = currentCity || stateCity || "";

        return `
          <select data-day="${dayIndex}" data-field="city" class="city-select"
                  style="font-size:12px;padding:4px 6px;border-radius:6px;border:1px solid #ccc;">
            ${allCities
              .map(city => {
                const sel = city === selectedCity ? ' selected="selected"' : "";
                return `<option value="${city}"${sel}>${city}</option>`;
              })
              .join("")}
          </select>
        `;
      }

      let cambodiaHeaderShown = false;
      let daysHtml = state.daysData.map(d => {
        const city = d.city || "";
        const isCambodiaCity = city === "Phnom Penh" || city === "Siem Reap";
        
        // Insert header once before the first Cambodia day
        let cambodiaDividerHtml = "";
        if (isCambodiaCity && !cambodiaHeaderShown) {
          cambodiaHeaderShown = true;
          cambodiaDividerHtml = `
            <div class="cambodia-divider" style="background: linear-gradient(135deg, #d4af37, #f4d03f); color: #fff; padding: 16px 20px; border-radius: 12px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
              <h2 style="margin: 0 0 6px; font-size: 18px; font-weight: 600;">üá∞üá≠ Cambodia Extension (4 Days)</h2>
              <p style="margin: 0; font-size: 13px; opacity: 0.95;">Phnom Penh &amp; Siem Reap section of the trip.</p>
            </div>
          `;
        }
        
        const hotelOptions = getHotelsFor(d.hotelCity);
        const starLabel = hotelRatingToStars(state.traveller.hotelRating);
        const hotelText = d.hotelName || "To be advised";
        const hotelSelect = `
          <div class="day-hotel-row">
            <span style="font-size:12px;font-weight:500;">Hotel:</span>
            <div class="screen-only">
              <select data-day="${d.dayIndex}" data-field="hotelName">
                <option value="">Select hotel‚Ä¶</option>
                ${hotelOptions.map(h => {
                  const hotelNameOnly = getHotelNameOnly(h);
                  const isSelected = hotelNameOnly === getHotelNameOnly(d.hotelName) || h === d.hotelName;
                  return `<option value="${hotelNameOnly}" ${isSelected ? "selected" : ""}>${h}</option>`;
                }).join("")}
              </select>
              ${starLabel ? `<span class="star-rating">${starLabel}</span>` : ""}
            </div>
            <div class="print-only">
              <span style="font-size:12px;">${hotelText}${starLabel ? " ‚Äì " + starLabel : ""}</span>
            </div>
          </div>
        `;

        function activityBlock(day, partLabel, fieldName, optionsArr) {
          const selectOptions = optionsArr.map(o => `<option value="${o}">${o}</option>`).join("");
          const text = day[fieldName] || "";
          return `
            <div class="day-activity-row">
              <div class="day-section-title">${partLabel}</div>
              <div class="screen-only">
                <select data-day="${day.dayIndex}" data-part="${fieldName}" class="alt-activity-select">
                  <option value="">Choose alternative activity‚Ä¶</option>
                  ${selectOptions}
                </select>
                <div class="small-hint" style="margin:2px 0 4px;">
                  You can also type your own activity below ‚Äì it will be saved and printed.
                </div>
                <textarea data-day="${day.dayIndex}" data-field="${fieldName}">${text}</textarea>
              </div>
              <div class="print-only">
                <p style="margin:2px 0 0;font-size:12px;">${text || "Details to be defined."}</p>
              </div>
            </div>
          `;
        }

        const transferText = d.transfer || "";
        const transferBlock = `
          <div class="transfer-label">Transfer</div>
          <div class="transfer-box">
            <div class="screen-only">
              <textarea data-day="${d.dayIndex}" data-field="transfer"
                placeholder="Transfer between cities (flight / car / train)‚Ä¶">${transferText}</textarea>
            </div>
            <div class="print-only">
              <p style="margin:0;font-size:12px;">${transferText || "Transfer details to be confirmed."}</p>
            </div>
          </div>
        `;

        const mealPlanValue = d.mealPlan || "B/L/D";
        const mealPlanBlock = `
          <div class="transfer-label">Meals</div>
          <div class="transfer-box">
            <div class="screen-only">
              <select data-day="${d.dayIndex}" data-field="mealPlan" 
                      style="width:100%;padding:6px 8px;border:none;background:transparent;font-size:12px;font-family:inherit;">
                <option value="B/_/_" ${mealPlanValue === "B/_/_" ? "selected" : ""}>B/_/_ (Breakfast only)</option>
                <option value="B/L/_" ${mealPlanValue === "B/L/_" ? "selected" : ""}>B/L/_ (Breakfast & Lunch)</option>
                <option value="B/L/D" ${mealPlanValue === "B/L/D" ? "selected" : ""}>B/L/D (Breakfast, Lunch & Dinner)</option>
              </select>
            </div>
            <div class="print-only">
              <p style="margin:0;font-size:12px;font-weight:500;">${mealPlanValue}</p>
            </div>
          </div>
        `;

        // Check if this city contains any requested places
        const placesToVisit = state.traveller.placesToVisit || [];
        const requiredCities = extractRequiredCities(placesToVisit);
        const isRequestedCity = requiredCities.includes(d.city);
        const requestedPlacesInCity = placesToVisit.filter(place => {
          const city = ATTRACTION_TO_CITY[place] || 
                      (place.toLowerCase().includes(d.city.toLowerCase()) ? d.city : null);
          return city === d.city;
        });
        const requestedIndicator = isRequestedCity && requestedPlacesInCity.length > 0 
          ? `<span style="color: #f59e0b; font-size: 14px; margin-left: 6px;" title="Includes requested: ${requestedPlacesInCity.join(', ')}">‚≠ê</span>`
          : "";

        return `${cambodiaDividerHtml}
          <div class="day-card">
            <div class="day-banner">
              <div>
                <div class="day-banner-main">${d.label} ‚Äì ${d.city}${requestedIndicator}</div>
                <div class="day-banner-sub">
                  <span class="screen-only"><span class="location-label">Location (editable):</span> ${citySelect(d.dayIndex, d.city)}</span>
                  <span class="print-only">Location: ${d.city}${isRequestedCity ? ' ‚≠ê' : ''}</span>
                </div>
              </div>
              <div class="day-banner-date">
                ${d.date ? formatDate(d.date) : ""}
              </div>
            </div>
            <div class="day-content">
              ${hotelSelect}

              ${mealPlanBlock}

              ${transferBlock}

              ${activityBlock(d, "Morning", "morning", d.morningOptions || [])}
              ${activityBlock(d, "Afternoon", "afternoon", d.afternoonOptions || [])}
              ${activityBlock(d, "Evening", "evening", d.eveningOptions || [])}

              <div class="picture-gallery-footer">
                <div style="font-size:12px;font-weight:500;margin-bottom:4px;">Day Photos</div>
                <div class="picture-gallery-container" 
                     data-day="${d.dayIndex}" 
                     data-field="pictureNotes"
                     ondrop="handleImageDrop(event, ${d.dayIndex})" 
                     ondragover="handleDragOver(event)" 
                     ondragleave="handleDragLeave(event)"
                     onclick="document.getElementById('file-input-${d.dayIndex}').click()">
                  ${renderPictureGallery(d.pictureNotes || "", d.dayIndex)}
                </div>
                <input type="file" 
                       id="file-input-${d.dayIndex}" 
                       style="display:none" 
                       accept="image/*" 
                       multiple 
                       onchange="handleFileSelect(event, ${d.dayIndex})">
              </div>
            </div>
          </div>
        `;
      }).join("");

      const internalNotesHtml = `
        <div class="internal-notes no-print">
          <h3>Internal warnings &amp; suggestions for Lona (not printed for client)</h3>
          <ul class="warning-list">
            <li>Check realistic transfer times and adjust activities if a day is too full.</li>
            <li>Verify hotel availability &amp; category according to budget and age group.</li>
            <li>For seniors / mobility issues: reduce stairs &amp; temples, add more caf√©/rest time.</li>
            <li>For nightlife-oriented guests: emphasise evening bars &amp; street food, keep mornings lighter.</li>
            <li>Double-check special food requirements with restaurants (especially halal / kosher style).</li>
          </ul>
          <textarea id="lonaInternalNotes"
            placeholder="Your own notes, reminders, and checks for this specific group..."></textarea>
        </div>
      `;

      // Add map container HTML with legend
      const mapHtml = `
        <div class="itinerary-map-container">
          <div class="itinerary-map-title">üìç Itinerary Route Map</div>
          <div id="itineraryMap"></div>
          <div class="map-legend" style="margin-top: 12px; padding: 12px 16px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px; display: flex; gap: 24px; font-size: 13px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 40px; height: 3px; background: #2563eb; border-radius: 2px;"></div>
              <span style="font-weight: 600; color: #1f2937;">Road</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="position: relative; width: 40px; height: 3px;">
                <div style="width: 40px; height: 3px; background: #2563eb; border-radius: 2px; border-top: 2px dashed #2563eb; border-bottom: 2px dashed #2563eb;"></div>
                <span style="position: absolute; left: 12px; top: -8px; font-size: 16px; color: #2563eb;">‚úà</span>
              </div>
              <span style="font-weight: 600; color: #1f2937;">Flight</span>
            </div>
          </div>
        </div>
      `;
      
      cont.innerHTML = brandHeaderHtml + headerHtml + internalNotesHtml + daysHtml + mapHtml;
      
      // Render map after a short delay to ensure DOM is ready
      setTimeout(() => {
        renderItineraryMap();
      }, 100);
    }

    function updateDayForCity(dayIndex, newCity) {
      const day = state.daysData[dayIndex];
      if (!day) return;
      const t = state.traveller;
      
      // Update map when city changes
      setTimeout(() => {
        renderItineraryMap();
      }, 100);

      day.city = newCity;
      day.hotelCity = newCity;

      const hotels = getHotelsFor(newCity);
      day.hotelName = hotels[0] || "";

      const morningOptions = getActivitiesFor(newCity, "morning");
      const afternoonOptions = getActivitiesFor(newCity, "afternoon");
      const eveningOptions = getActivitiesFor(newCity, "evening");

      day.morningOptions = morningOptions;
      day.afternoonOptions = afternoonOptions;
      day.eveningOptions = eveningOptions;

      const prevCity = dayIndex === 0 ? null : state.daysData[dayIndex - 1].city;
      day.transfer = buildTransferText(prevCity, newCity);

      const tDays = state.traveller.numDays;
      if (dayIndex === 0 && t.arrivalTime) {
        day.transfer += (day.transfer ? " " : "") + `Airport pick-up according to arrival at ${t.arrivalTime}.`;
      }
      if (dayIndex === tDays - 1 && t.departureTime) {
        day.transfer += (day.transfer ? " " : "") + `Airport drop-off according to departure at ${t.departureTime}.`;
      }

      day.morning = morningOptions[0] || "";
      day.afternoon = afternoonOptions[0] || "";
      day.evening = eveningOptions[0] || "";

      const nextDay = state.daysData[dayIndex + 1];
      if (nextDay) {
        nextDay.transfer = buildTransferText(newCity, nextDay.city);
        if (dayIndex + 1 === tDays - 1 && t.departureTime) {
          const hasMajorAirport = ["Ho Chi Minh City", "Hanoi", "Da Nang", "Nha Trang", "Hue", "Phu Quoc", "Can Tho", "Phnom Penh", "Siem Reap"].includes(nextDay.city);
          const airportTransferTime = hasMajorAirport ? "30-45 minutes" : "45-60 minutes";
          nextDay.transfer += (nextDay.transfer ? " " : "") + `Airport drop-off according to departure at ${t.departureTime}. Allow ${airportTransferTime} for transfer from hotel/city center to airport, plus 2-3 hours for check-in and security.`;
        }
      }
    }

    $("generateBtn").addEventListener("click", () => {
      collectTravellerData();
      autoFillEndDate();
      generateDaysData();
      renderItinerary();
    });

    // Event handlers for pre-defined itinerary selectors
    const briefSelect = document.getElementById("brief-itinerary-select");
    if (briefSelect) {
      briefSelect.addEventListener("change", function() {
        const days = this.value;
        if (!days) return;

        const output = document.getElementById("itineraryArea");
        const data = briefItineraries[days];

        if (!data || !data.name) {
          output.innerHTML = `
            <div class="itinerary-header">
              <h2>Brief Itinerary ‚Äì ${days} Days</h2>
              <p>Brief itinerary not uploaded yet for ${days} days.</p>
            </div>
          `;
          return;
        }

        const textLines = [
          data.name,
          "",
          `Duration: ${days} days`,
          `Destinations: ${data.destinations}`,
          `Starts in: ${data.startsIn}`,
          `Ends in: ${data.endsIn}`,
          "",
          data.intro,
          "",
          "<h3>Brief Itinerary:</h3>",
          ...data.days.map(day => `<p>${day}</p>`)
        ];

        output.innerHTML = `
          <header class="brand-header">
            <div class="brand-header-left">
              <img src="vht_logo.png" alt="VHT Vietnam Holiday Tours logo" class="brand-logo">
              <div class="brand-title-block">
                <div class="brand-title">VHT ‚Äì Vietnam Holiday Tours</div>
                <div class="brand-subtitle">Tailor-made itinerary proposal</div>
              </div>
            </div>
          </header>
          <div class="itinerary-header">
            <h2>Brief Itinerary ‚Äì ${days} Days</h2>
            <section class="trip-meta-card">
              <div><strong>Tour Name:</strong> ${data.name}</div>
              <div><strong>Duration:</strong> ${days} days</div>
              <div><strong>Destinations:</strong> ${data.destinations}</div>
              <div><strong>Starts in:</strong> ${data.startsIn}</div>
              <div><strong>Ends in:</strong> ${data.endsIn}</div>
              <div><strong>Tour Type:</strong> ${data.tourType}</div>
              <div><strong>Travel Style:</strong> ${data.travelStyle}</div>
            </section>
            <div style="margin-top: 16px;">
              <p><strong>Introduction:</strong></p>
              <p>${data.intro}</p>
            </div>
            <div style="margin-top: 20px;">
              <h3>Day-by-Day Itinerary:</h3>
              ${data.days.map(day => `<p style="margin: 8px 0;">${day}</p>`).join("")}
            </div>
            <div style="margin-top: 24px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
              <button class="btn btn-primary" onclick="loadItineraryIntoGenerator(briefItineraries['${days}'], false)" style="padding: 10px 20px; font-size: 14px; font-weight: 600;">
                üìã Load into Generator
              </button>
              <p style="margin-top: 10px; font-size: 12px; color: #666;">
                Click to auto-fill the form fields and use this route when generating your customized itinerary.
              </p>
            </div>
          </div>
        `;
      });
    }

    const detailedSelect = document.getElementById("detailed-itinerary-select");
    if (detailedSelect) {
      detailedSelect.addEventListener("change", function() {
        const days = this.value;
        if (!days) return;

        const output = document.getElementById("itineraryArea");
        const data = detailedItineraries[days];

        if (!data || !data.name) {
          output.innerHTML = `
            <div class="itinerary-header">
              <h2>Detailed Itinerary ‚Äì ${days} Days</h2>
              <p>Detailed itinerary not uploaded yet for ${days} days.</p>
            </div>
          `;
          return;
        }

        output.innerHTML = `
          <header class="brand-header">
            <div class="brand-header-left">
              <img src="vht_logo.png" alt="VHT Vietnam Holiday Tours logo" class="brand-logo">
              <div class="brand-title-block">
                <div class="brand-title">VHT ‚Äì Vietnam Holiday Tours</div>
                <div class="brand-subtitle">Tailor-made itinerary proposal</div>
              </div>
            </div>
          </header>
          <div class="itinerary-header">
            <h2>Detailed Itinerary ‚Äì ${days} Days</h2>
            <section class="trip-meta-card">
              <div><strong>Tour Name:</strong> ${data.name}</div>
              <div><strong>Duration:</strong> ${days} days</div>
            </section>
            <div style="margin-top: 20px;">
              ${data.days.map(d => `
                <div class="day-card" style="margin-bottom: 16px;">
                  <h3 style="margin-top: 0; margin-bottom: 8px; color: #1363df;">Day ${d.day} ‚Äì ${d.title}</h3>
                  <p style="margin: 0; line-height: 1.6;">${d.details || ""}</p>
                </div>
              `).join("")}
            </div>
            <div style="margin-top: 24px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
              <button class="btn btn-primary" onclick="loadItineraryIntoGenerator(detailedItineraries['${days}'], true)" style="padding: 10px 20px; font-size: 14px; font-weight: 600;">
                üìã Load into Generator
              </button>
              <p style="margin-top: 10px; font-size: 12px; color: #666;">
                Click to auto-fill the form fields and use this route when generating your customized itinerary.
              </p>
            </div>
          </div>
        `;
      });
    }

    $("itineraryArea").addEventListener("input", (e) => {
      const target = e.target;
      const dayIndex = parseInt(target.getAttribute("data-day"), 10);
      if (isNaN(dayIndex)) return;

      const field = target.getAttribute("data-field");
      if (!field) return;

      const day = state.daysData[dayIndex];
      if (!day) return;

      day[field] = target.value;
    });

    $("itineraryArea").addEventListener("change", (e) => {
      const target = e.target;
      
      // Handle city-select changes and save to window.itineraryState
      if (target.matches(".city-select")) {
        const dayIndex = parseInt(target.getAttribute("data-day"), 10);
        const value = target.value;
        if (window.itineraryState && window.itineraryState.days && window.itineraryState.days[dayIndex]) {
          window.itineraryState.days[dayIndex].city = value;
          window.itineraryState.days[dayIndex].hotelCity = value;
        }
        // Also update state.daysData
        const day = state.daysData[dayIndex];
        if (day) {
          updateDayForCity(dayIndex, value);
          renderItinerary();
          return;
        }
      }
      
      const dayIndex = parseInt(target.getAttribute("data-day"), 10);
      if (isNaN(dayIndex)) return;

      const field = target.getAttribute("data-field");
      const part = target.getAttribute("data-part");
      const day = state.daysData[dayIndex];
      if (!day) return;

      if (field === "hotelName") {
        day.hotelName = target.value;
        renderItinerary();
        return;
      }

      if (field === "mealPlan") {
        day.mealPlan = target.value;
        // No need to re-render for meal plan changes, just save the value
        return;
      }

      if (field === "city") {
        const newCity = target.value;
        updateDayForCity(dayIndex, newCity);
        renderItinerary();
        return;
      }

      if (part && target.classList.contains("alt-activity-select")) {
        if (target.value) {
          day[part] = target.value;
          renderItinerary();
        }
      }
    });

    $("templateUpload").addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          if (data.hotelsByCity) {
            Object.keys(data.hotelsByCity).forEach(city => {
              if (!HOTEL_OPTIONS[city]) HOTEL_OPTIONS[city] = [];
              HOTEL_OPTIONS[city].push(...data.hotelsByCity[city]);
            });
          }
          if (data.activitiesByCity) {
            Object.keys(data.activitiesByCity).forEach(city => {
              if (!ACTIVITIES[city]) ACTIVITIES[city] = { morning: [], afternoon: [], evening: [] };
              const parts = data.activitiesByCity[city];
              ["morning", "afternoon", "evening"].forEach(part => {
                if (parts[part]) {
                  if (!ACTIVITIES[city][part]) ACTIVITIES[city][part] = [];
                  ACTIVITIES[city][part].push(...parts[part]);
                }
              });
            });
          }
          alert("Templates uploaded successfully. Generate the itinerary again to see new options.");
        } catch (err) {
          console.error(err);
          alert("Failed to read JSON file. Please check the format.");
        }
      };
      reader.readAsText(file);
    });

    function printItinerary() {
      if (!state.daysData || !state.daysData.length) {
        alert("Please generate an itinerary first.");
        return;
      }
      window.print();
    }

    // Add event listener for print button
    const printBtn = document.getElementById("printItineraryBtn");
    if (printBtn) {
      printBtn.addEventListener("click", () => {
        printItinerary();
      });
    }

    renderItinerary();

    // ========== FLOATING SIDEBAR HELPER FOR DAYS SELECTION ==========
    (function() {
      // üëâ Adjust this selector if your input has a different ID / name
      const DAYS_INPUT_SELECTOR = '#numDays, [name="numDays"]';

      const helper = document.getElementById('itinerary-sidebar-helper');
      if (!helper) return; // Exit if helper doesn't exist

      const titleEl = document.getElementById('helper-title');
      const textEl = document.getElementById('helper-text');
      const tagEl = document.getElementById('helper-tag');
      const closeBtn = helper.querySelector('.helper-close');

      function findDaysInput() {
        return document.querySelector(DAYS_INPUT_SELECTOR);
      }

      function classifyDays(days) {
        if (!days || isNaN(days)) return null;
        const n = Number(days);
        if (n <= 0) return null;
        if (n <= 14) return 'short';
        if (n <= 20) return 'extended';
        return 'long';
      }

      function updateHelper(days) {
        const mode = classifyDays(days);

        if (!mode) {
          helper.style.display = 'none';
          return;
        }

        helper.style.display = 'block';

        if (mode === 'short') {
          titleEl.textContent = 'üü© Short / Medium itinerary';
          textEl.textContent =
            '4‚Äì14 days: focus on one or two regions (North / Central / South), simple logistics and no rush.';
          tagEl.innerHTML = '<span>üéØ</span><span>Good for families & quick vacations</span>';
        } else if (mode === 'extended') {
          titleEl.textContent = 'üüß Extended journey';
          textEl.textContent =
            '15‚Äì20 days: deeper Vietnam, add more cities and a mix of culture, nature and one overnight cruise.';
          tagEl.innerHTML = '<span>üß≥</span><span>Use mid-length templates or split North / South</span>';
        } else {
          titleEl.textContent = 'üü¶ Full Vietnam / Long-haul';
          textEl.textContent =
            '21‚Äì30 days: ideal for using your 21-day "Symphony of Vietnam" or 30-day "Full Month" templates as a base.';
          tagEl.innerHTML = '<span>üìö</span><span>Start from 21D or 30D master itinerary</span>';
        }
      }

      function initHelper() {
        const input = findDaysInput();
        if (!input) {
          // Try again after a short delay (for apps that render later)
          setTimeout(initHelper, 800);
          return;
        }

        const handler = () => updateHelper(input.value);
        input.addEventListener('input', handler);
        input.addEventListener('change', handler);

        // Initial value (if already filled)
        if (input.value) {
          updateHelper(input.value);
        }
      }

      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          helper.style.display = 'none';
        });
      }

      // Start once DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initHelper);
      } else {
        initHelper();
      }
    })();
    // ========== END SIDEBAR HELPER ==========

    // Print button listener
    document.addEventListener('DOMContentLoaded', () => {
      const printBtn = document.getElementById('printItineraryBtn');
      if (printBtn) {
        printBtn.addEventListener('click', () => {
          window.print();
        });
      }
    });
  </script>

  <!-- ========== FLOATING SIDEBAR HELPER FOR DAYS SELECTION ========== -->
  <div id="itinerary-sidebar-helper" aria-hidden="true" class="no-print">
    <button class="helper-close" title="Hide">‚úï</button>
    <h4 id="helper-title">üß≠ Itinerary suggestion</h4>
    <p id="helper-text">
      Choose number of days to see a suggestion.
    </p>
    <div class="tag" id="helper-tag">
      <span>‚ÑπÔ∏è</span><span>Waiting for days input‚Ä¶</span>
    </div>
  </div>
  <!-- ========== END SIDEBAR HELPER ========== -->
</body>
</html>
